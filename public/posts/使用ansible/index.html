<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>使用ansible | My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="前言
ansible 算是一個把yaml檔用到淋漓盡致的軟體，主要運用於同時多台自動化佈署，playbook 可以說是將yaml檔再做編譯的自創語言
假設我現在有三個節點，controller, node1, node2 我們的ansible會安裝在controller
那我們可以在個別節點/etc/hostname設定各自的名字
在controller節點的/etc/hosts設定對應的IP
資源
https://www.youtube.com/watch?v=K0e7tjh3NFk&amp;list=PLfQqWeOCIH4BDoRx8lpXXl4hqSD4GSDU5
https://ithelp.ithome.com.tw/articles/10185016
inventory.ini
相當於資產列表，一行代表一個節點的設定
遵守ini 的key-value格式
也可以加上中括號分組(group)
// 沒分組相當於[all]
node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password
node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password
類似正則的匹配 node1~node100
node[1:100] ansible_connection=ssh ansible_user=root ansible_ssh_pass=password
[web1]
# node1 是設定好的hostname
node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password
[web2]
node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password
提取組變數(其實很少放在ini，通常都放yaml)
[all]
node1
node2
[all:vars]
ansible_connection=ssh 
ansible_user=root 
ansible_ssh_pass=password
ping
ansible的其中一個功能，跟一般的ping不一樣
all 所有的節點
-m module
-i 指定文件
ansible node1 -m ping -i inventory.ini
//or
ansible web1 -m ping -i inventory.ini
//all
ansible all -m ping -i inventory.ini
ssh key
在inventory.ini裡面我們通常不會放ansible_ssh_pass，因為實在是太危險
那我們通常都是用ssh key來進行登入，在controller上面生成ssh key">
    <meta name="generator" content="Hugo 0.152.2">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    


    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/posts/%E4%BD%BF%E7%94%A8ansible/">
    

    <meta property="og:url" content="http://localhost:1313/posts/%E4%BD%BF%E7%94%A8ansible/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="使用ansible">
  <meta property="og:description" content="前言 ansible 算是一個把yaml檔用到淋漓盡致的軟體，主要運用於同時多台自動化佈署，playbook 可以說是將yaml檔再做編譯的自創語言
假設我現在有三個節點，controller, node1, node2 我們的ansible會安裝在controller 那我們可以在個別節點/etc/hostname設定各自的名字 在controller節點的/etc/hosts設定對應的IP
資源 https://www.youtube.com/watch?v=K0e7tjh3NFk&amp;list=PLfQqWeOCIH4BDoRx8lpXXl4hqSD4GSDU5
https://ithelp.ithome.com.tw/articles/10185016
inventory.ini 相當於資產列表，一行代表一個節點的設定 遵守ini 的key-value格式 也可以加上中括號分組(group)
// 沒分組相當於[all] node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password 類似正則的匹配 node1~node100
node[1:100] ansible_connection=ssh ansible_user=root ansible_ssh_pass=password [web1] # node1 是設定好的hostname node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password [web2] node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password 提取組變數(其實很少放在ini，通常都放yaml)
[all] node1 node2 [all:vars] ansible_connection=ssh ansible_user=root ansible_ssh_pass=password ping ansible的其中一個功能，跟一般的ping不一樣 all 所有的節點 -m module -i 指定文件
ansible node1 -m ping -i inventory.ini //or ansible web1 -m ping -i inventory.ini //all ansible all -m ping -i inventory.ini ssh key 在inventory.ini裡面我們通常不會放ansible_ssh_pass，因為實在是太危險 那我們通常都是用ssh key來進行登入，在controller上面生成ssh key">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-09-10T10:39:44+00:00">
    <meta property="article:modified_time" content="2020-09-10T10:39:44+00:00">

  <meta itemprop="name" content="使用ansible">
  <meta itemprop="description" content="前言 ansible 算是一個把yaml檔用到淋漓盡致的軟體，主要運用於同時多台自動化佈署，playbook 可以說是將yaml檔再做編譯的自創語言
假設我現在有三個節點，controller, node1, node2 我們的ansible會安裝在controller 那我們可以在個別節點/etc/hostname設定各自的名字 在controller節點的/etc/hosts設定對應的IP
資源 https://www.youtube.com/watch?v=K0e7tjh3NFk&amp;list=PLfQqWeOCIH4BDoRx8lpXXl4hqSD4GSDU5
https://ithelp.ithome.com.tw/articles/10185016
inventory.ini 相當於資產列表，一行代表一個節點的設定 遵守ini 的key-value格式 也可以加上中括號分組(group)
// 沒分組相當於[all] node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password 類似正則的匹配 node1~node100
node[1:100] ansible_connection=ssh ansible_user=root ansible_ssh_pass=password [web1] # node1 是設定好的hostname node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password [web2] node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password 提取組變數(其實很少放在ini，通常都放yaml)
[all] node1 node2 [all:vars] ansible_connection=ssh ansible_user=root ansible_ssh_pass=password ping ansible的其中一個功能，跟一般的ping不一樣 all 所有的節點 -m module -i 指定文件
ansible node1 -m ping -i inventory.ini //or ansible web1 -m ping -i inventory.ini //all ansible all -m ping -i inventory.ini ssh key 在inventory.ini裡面我們通常不會放ansible_ssh_pass，因為實在是太危險 那我們通常都是用ssh key來進行登入，在controller上面生成ssh key">
  <meta itemprop="datePublished" content="2020-09-10T10:39:44+00:00">
  <meta itemprop="dateModified" content="2020-09-10T10:39:44+00:00">
  <meta itemprop="wordCount" content="210">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="使用ansible">
  <meta name="twitter:description" content="前言 ansible 算是一個把yaml檔用到淋漓盡致的軟體，主要運用於同時多台自動化佈署，playbook 可以說是將yaml檔再做編譯的自創語言
假設我現在有三個節點，controller, node1, node2 我們的ansible會安裝在controller 那我們可以在個別節點/etc/hostname設定各自的名字 在controller節點的/etc/hosts設定對應的IP
資源 https://www.youtube.com/watch?v=K0e7tjh3NFk&amp;list=PLfQqWeOCIH4BDoRx8lpXXl4hqSD4GSDU5
https://ithelp.ithome.com.tw/articles/10185016
inventory.ini 相當於資產列表，一行代表一個節點的設定 遵守ini 的key-value格式 也可以加上中括號分組(group)
// 沒分組相當於[all] node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password 類似正則的匹配 node1~node100
node[1:100] ansible_connection=ssh ansible_user=root ansible_ssh_pass=password [web1] # node1 是設定好的hostname node1 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password [web2] node2 ansible_connection=ssh ansible_user=root ansible_ssh_pass=password 提取組變數(其實很少放在ini，通常都放yaml)
[all] node1 node2 [all:vars] ansible_connection=ssh ansible_user=root ansible_ssh_pass=password ping ansible的其中一個功能，跟一般的ping不一樣 all 所有的節點 -m module -i 指定文件
ansible node1 -m ping -i inventory.ini //or ansible web1 -m ping -i inventory.ini //all ansible all -m ping -i inventory.ini ssh key 在inventory.ini裡面我們通常不會放ansible_ssh_pass，因為實在是太危險 那我們通常都是用ssh key來進行登入，在controller上面生成ssh key">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">使用ansible</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2020-09-10T10:39:44Z">September 10, 2020</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h1 id="前言">前言</h1>
<p>ansible 算是一個把yaml檔用到淋漓盡致的軟體，主要運用於同時多台自動化佈署，playbook 可以說是將yaml檔再做編譯的自創語言</p>
<p>假設我現在有三個節點，controller, node1, node2 我們的ansible會安裝在controller
那我們可以在個別節點<code>/etc/hostname</code>設定各自的名字
在controller節點的<code>/etc/hosts</code>設定對應的IP</p>
<h1 id="資源">資源</h1>
<p><a href="https://www.youtube.com/watch?v=K0e7tjh3NFk&amp;list=PLfQqWeOCIH4BDoRx8lpXXl4hqSD4GSDU5">https://www.youtube.com/watch?v=K0e7tjh3NFk&amp;list=PLfQqWeOCIH4BDoRx8lpXXl4hqSD4GSDU5</a></p>
<p><a href="https://ithelp.ithome.com.tw/articles/10185016">https://ithelp.ithome.com.tw/articles/10185016</a></p>
<h1 id="inventoryini">inventory.ini</h1>
<p>相當於資產列表，一行代表一個節點的設定
遵守ini 的key-value格式
也可以加上中括號分組(group)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">// 沒分組相當於[all]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">node1 ansible_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">ssh ansible_user=root ansible_ssh_pass=password</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">node2 ansible_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">ssh ansible_user=root ansible_ssh_pass=password</span>
</span></span></code></pre></div><p>類似正則的匹配 node1~node100</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#a6e22e">node[1:100] ansible_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">ssh ansible_user=root ansible_ssh_pass=password</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[web1]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># node1 是設定好的hostname</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">node1 ansible_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">ssh ansible_user=root ansible_ssh_pass=password</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[web2]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">node2 ansible_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">ssh ansible_user=root ansible_ssh_pass=password</span>
</span></span></code></pre></div><p>提取組變數(其實很少放在ini，通常都放yaml)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[all]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">node1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">node2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[all:vars]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ansible_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">ssh </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ansible_user</span><span style="color:#f92672">=</span><span style="color:#e6db74">root </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ansible_ssh_pass</span><span style="color:#f92672">=</span><span style="color:#e6db74">password</span>
</span></span></code></pre></div><h1 id="ping">ping</h1>
<p>ansible的其中一個功能，跟一般的ping不一樣
all 所有的節點
-m module
-i 指定文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ansible node1 -m ping -i inventory.ini
</span></span><span style="display:flex;"><span>//or
</span></span><span style="display:flex;"><span>ansible web1 -m ping -i inventory.ini
</span></span><span style="display:flex;"><span>//all
</span></span><span style="display:flex;"><span>ansible all -m ping -i inventory.ini
</span></span></code></pre></div><h1 id="ssh-key">ssh key</h1>
<p>在inventory.ini裡面我們通常不會放ansible_ssh_pass，因為實在是太危險
那我們通常都是用ssh key來進行登入，在controller上面生成ssh key</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ssh-keygen
</span></span><span style="display:flex;"><span>//接著命名，假設就叫ansible_controller
</span></span><span style="display:flex;"><span>ssh-copy-id -i ~/.ssh/ansible_controller node1
</span></span><span style="display:flex;"><span>//接著node1的~/.ssh/authorized_keys就會看到ansible_controller.pub
</span></span></code></pre></div><p>這樣就算inventory.ini裡面沒有ansible_ssh_pass也沒有關係</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ansible node1 -m ping -i inventory.ini --private-key=/home/user/.ssh/ansible_controller
</span></span></code></pre></div><h1 id="playbook">playbook</h1>
<p>xml 格式繁瑣，數據冗餘
json 最流行，能代表的東西比較少
yaml yml 利用縮排和dash來表示</p>
<p>playbooks是ansible設定，佈署，編排的語言，透過yaml來編寫</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># playbook1.yaml</span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">host</span>: <span style="color:#ae81ff">node1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">play-test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">task</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">check host connection</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ping</span>: 
</span></span></code></pre></div><p>之後就可以</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ansible-playbook palybook1.yaml -i inventory.ini --private-key=/home/user/.ssh/ 
</span></span></code></pre></div><h1 id="核心概念">核心概念</h1>
<ul>
<li>inventory</li>
<li>playbook</li>
<li>module</li>
</ul>
<h1 id="debug">debug</h1>
<p>相當重要的一個module，詳情請看文檔</p>
<h1 id="關鍵字">關鍵字</h1>
<ul>
<li>item 用來做loop用</li>
<li>雙重大括號讀取變數用，裡面可以放python語法</li>
<li>or</li>
</ul>
<h1 id="基本功能">基本功能</h1>
<ul>
<li>with_items 提供loop變數</li>
<li>with_nested 提供nested loop變數(試著映出99乘法表)</li>
<li>var 宣告變數</li>
<li>var_files 變數的檔案</li>
<li>when 條件語句</li>
<li>become 使用root身分</li>
<li>gather_facts 獲取主機訊息，ansible默認打開，這些訊息可以當成變數來獲取</li>
</ul>
<h1 id="資料夾名">資料夾名</h1>
<p>ansible 會透過資料夾名來讀資料</p>
<ul>
<li>inventory 最上層的目錄
<ul>
<li>group_vars</li>
<li>host_vars</li>
</ul>
</li>
</ul>
<h1 id="設定檔">設定檔</h1>
<p>會查找4個地方(優先級遞減):</p>
<ol>
<li>palybook.yaml所在目錄的ansible.cfg</li>
<li>export ANSIBLE_CONFIG=ansible.cfg</li>
<li>/home/user/底下的ansible.cfg</li>
<li>/etc/ansible.cfg</li>
</ol>
<p>每次要都要指定餐參數i 覺得麻煩</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ansible-playbook palybook1.yaml -i inventory.ini
</span></span></code></pre></div><p>ansible.cfg</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[defaults]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">inventory</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">./inventory</span>
</span></span></code></pre></div><p>設定完之後就可以直接</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ansible-playbook palybook1.yaml 
</span></span></code></pre></div><h1 id="shell">shell</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>ansible all -m shell -a &#34;less /www/index.html&#34;
</span></span></code></pre></div><h1 id="template">template</h1>
<p>假設你使用copy，但你不同主機所需要上複製的檔案不完全一樣時，就可以使用template，可以將其視為更高級的copy
jinja是python的模板語言，裡面可以使用python的for語法ect</p>
<h1 id="yum">yum</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">task</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">install git</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">yum</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">git</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">state</span>: <span style="color:#ae81ff">present</span>
</span></span></code></pre></div><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="http://localhost:1313/" >
    &copy;  My New Hugo Site 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
