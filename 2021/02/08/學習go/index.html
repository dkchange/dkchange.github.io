<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dkchange.github.io","root":"/","scheme":"Muse","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜尋...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta name="description" content="前言資料來源 新一代的程式語言，由 google 開發，目的在於解決現有語言的困境例如python 簡單但太慢java 太複雜度太高c&#x2F;c++ 複雜 編譯慢(編譯慢對雲端佈署來說，是個相當大的缺點) 特性 強型別靜態型別(99％的變數都會在邊一時被宣告) 優良的社群 簡單 編譯快 垃圾回收 內建併發 編譯成一個二進位 bin(不依賴其他的 dll 檔之類的)  開發環境設定 windows 去載安">
<meta property="og:type" content="article">
<meta property="og:title" content="學習go">
<meta property="og:url" content="http:&#x2F;&#x2F;dkchange.github.io&#x2F;2021&#x2F;02&#x2F;08&#x2F;%E5%AD%B8%E7%BF%92go&#x2F;index.html">
<meta property="og:site_name" content="蛋粒個人網誌">
<meta property="og:description" content="前言資料來源 新一代的程式語言，由 google 開發，目的在於解決現有語言的困境例如python 簡單但太慢java 太複雜度太高c&#x2F;c++ 複雜 編譯慢(編譯慢對雲端佈署來說，是個相當大的缺點) 特性 強型別靜態型別(99％的變數都會在邊一時被宣告) 優良的社群 簡單 編譯快 垃圾回收 內建併發 編譯成一個二進位 bin(不依賴其他的 dll 檔之類的)  開發環境設定 windows 去載安">
<meta property="og:locale" content="zh-TW">
<meta property="og:updated_time" content="2021-07-30T10:11:28.913Z">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://dkchange.github.io/2021/02/08/%E5%AD%B8%E7%BF%92go/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>學習go | 蛋粒個人網誌</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蛋粒個人網誌</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#特性"><span class="nav-number">2.</span> <span class="nav-text">特性</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#開發環境設定"><span class="nav-number">3.</span> <span class="nav-text">開發環境設定</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#執行"><span class="nav-number">4.</span> <span class="nav-text">執行</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#變數宣告"><span class="nav-number">5.</span> <span class="nav-text">變數宣告</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常數宣告"><span class="nav-number">6.</span> <span class="nav-text">常數宣告</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#命名習慣"><span class="nav-number">7.</span> <span class="nav-text">命名習慣</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#資料型態"><span class="nav-number">8.</span> <span class="nav-text">資料型態</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#流程控制-control-flow"><span class="nav-number">9.</span> <span class="nav-text">流程控制 control flow</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pointer-指標"><span class="nav-number">10.</span> <span class="nav-text">pointer 指標</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#function"><span class="nav-number">11.</span> <span class="nav-text">function</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Interfaces"><span class="nav-number">12.</span> <span class="nav-text">Interfaces</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#併發"><span class="nav-number">13.</span> <span class="nav-text">併發</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Channel"><span class="nav-number">14.</span> <span class="nav-text">Channel</span></a></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Stanley Ke</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2021/02/08/%E5%AD%B8%E7%BF%92go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          學習go
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2021-02-08 13:19:58" itemprop="dateCreated datePublished" datetime="2021-02-08T13:19:58+08:00">2021-02-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-07-30 18:11:28" itemprop="dateModified" datetime="2021-07-30T18:11:28+08:00">2021-07-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://www.youtube.com/watch?v=OSPNUKoN81o&list=PLq9Ra239pNZC0MgMN4j6ZiPHv_c0UPnBX" target="_blank" rel="noopener">資料來源</a></p>
<p>新一代的程式語言，由 google 開發，目的在於解決現有語言的困境<br>例如<br>python 簡單但太慢<br>java 太複雜度太高<br>c/c++ 複雜 編譯慢(編譯慢對雲端佈署來說，是個相當大的缺點)</p>
<h1 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h1><ul>
<li>強型別靜態型別(99％的變數都會在邊一時被宣告)</li>
<li>優良的社群</li>
<li>簡單</li>
<li>編譯快</li>
<li>垃圾回收</li>
<li>內建併發</li>
<li>編譯成一個二進位 bin(不依賴其他的 dll 檔之類的)</li>
</ul>
<h1 id="開發環境設定"><a href="#開發環境設定" class="headerlink" title="開發環境設定"></a>開發環境設定</h1><ul>
<li>windows 去載安裝檔</li>
<li>linux<br>預設目錄/usr/local/go<br>設定環境變數 vim .bashrc</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//設定goroot目前發現會有版本上的問題，所以能避免盡量避免</span><br><span class="line">export GOROOT= /usr/local/go</span><br><span class="line">export PATH= $PATH:$GOROOT/bin</span><br><span class="line">//用來放置第三方套件的地方，弟一個gopath設定用來放套件，之後的就依規定裝在go工作目錄中</span><br><span class="line">export GOPATH = /home/stanley/golib</span><br><span class="line">//讓第三方插件的二進位檔也可執行</span><br><span class="line">export PATH= $PATH:$GOPATH/bin</span><br></pre></td></tr></table></figure>

<blockquote>
<p>source ~/.bashrc</p>
</blockquote>
<p>重新導入環境變數</p>
<blockquote>
<p>go get github.com/stanley/gocode</p>
</blockquote>
<p>就會發現第三方插件被安裝到了 golib<br>但是有些插件我們想要分全域用和專案用<br>此時就要在設置另一個 GOPATH</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export GOPATH = $GOPATH:/home/stanley/code</span><br></pre></td></tr></table></figure>

<p>那如何得到 go 的工作目錄呢？有 <strong>src</strong> 資料夾即可</p>
<ul>
<li>src go 自己會去尋找這個資料架</li>
<li>bin 編譯過得二進位檔</li>
<li>pkg 編譯過得第三方二進位檔</li>
</ul>
<h1 id="執行"><a href="#執行" class="headerlink" title="執行"></a>執行</h1><p>run 指令</p>
<blockquote>
<p>go run xxx.go</p>
</blockquote>
<p>或者 go build 之後直接執行 binary 檔</p>
<blockquote>
<p>./xxx</p>
</blockquote>
<h1 id="變數宣告"><a href="#變數宣告" class="headerlink" title="變數宣告"></a>變數宣告</h1><ul>
<li><p>依照宣告的位置與大寫小寫分三總作用域</p>
<ol>
<li>function 外面宣告(outside of function)</li>
</ol>
<ul>
<li><p>規則：</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> <p>可以用正常的宣告方式宣告，且可以做區塊宣告</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">name <span class="keyword">string</span> = <span class="string">"stanley"</span></span><br><span class="line">age <span class="keyword">int</span> = <span class="number">30</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><input disabled="" type="checkbox"> <p>package 級別不能讓 go 自己判斷變數型態，所以不能使用</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name := <span class="string">"stanley"</span> age <span class="keyword">int</span> = <span class="number">30</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>命名規則</strong></p>
<ul>
<li>第一個字大寫屬於 export 出去的變數 <strong>global</strong> 級別</li>
<li>第一個字小寫屬於 package 的變數 <strong>package</strong> 級別</li>
</ul>
</li>
</ul>
<ol start="2">
<li>function 級別可用 <strong>block</strong> 級別</li>
</ol>
<ul>
<li>規則<ul>
<li>[x]<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name <span class="keyword">string</span> = <span class="string">"stanley"</span></span><br><span class="line">name:=<span class="string">"stanley"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ol start="3">
<li><p>沒使用的變數會導致編譯錯誤</p>
</li>
<li><p>重複宣告變數只存在於 shadowing(function 外的變數，在 function 內可以再宣告一次)</p>
</li>
<li><p>如果變數沒給值，他的值會是該資料型態的 0 值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n <span class="keyword">bool</span></span><br><span class="line">fmt.Printf(<span class="string">"%v,%T"</span>,n,n)</span><br><span class="line"><span class="comment">// false,bool</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>go 對資料型態的轉換非常嚴格，例如不同位元的數字相加，go 是不會自動幫你轉換的，你必須自己轉，</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s:= <span class="string">"this is a string"</span></span><br><span class="line">b:= []<span class="keyword">byte</span>(s)</span><br><span class="line">fmt.Printf(<span class="string">"%v,%T"</span>,b,b)</span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h1 id="常數宣告"><a href="#常數宣告" class="headerlink" title="常數宣告"></a>常數宣告</h1><ul>
<li><p>通常宣告在 package level</p>
</li>
<li><p>immutable , but can be shadowed</p>
</li>
<li><p>編譯期間值就必須確定</p>
</li>
<li><p>命名規則就和一般變數一樣，大寫字母開頭會被 export</p>
</li>
<li><p>讓 go 自己判斷常數型態不像變數需要加冒號</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">44</span></span><br><span class="line"><span class="keyword">var</span> b <span class="keyword">int16</span> = <span class="number">27</span></span><br><span class="line"><span class="comment">// 這邊不會出現型別不同不能相加的錯誤</span></span><br><span class="line">fmt.Printf(<span class="string">"%v,%T"</span>,a+b,a+b)</span><br></pre></td></tr></table></figure></li>
<li><p>iota</p>
<ul>
<li><p>範例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const block 的宣告方式</span></span><br><span class="line"><span class="keyword">const</span>(</span><br><span class="line">  a = <span class="literal">iota</span></span><br><span class="line">  b = <span class="literal">iota</span></span><br><span class="line">  c = <span class="literal">iota</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Printf(<span class="string">"%v\n"</span>,a)</span><br><span class="line">  fmt.Printf(<span class="string">"%v\n"</span>,b)</span><br><span class="line">  fmt.Printf(<span class="string">"%v\n"</span>,c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和下列結果相同</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const block 的宣告方式,可以讓編譯器幫常數自動累加</span></span><br><span class="line"><span class="keyword">const</span>(</span><br><span class="line">  a = <span class="literal">iota</span></span><br><span class="line">  b</span><br><span class="line">  c</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Printf(<span class="string">"%v\n"</span>,a)</span><br><span class="line">  fmt.Printf(<span class="string">"%v\n"</span>,b)</span><br><span class="line">  fmt.Printf(<span class="string">"%v\n"</span>,c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>要注意 iota 從零開始，而其他變數例如 int 的 zero value 是 0，預防方式如下</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 預設第一個元素代表error</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  errorList = <span class="literal">iota</span> <span class="comment">// 或者 _ = iota，compiler 知道_代表不重要的變數</span></span><br><span class="line">  catList</span><br><span class="line">  dogList</span><br><span class="line">  snakeList</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> list = <span class="keyword">int</span></span><br><span class="line">  <span class="comment">// 這樣即使list沒設值也不會有相等的問題</span></span><br><span class="line">  fmt.Prinft(<span class="string">"%v\n"</span>,list == catList)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>iota 的第一個元素，可以是有規則的公式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 場景1： 檔案大小</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  KB = <span class="number">1</span> &lt;&lt; (<span class="number">10</span>*<span class="literal">iota</span>)</span><br><span class="line">  MB</span><br><span class="line">  GB</span><br><span class="line">  TB</span><br><span class="line">  PB</span><br><span class="line">  EB</span><br><span class="line">  ZB</span><br><span class="line">  YB</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fileSize := <span class="number">4000000000</span>;</span><br><span class="line">  fmt.Printf(<span class="string">"%2fGB"</span>,fileSize/GB) <span class="comment">//3.73GB</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 場景1： 角色管理</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  canCreate = <span class="number">1</span> &lt;&lt; <span class="literal">iota</span></span><br><span class="line">  canRead</span><br><span class="line">  canUpdate</span><br><span class="line">  canDelete</span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> roles <span class="keyword">byte</span> = canCreate | canRead | canDelete;</span><br><span class="line">  fmt.Printf(<span class="string">"%b\n"</span>,roles) <span class="comment">//1011</span></span><br><span class="line">  fmt.Printf(<span class="string">"Is this role able to create? %v"</span>, canCreate &amp; roles == canCreate) <span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h1 id="命名習慣"><a href="#命名習慣" class="headerlink" title="命名習慣"></a>命名習慣</h1><ul>
<li>變數名的長短，反映變數的生命，例如 for 迴圈裡面通常用變數 i</li>
<li>camelCase 當變數命名有 HTTP 這懂縮寫時，請保持 HTTP 都是大寫 useHttp(X) useHTTP(o)</li>
<li>不要用底線_這些來命名</li>
</ul>
<h1 id="資料型態"><a href="#資料型態" class="headerlink" title="資料型態"></a>資料型態</h1><ul>
<li><p>boolean</p>
<ul>
<li>ture or false</li>
<li>not an alias for other types e.g 0 或 1 這種 int 型態</li>
<li>預設 zero value 是 false</li>
</ul>
</li>
<li><p>numberic</p>
<ul>
<li><p>intergers</p>
<ul>
<li>signed intergers<ul>
<li>int (:=預設)不管環境為何，至少會是 32 位元，根據系統不同有可能會是 64 或 128<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n <span class="keyword">int8</span>;</span><br><span class="line"><span class="comment">// -128~127</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>unsigned intergers<ul>
<li>unit16 只有正整數(弟一個字母 u 帶表 unsigned)<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n <span class="keyword">uint8</span>;</span><br><span class="line"><span class="comment">// 0~255</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>預設 zero value is 0</li>
</ul>
</li>
<li><p>floating point numbers</p>
<ul>
<li>float64(:=預設)</li>
<li>預設 zero value is 0</li>
</ul>
</li>
<li><p>complex numbers 用於科學計算</p>
<ul>
<li>complex64(:=預設)</li>
<li>預設 zero value is 0</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n <span class="keyword">complex128</span> = <span class="number">1</span>+<span class="number">2i</span>;</span><br><span class="line">fmt.Printf(<span class="string">"%v,%T"</span>,<span class="built_in">real</span>(n),<span class="built_in">real</span>(n))</span><br><span class="line"><span class="comment">// 0~255</span></span><br><span class="line">fmt.Printf(<span class="string">"%v,%T"</span>,<span class="built_in">imag</span>(n),<span class="built_in">imag</span>(n))</span><br><span class="line"><span class="comment">// -128~127</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>% mod 預算符只適用於 int</p>
</li>
</ul>
</li>
<li><p>text</p>
<ul>
<li>string<ul>
<li>(:=預設) UTF8</li>
<li>用 <strong>+</strong> 來連結字串</li>
<li>可被轉換成[]byte</li>
<li>取字母 取出來的會是 ascii code<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s:= <span class="string">"hello"</span></span><br><span class="line">fmt.Println(<span class="keyword">string</span>(s[<span class="number">1</span>])) <span class="comment">//e</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>rune<ul>
<li>(:=預設) UTF32，注意 UTF32 的字母不一定是 32bits 的長度</li>
<li>alias for int32</li>
<li>ReadRune 常用來處理上面的 alias</li>
</ul>
</li>
</ul>
</li>
<li><p>collection</p>
<ul>
<li><p>Arrays</p>
<ul>
<li>陣列直接取<strong>連續</strong>記憶體來劃分，所以存取陣列的效率是很快的</li>
<li>索引從 0 開始</li>
<li>陣列元素的型態都需要一致</li>
<li>固定長度</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grades := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">60</span>,<span class="number">70</span>,<span class="number">80</span>&#125;;<span class="comment">//這裡相當於宣告長度2次</span></span><br><span class="line"><span class="comment">//所以可以改成</span></span><br><span class="line"><span class="comment">//grades := [...]int&#123;60,70,80&#125;;</span></span><br><span class="line">fmt.Printf(<span class="string">"Grades: %v"</span>,grades)</span><br><span class="line"><span class="comment">// len(grades) 可知陣列長度</span></span><br></pre></td></tr></table></figure>

<ul>
<li>陣列是<strong>傳值</strong>呼叫(這點和 js 不同)</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a:= [...]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">b:= a</span><br><span class="line">b[<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">fmt.Printf(a) <span class="comment">// [1 2 3]</span></span><br><span class="line">fmt.Printf(b) <span class="comment">// [1 0 3]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 運用指標來解決陣列複製的資源浪費</span></span><br><span class="line">a:= [...]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">b:= &amp;a</span><br><span class="line">b[<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">fmt.Printf(a) <span class="comment">// [1 0 3]</span></span><br><span class="line">fmt.Printf(b) <span class="comment">// [1 0 3]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Slices</p>
<ul>
<li>所有 array 有的功能 slice 都有</li>
<li>好處是可以先不用固定長度</li>
<li>陣列是<strong>傳址</strong>呼叫(和 Array 不同)</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a:= []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125; <span class="comment">//和array的差別是中括號裡什麼都不用填</span></span><br><span class="line">fmt.Printf(a) <span class="comment">// [1 0 3]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a:= []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125; <span class="comment">//和array的差別是中括號裡什麼都不用填</span></span><br><span class="line">b:= a[:] <span class="comment">// 用：來代表切割範圍</span></span><br><span class="line">c:= a[<span class="number">3</span>:<span class="number">5</span>]</span><br><span class="line">fmt.Printf(a) <span class="comment">// [1 2 3 4 5 6]</span></span><br><span class="line">fmt.Printf(b) <span class="comment">// [1 2 3 4 5 6]</span></span><br><span class="line">fmt.Printf(c) <span class="comment">// [4 5 6]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a:= <span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">3</span>,<span class="number">100</span>) <span class="comment">//這個function的優點是，如果你要append元素，一開始沒指定slice容量的話，go 會先填滿這個slice，如果容量不夠則會新增一個slice長度的兩倍的slice進行擴充，當容量一大會耗效能，所以能預先知道容量大小填進第三個參數是最好的</span></span><br><span class="line">fmt.Printf(a) <span class="comment">// [0 0 0]</span></span><br><span class="line"><span class="comment">// len(a) cap(a)  //長度3容量100，slice 的容量不必和長度相同</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Maps</p>
<ul>
<li><p>宣告方式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">statePopulations := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">  <span class="string">"New York"</span>:<span class="number">9000425</span></span><br><span class="line">  <span class="string">"Florida"</span>:<span class="number">5905421</span></span><br><span class="line">  <span class="string">"California"</span>:<span class="number">2954248</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// delete(statePopulations,"New York") 刪除元素</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">statePopulations := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">statePopulations := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">  <span class="string">"New York"</span>:<span class="number">9000425</span></span><br><span class="line">  <span class="string">"Florida"</span>:<span class="number">5905421</span></span><br><span class="line">  <span class="string">"California"</span>:<span class="number">2954248</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>元素的順序並不固定(和 js 一樣)</p>
</li>
<li><p>元素的類型要一樣</p>
</li>
<li><p>如果元素不存在 map，回傳預設值為 0</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">statePopulations := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">statePopulations := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">  <span class="string">"New York"</span>:<span class="number">9000425</span></span><br><span class="line">  <span class="string">"Florida"</span>:<span class="number">5905421</span></span><br><span class="line">  <span class="string">"California"</span>:<span class="number">2954248</span></span><br><span class="line">&#125;</span><br><span class="line">_,ok := statePopulations[<span class="string">"Ohio"</span>] <span class="comment">//_是即時這變數沒用到，go也會忽略，ok是習慣命名</span></span><br><span class="line">fmt.Println(ok) <span class="comment">// 0,false 藉由false可知此元素不存在map中</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>傳址</strong>呼叫</p>
</li>
</ul>
</li>
<li><p>Struct</p>
</li>
<li><p>宣告</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 大寫的宣告可讓外面看見此結構</span></span><br><span class="line"><span class="keyword">type</span> Doctor <span class="keyword">struct</span>&#123;</span><br><span class="line">  number <span class="keyword">int</span> <span class="comment">// 小寫的宣告，讓人雖然看到結構，但看不到欄位的名字</span></span><br><span class="line">  actorName <span class="keyword">string</span></span><br><span class="line">  companions [] <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  aDoctor := Doctor&#123;</span><br><span class="line">    number:<span class="number">3</span>,</span><br><span class="line">    actorName:<span class="string">"Jon Petwee"</span></span><br><span class="line">    companions: []<span class="keyword">string</span>&#123;</span><br><span class="line">        <span class="string">"Lisa ke"</span>,</span><br><span class="line">        <span class="string">"Mansa cheng"</span></span><br><span class="line">        <span class="string">"donna liu"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>positional declaration</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">// 不建議使用這種實例化的方式，因為一旦有人改了struct宣告結構，會報錯或是改變順序，會錯亂</span></span><br><span class="line">  aDoctor := Doctor&#123;</span><br><span class="line">    <span class="number">3</span>,</span><br><span class="line">    <span class="string">"Jon Petwee"</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Lisa ke"</span>,</span><br><span class="line">        <span class="string">"Mansa cheng"</span></span><br><span class="line">        <span class="string">"donna liu"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>用 <strong>.</strong>來存取元素</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(aDoctor.actorName)</span><br></pre></td></tr></table></figure>

<ul>
<li>匿名 struct</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">// 通常用在生命週期短的變數  例如你可能要格式化api吐的資料結構</span></span><br><span class="line">  aDoctor := <span class="keyword">struct</span>&#123;name <span class="keyword">string</span>&#125;&#123;name:<span class="string">"John Pertwee"</span>&#125;</span><br><span class="line">  fmt.Println(aDoctor)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>傳值</strong>呼叫，所以要宣告賦值時要注意 struct 是否很大，或者用&amp; pointer</p>
</li>
<li><p>embedding go 提供一種叫做 embedded 的語法，來達成組合，和傳統的繼承不同的是 Bird has Animal characteristic 是 has 關係而不是 is 關係，那這種方法不適合在模組化的時候使用，模組化應該要用 interface，這通常用於該資料型態要借助某個功能時</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span>&#123;</span><br><span class="line">  Name <span class="keyword">string</span></span><br><span class="line">  Origin <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Bird <span class="keyword">struct</span> &#123;</span><br><span class="line">  Animal</span><br><span class="line">  SpeedKPH <span class="keyword">float32</span></span><br><span class="line">  CanFly <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  b := Bird&#123;&#125;</span><br><span class="line">  b.Name = <span class="string">"Emu"</span></span><br><span class="line">  b.Origin = <span class="string">"Australia"</span></span><br><span class="line">  b.SpeedKPH = <span class="number">48</span></span><br><span class="line">  b.CanFly = <span class="literal">false</span></span><br><span class="line">  fmt.Println(b.Name)<span class="comment">//Emu</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或是</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  b := Bird&#123;</span><br><span class="line">    Animal&#123;</span><br><span class="line">      Name :<span class="string">"Emu"</span></span><br><span class="line">      Origin :<span class="string">"Australia"</span></span><br><span class="line">    &#125;</span><br><span class="line">    SpeedKPH :<span class="number">48</span></span><br><span class="line">    CanFly :<span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(b.Name)<span class="comment">//Emu</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>tag 通常用在驗證</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"reflect"</span>  <span class="comment">//為了拿到struct的欄位，必須要用到反射</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">struct</span>&#123;</span><br><span class="line">  Name <span class="keyword">string</span> <span class="string">`require max:"100"`</span></span><br><span class="line">  Origin <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  t:=reflect.TypeOf(Animail&#123;&#125;)</span><br><span class="line">  field,_ :=t.FieldByName(<span class="string">"Name"</span>)</span><br><span class="line">  fmt.Println(field.Tag)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h1 id="流程控制-control-flow"><a href="#流程控制-control-flow" class="headerlink" title="流程控制 control flow"></a>流程控制 control flow</h1><ul>
<li><p>if</p>
<ul>
<li>一定要有大括號<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pop only existing in if block</span></span><br><span class="line"><span class="keyword">if</span> pop,ok:=statePopulations[<span class="string">"Florida"</span>];ok &#123;</span><br><span class="line">  fmt.Printlin(pop)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Switch case</p>
<ul>
<li><p>switching with no tag (非固定值的意思)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  i:=<span class="number">10</span></span><br><span class="line">  <span class="keyword">switch</span>&#123;</span><br><span class="line">    <span class="keyword">case</span> i&lt;= <span class="number">10</span>:</span><br><span class="line">      fmt.Println(<span class="string">"less than or equal to ten"</span>)</span><br><span class="line">    <span class="keyword">case</span> i&lt;= <span class="number">20</span>:</span><br><span class="line">      fmt.Println(<span class="string">"less than or equal to twenty"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">"greater than twenty"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//less than or equal to ten</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>如果要其他語言 falling through 的用法但可以</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> <span class="number">3</span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>,<span class="number">5</span>,<span class="number">10</span>:</span><br><span class="line">      fmt.Println(<span class="string">"one"</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>:</span><br><span class="line">      fmt.Println(<span class="string">"two"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">"not one or two"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>或是 fallthrough ，但要小心 fallthrough 不管邏輯都會往下掉</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  i:=<span class="number">10</span></span><br><span class="line">  <span class="keyword">switch</span>&#123;</span><br><span class="line">    <span class="keyword">case</span> i&lt;= <span class="number">10</span>:</span><br><span class="line">      fmt.Println(<span class="string">"less than or equal to ten"</span>)</span><br><span class="line">      <span class="keyword">fallthrough</span></span><br><span class="line">    <span class="keyword">case</span> i&lt;= <span class="number">20</span>:</span><br><span class="line">      fmt.Println(<span class="string">"less than or equal to twenty"</span>)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">"greater than twenty"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//less than or equal to ten</span></span><br><span class="line">  <span class="comment">//less than or equal to twenty</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>type switch</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line"><span class="keyword">switch</span> i.(<span class="keyword">type</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">int</span> :</span><br><span class="line">    fmt.Println(<span class="string">"i is an int"</span>)</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">float64</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is a float64"</span>)</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is string"</span>)</span><br><span class="line">  <span class="keyword">case</span> [<span class="number">3</span>]<span class="keyword">int</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is [3]int"</span>)</span><br><span class="line">    <span class="keyword">break</span> <span class="comment">//breaking out early</span></span><br><span class="line">    fmt.Println(<span class="string">"other stuff"</span>)</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is another type"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// i is [3]int</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Looping</p>
<ul>
<li>迴圈的三個流程，個別只能是一個句子</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在go i++是句子不是運算子</span></span><br><span class="line"><span class="keyword">for</span> i, j:=<span class="number">0</span>,<span class="number">0</span>; i&lt;<span class="number">5</span> ;i,j = i+<span class="number">1</span>,j+<span class="number">1</span>&#123;</span><br><span class="line">  fmt.Println(i,j)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>loop block<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 宣告在外面</span></span><br><span class="line">i := <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ; i&lt;<span class="number">5</span> ;i++&#123;</span><br><span class="line">  fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 才能存取到i</span></span><br><span class="line">fmt.Println(i)</span><br></pre></td></tr></table></figure></li>
<li>分號也可以省略<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i := <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> i&lt;<span class="number">5</span>&#123;</span><br><span class="line">  fmt.Println(i)</span><br><span class="line">  i++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>range<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> k,v := <span class="keyword">range</span> s&#123;</span><br><span class="line">  fmt.Println(k,v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Defer</p>
<ul>
<li>目的：延遲執行直到回傳之前</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">"start"</span>)</span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"middle"</span>)</span><br><span class="line">  fmt.Println(<span class="string">"end"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>LIFO(last in first out) 因為通常用在 resource</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  res,err := http.Get(<span class="string">"http://www.google.com/robots.txt"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">defer</span> res.Body.Close() <span class="comment">//因為你可能一直需要用res 這樣就不怕忘記寫這行</span></span><br><span class="line">  robots,err := ioutil.ReadAll(res.Body)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(robots)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>defer 會拿到的值是 defer 觸發時當下的值 而不是最後呼叫該 function 的值</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:=<span class="string">"start"</span></span><br><span class="line"><span class="keyword">defer</span> fmt.Println(a)</span><br><span class="line">a = <span class="string">"end"</span></span><br><span class="line"><span class="comment">// print out start</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Panic</p>
</li>
<li><p>在 go 沒有 exception，因為在很多語言的 exception 在 go 裡面都算正常，例如要打開一個不存在的文件，在 go 是 return error value 而不是 exception</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  a,b := <span class="number">1</span>,<span class="number">0</span></span><br><span class="line">  ans := a/b</span><br><span class="line">  fmt.Println(ans)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>painc 生命週期在執行玩 defer 之後</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"start"</span>))</span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"this was deffered"</span>)</span><br><span class="line">  <span class="built_in">panic</span>(<span class="string">"something bad happend"</span>)</span><br><span class="line">  fmt.Println(<span class="string">"end"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Recover<ul>
<li>用來恢復程式運作的</li>
<li>一定在 defer function 內，因為 panic 之後只會執行 defer</li>
</ul>
</li>
</ul>
<h1 id="pointer-指標"><a href="#pointer-指標" class="headerlink" title="pointer 指標"></a>pointer 指標</h1><ul>
<li>把他想作是變數的一個附加欄位？裡面放的值一定是記憶體位址</li>
<li>creating pointer</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a <span class="keyword">int</span> =<span class="number">42</span></span><br><span class="line">  <span class="keyword">var</span> b *<span class="keyword">int</span> = &amp;a <span class="comment">//一個數字的指標，指向a位址 用&amp;位址運算符拿出位址</span></span><br><span class="line">  fmt.Println(a,b) <span class="comment">// 42 0x1040a124</span></span><br><span class="line">  fmt.Println(a,b) <span class="comment">//這裡的*作用為取出 42 42</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>pointer arithmetic<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  a := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">  b := &amp;a[<span class="number">0</span>]</span><br><span class="line">  c := &amp;a[<span class="number">1</span>]</span><br><span class="line">  fmt.Printf(<span class="string">"%v %p %p\n"</span>,a,b,c) <span class="comment">// [ 1 2 3 ] 0x1040a124 0x1040a128  可知b 和 c元素之間差4個bytes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在其他的語言你可能會這樣做<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  a := [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line">  b := &amp;a[<span class="number">0</span>]</span><br><span class="line">  c := &amp;a[<span class="number">1</span>]<span class="number">-4</span> <span class="comment">//go不能這樣做記憶體的運算，因為這樣會讓程式變複雜，如果你真的要這麼做，官方有unsafe package</span></span><br><span class="line">  fmt.Printf(<span class="string">"%v %p %p\n"</span>,a,b,c) <span class="comment">//error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>new function<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ms *myStruct</span><br><span class="line">  fmt.Println(ms) <span class="comment">// 初始值&lt;nil&gt;</span></span><br><span class="line">  <span class="comment">// ms = &amp;myStruct&#123;foo:42&#125; //&amp;&#123;42&#125; 初始化一個變數指向物件的指標</span></span><br><span class="line">  ms = <span class="built_in">new</span>(myStruct) <span class="comment">//用new的話沒辦法像上面一樣初始值，所以他的zero value是0 //&amp;&#123;0&#125;</span></span><br><span class="line">  (*ms).foo = <span class="number">42</span> <span class="comment">//()是因為.操作符的優先權高，避免取到ms.foo的pointer</span></span><br><span class="line">  fmt.Println((*ms).foo)<span class="comment">// 42</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
然而 go 比其他語言方便的是<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ms *myStruct</span><br><span class="line">  ms = <span class="built_in">new</span>(myStruct)</span><br><span class="line">  ms.foo = <span class="number">42</span></span><br><span class="line">  fmt.Println(ms.foo) <span class="comment">//可以省略星號和括號，因為go知道你要取值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="function"><a href="#function" class="headerlink" title="function"></a>function</h1><ul>
<li>最簡單的程式基本構成</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123; <span class="comment">//一定要有一個entry point</span></span><br><span class="line">  fmt.Println(<span class="string">"hello world"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>參數 type 一樣可以一起擺在後面</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greeting</span><span class="params">(greeting <span class="keyword">string</span>,name <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">  fmt.Println(greeting,name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以寫成這樣的語法糖</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greeting</span><span class="params">(greeting,name <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">  fmt.Println(greeting,name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>傳址呼叫</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  name:=<span class="string">"Stacey"</span></span><br><span class="line">  greeting(&amp;name)</span><br><span class="line">  fmt.Println(name)<span class="comment">//Ted</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greeting</span><span class="params">(name *<span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">  fmt.Println(*name) <span class="comment">//Stacey</span></span><br><span class="line">  *name = <span class="string">"Ted"</span></span><br><span class="line">  fmt.Println(*name) <span class="comment">//Ted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最後一組同類型參數可使用 slice</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  sum(<span class="string">"the sum is "</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(msg <span class="keyword">string</span>,values ...<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">  result := <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> _,v := <span class="keyword">range</span> values&#123;</span><br><span class="line">    result +=v</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(msg,result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>回傳參數要宣告</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">12</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>回傳指標變數</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">()</span> *<span class="title">int</span></span>&#123;</span><br><span class="line">  result := <span class="number">0</span></span><br><span class="line">  <span class="comment">// 在很多語言並不允許這樣做，因為function執行完的時候，釋放變數，此時你回傳的記憶體位址並不能確定值是正確不變得，但在go 如果他發現你回傳記憶體位址，他會將此變數提昇到share memory ，也就是我們說的heap裡面</span></span><br><span class="line">  <span class="keyword">return</span> &amp;result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>回傳參數名宣告</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//這種方式不常用，因為如果function太長，你還要回來看他回傳什麼，可讀性沒比較號</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">()</span> <span class="params">(result <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">  result = <span class="number">12</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>處理例外</p>
<ul>
<li>回傳例外(通常不這樣做，因為 panic 最好是等到程式執行不下去才用)<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  d:=divide(<span class="number">5.0</span>,<span class="number">0.0</span>)</span><br><span class="line">  fmt.Println(d)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span><span class="params">(a,b <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> b==<span class="number">0.0</span>&#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">"cant provide 0 as second value"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a/b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>常用的方式，回傳錯誤值<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  d,err :=divide(<span class="number">5.0</span>,<span class="number">0.0</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">    fmt.Println(err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(d)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">divide</span><span class="params">(a,b <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> b==<span class="number">0.0</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0.0</span>,fmt.Errorf(<span class="string">"cant divide by 0"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a/b,<span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>匿名函式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">// 常用在非同步執行時,scope的區隔</span></span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">      fmt.Println(i)</span><br><span class="line">    &#125;(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>宣告函數類型的變數</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f:=<span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">"hello"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f <span class="function"><span class="keyword">func</span><span class="params">()</span> : =<span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">"hello"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> divide <span class="function"><span class="keyword">func</span> <span class="params">(<span class="keyword">float64</span>,<span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>,error)</span></span></span><br><span class="line"><span class="function"><span class="title">divide</span> = <span class="title">func</span><span class="params">(a,b <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>,error)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a/b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>方法(可以依附在任何的資料型態上面，有點像 js)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  g:=greeter&#123;</span><br><span class="line">    name:=<span class="string">"stanley"</span></span><br><span class="line">  &#125;</span><br><span class="line">  g.greet() <span class="comment">//stanley</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> greeter stuct&#123;</span><br><span class="line">  name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g greeter)</span> <span class="title">greet</span><span class="params">()</span></span>&#123;</span><br><span class="line">  fmt.Println(<span class="string">"hello"</span>,g.name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Interfaces"><a href="#Interfaces" class="headerlink" title="Interfaces"></a>Interfaces</h1><ul>
<li><p>命名習慣 通常是動詞加上 er</p>
</li>
<li><p>struct 裡面會放資料</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//宣告 Writer 類型的變數</span></span><br><span class="line">  <span class="keyword">var</span> w Writer = ConsoleWriter&#123;&#125;<span class="comment">//達成多型</span></span><br><span class="line">  w.Write([]<span class="keyword">byte</span>) (<span class="keyword">int</span> ,error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">  Write([]<span class="keyword">byte</span>) (<span class="keyword">int</span>,error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> ConsoleWriter <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 這作法很強大，因為你不需要在設計接端就抽出個interface，因為你隨時都可以加個方法進一個資料型態，只要你可以加方法進去，就代表隨時都可以加個interface</span></span><br><span class="line"><span class="comment">// 將Write依附在cw，讓ConsoleWriter有write這個方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cw ConsoleWriter)</span> <span class="title">Write</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>,error)</span></span>&#123;</span><br><span class="line">  n,err := fmt,Println(<span class="keyword">string</span>(data))</span><br><span class="line">  <span class="keyword">return</span> n,err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>embeding interface(組合 interface)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>&#123;</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"bytes"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> wc WriterCloser = NewBufferWritterCloser()</span><br><span class="line">  wc.Write([]<span class="keyword">byte</span>(<span class="string">"Hello my name is stanley"</span>))</span><br><span class="line">  wc.Close()</span><br><span class="line">  bwc := wc.(*BufferedWriterCloser) <span class="comment">//type conversion 用這語法可轉型態</span></span><br><span class="line">  fmt.Println(bwc)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">  Write([]<span class="keyword">byte</span>) (<span class="keyword">int</span>,error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Closer <span class="keyword">interface</span> &#123;</span><br><span class="line">  Close() error <span class="comment">//return error</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> WriteCloser <span class="keyword">interface</span> &#123;</span><br><span class="line">  Writer</span><br><span class="line">  Closer</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> BufferedWriteClose <span class="keyword">struct</span> &#123;</span><br><span class="line">  buffer *bytes.Buffer</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bwc *BufferedWriterCloser)</span> <span class="title">Write</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>,error)</span></span>&#123;</span><br><span class="line">  n,err := bwc.buffer.Write(data)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">  &#125;</span><br><span class="line">  v:=<span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="number">8</span>)</span><br><span class="line">  <span class="keyword">for</span> bwc.buffer.Len()&gt;<span class="number">8</span>&#123;</span><br><span class="line">    _,err := bwc.buffer.Read(v)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">    &#125;</span><br><span class="line">    _,err=fmt.Println(<span class="keyword">string</span>(v))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>,err</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> n,<span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(bwc *BufferedWriteCloser)</span> <span class="title">Close</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> bwc.buffer.Len()&gt;<span class="number">0</span>&#123;</span><br><span class="line">    data:=bwc.buffer.Next(<span class="number">8</span>)</span><br><span class="line">    _,err := fmt.Println(<span class="keyword">string</span>(data))</span><br><span class="line">    <span class="keyword">if</span> err !=<span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewBufferWriterCloser</span><span class="params">()</span> *<span class="title">BufferWriterCloser</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;BufferedWriterCloser&#123;</span><br><span class="line">    buffer:bytes.NewBuffer([]bytes&#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>類型轉換</p>
<ul>
<li>empty interface 沒有方法的 interface，所以的類型都實作這個界面，有點像是 any？</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 然而實際上這界面沒有方法，所以你要不就是利用反射，要不就是要做類型轉換，才能知道你用的是什物件，才能運用這個物件</span></span><br><span class="line"><span class="keyword">var</span> myObj <span class="keyword">interface</span>&#123;&#125; = NewBufferedWriterCloser()</span><br><span class="line"><span class="keyword">if</span> wc,ok := myObj.(WriterCloser);ok&#123;</span><br><span class="line">  wc.Write([]<span class="keyword">byte</span>(<span class="string">"Hello my name is stanley"</span>))</span><br><span class="line">  wc.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>type switches 在 switch 的章節有講到，需要用到 empty interface</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i <span class="keyword">interface</span>&#123;&#125; = <span class="number">0</span></span><br><span class="line"><span class="keyword">switch</span> i.(<span class="keyword">type</span>)&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">int</span> :</span><br><span class="line">    fmt.Println(<span class="string">"i is an int"</span>)</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">float64</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is a float64"</span>)</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">string</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is string"</span>)</span><br><span class="line">  <span class="keyword">case</span> [<span class="number">3</span>]<span class="keyword">int</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is [3]int"</span>)</span><br><span class="line">    <span class="keyword">break</span> <span class="comment">//breaking out early</span></span><br><span class="line">    fmt.Println(<span class="string">"other stuff"</span>)</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    fmt.Println(<span class="string">"i is another type"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>實例值和指標</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>&#123;</span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">  <span class="string">"bytes"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> wc WriterCloser = &amp;myWritterCloser() <span class="comment">// 加上&amp; 其method就可以是value reciver 或 pointer reciver，但如我們所說，操作pointer 的時候要小心改到資料</span></span><br><span class="line">  fmt.Println(wc)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Writer <span class="keyword">interface</span> &#123;</span><br><span class="line">  Write([]<span class="keyword">byte</span>) (<span class="keyword">int</span>,error)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Closer <span class="keyword">interface</span> &#123;</span><br><span class="line">  Close() error <span class="comment">//return error</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> WriteCloser <span class="keyword">interface</span> &#123;</span><br><span class="line">  Writer</span><br><span class="line">  Closer</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> myWriteClose <span class="keyword">struct</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mwc *myWriteClose)</span> <span class="title">Write</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">int</span>,error)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n,<span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(mwc *myWriteClose)</span> <span class="title">Close</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最佳實踐 //todo 以下筆記需要實作後才能領悟，所以目前的筆記有可能是理解錯誤的</p>
<ul>
<li>使用多而小的 interface</li>
<li>不要將會被使用類型的界面匯出，讓使用者自訂界面，讓他們選想要的方法</li>
<li>將會被套件使用到的類型界面匯出 因為 go 可延遲界面的實作，所以讓使用者實例你的界面，拿到你需要的類型</li>
<li>製作接收使用者自訂界面的 function</li>
</ul>
</li>
</ul>
<h1 id="併發"><a href="#併發" class="headerlink" title="併發"></a>併發</h1><p>在多數的語言裡面，開線程是相當耗費資源的，但對 go 來講並不會，你甚至可以看到有上千個線程的進程在跑，這在別種語言幾乎是不可能的，因為別種語言的線程是建立在 os 之上，每個線程幾乎都要佔 1mb 的堆，然而 go 則是利用現有的線程，看哪個有空用哪個，所以省資源</p>
<ul>
<li>go routine</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> msg = <span class="string">"hello"</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span>&#123;</span><br><span class="line">    fmt.Println(msg)</span><br><span class="line">  &#125;()</span><br><span class="line">  msg = <span class="string">"goodbye"</span></span><br><span class="line">  time.Sleep(<span class="number">100</span>*time.Millisecond)<span class="comment">// 因為go routine會來不急執行，所以加這句</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// goodbye  你可以看出，即便線程是在另一個堆，closure可以仍取到外面的變數，但是這樣有個缺點，this is what we call race condition，你可以發現go routine在sleep之後執行</span></span><br><span class="line"><span class="comment">// go run -race src/main.go 可以檢查是否有race condition</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> msg = <span class="string">"hello"</span></span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span> <span class="params">(msg <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">    fmt.Println(msg)</span><br><span class="line">  &#125;(msg)</span><br><span class="line">  msg = <span class="string">"goodbye"</span></span><br><span class="line">  time.Sleep(<span class="number">100</span>*time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// hello  在這裡我們複製了一份，利用傳值的方式，做解偶</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>waitgroup</p>
<ul>
<li>同步兩個線程<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg = sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> msg = <span class="string">"hello"</span></span><br><span class="line">  wg.Add(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span> <span class="params">(msg <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">    fmt.Println(msg)</span><br><span class="line">    wg.Done() <span class="comment">//會自動減1，讓go知道，沒有其他線程</span></span><br><span class="line">  &#125;(msg)</span><br><span class="line">  msg = <span class="string">"goodbye"</span></span><br><span class="line">  wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// hello  在這裡我們複製了一份，利用傳值的方式，做解偶</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>mutex</p>
<ul>
<li><p>同步多個線程</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  runtime.GOMAXPROC(<span class="number">100</span>)</span><br><span class="line">  fmt.Printf(<span class="string">"Threads:%v\n"</span>,runtime.GOMAXPROCS(<span class="number">-1</span>))<span class="comment">//印出上一個設定線程的數量，在預設上，go會預設以電腦cup核心數目相同的線程</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">import</span>(</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">    <span class="string">"runtime"</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">var</span> wg = sync.WaitGroup&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line">  <span class="keyword">var</span> m = sync.RWMutex&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    runtime.GOMAXPROCS(<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">for</span> i :=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">      wg,Add(<span class="number">2</span>)</span><br><span class="line">      m.RLock()</span><br><span class="line">      <span class="keyword">go</span> sayHello()</span><br><span class="line">      m.Lock()</span><br><span class="line">      <span class="keyword">go</span> increment()</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Hello #%v\n"</span>,counter)</span><br><span class="line">    m.RUnlock()</span><br><span class="line">    wg.Done()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">()</span></span>&#123;</span><br><span class="line">    counter++</span><br><span class="line">    m.Unlock()</span><br><span class="line">    wg.Done()</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 以上所有的作法都讓go routine的好處消失，變成單線程的程式，這樣倒不如直接不用go routine，一般來說多線程也都是在處理不同的事，然而萬一真的有共享的資料，mutex就是用在這時候</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h1 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h1><ul>
<li>可以解決上述資料共用的混亂</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg = sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ch:=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// 初始化channel所能接收或發出的資料型態</span></span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span>&#123; <span class="comment">//reciving data</span></span><br><span class="line">    i:=&lt;- ch</span><br><span class="line">    fmt.Println(i)</span><br><span class="line">    wg.Done()</span><br><span class="line">  &#125;(ch)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span>&#123; <span class="comment">// sendgin data</span></span><br><span class="line">    ch&lt;<span class="number">-42</span></span><br><span class="line">    wg.Done()</span><br><span class="line">  &#125;(ch)</span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg = sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ch:=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">  <span class="keyword">for</span> j:=<span class="number">0</span>;j&lt;<span class="number">5</span>;j++&#123;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">      i:=&lt;- ch</span><br><span class="line">      fmt.Println(i)</span><br><span class="line">      wg.Done()</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">      ch&lt;<span class="number">-42</span></span><br><span class="line">      wg.Done()</span><br><span class="line">    &#125;()</span><br><span class="line">  &#125;</span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>close channel</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg = sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  ch:=<span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>,<span class="number">50</span>) <span class="comment">// 初始化channel所能接收或發出的資料型態</span></span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span>&#123; <span class="comment">//reciving data</span></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> i,ok :=&lt;-ch;ok&#123;</span><br><span class="line">        fmt.Println(i)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Done()</span><br><span class="line">  &#125;(ch)</span><br><span class="line">  <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span>&#123; <span class="comment">// sendgin data</span></span><br><span class="line">    ch&lt;<span class="number">-42</span></span><br><span class="line">    ch&lt;<span class="number">-27</span></span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line">    wg.Done()</span><br><span class="line">  &#125;(ch)</span><br><span class="line">  wg.Wait()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>select</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  logInfo = <span class="string">"INFO"</span></span><br><span class="line">  logWarning = <span class="string">"WARNING"</span></span><br><span class="line">  logError = <span class="string">"ERROR"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> logEntry <span class="keyword">struct</span>&#123;</span><br><span class="line">  time time.Time</span><br><span class="line">  severity <span class="keyword">string</span></span><br><span class="line">  message <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> logCh = <span class="built_in">make</span>(<span class="keyword">chan</span> logEntry,<span class="number">50</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">go</span> logger()</span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">close</span>(logCh)</span><br><span class="line">  &#125;()</span><br><span class="line">  logCh &lt;- logEntry&#123;</span><br><span class="line">    time.Now(),</span><br><span class="line">    logInfo,</span><br><span class="line">    <span class="string">"App is starting"</span></span><br><span class="line">  &#125;</span><br><span class="line">  logCh &lt;- logEntry&#123;</span><br><span class="line">    time.Now(),</span><br><span class="line">    logInfo,</span><br><span class="line">    <span class="string">"App is shutting down"</span></span><br><span class="line">  &#125;</span><br><span class="line">  time.Sleep(<span class="number">100</span>*time.Millisecond)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">logger</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> entry := <span class="keyword">range</span> logCh&#123;</span><br><span class="line">    fmt.Printf(<span class="string">"%v - [%v]%v\n"</span>,entry.time.Format(<span class="string">"2006-01-02"</span>,entry.severity,entry.message))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  logInfo = <span class="string">"INFO"</span></span><br><span class="line">  logWarning = <span class="string">"WARNING"</span></span><br><span class="line">  logError = <span class="string">"ERROR"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> logEntry <span class="keyword">struct</span>&#123;</span><br><span class="line">  time time.Time</span><br><span class="line">  severity <span class="keyword">string</span></span><br><span class="line">  message <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> logCh = <span class="built_in">make</span>(<span class="keyword">chan</span> logEntry,<span class="number">50</span>)</span><br><span class="line"><span class="keyword">var</span> doneCh = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">go</span> logger()</span><br><span class="line">  logCh &lt;- logEntry&#123;</span><br><span class="line">    time.Now(),</span><br><span class="line">    logInfo,</span><br><span class="line">    <span class="string">"App is starting"</span></span><br><span class="line">  &#125;</span><br><span class="line">  logCh &lt;- logEntry&#123;</span><br><span class="line">    time.Now(),</span><br><span class="line">    logInfo,</span><br><span class="line">    <span class="string">"App is shutting down"</span></span><br><span class="line">  &#125;</span><br><span class="line">  time.Sleep(<span class="number">100</span>*time.Millisecond)</span><br><span class="line">  doneCh &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">logger</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="keyword">select</span>&#123; <span class="comment">// 整個段落會阻塞，直到我們收到需要的channel</span></span><br><span class="line">      <span class="keyword">case</span> entry := &lt;-logCh:</span><br><span class="line">        fmt.Printf(<span class="string">"%v - [%v]%v\n"</span>,entry.time.Format(<span class="string">"2006-01-02"</span>,entry.severity,entry.message))</span><br><span class="line">      <span class="keyword">case</span> &lt;-doneCh:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/12/02/%E4%BD%BF%E7%94%A8cdn/" rel="prev" title="使用cdn">
                  <i class="fa fa-chevron-left"></i> 使用cdn
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/02/08/JQuery/" rel="next" title="JQuery的奇巧淫計">
                  JQuery的奇巧淫計 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Stanley Ke</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 強力驅動
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  















  








  

  

</body>
</html>
