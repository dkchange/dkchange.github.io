---
title: 使用cdn
date: 2020-12-02 10:11:51
tags:
categories:
---

# 前言

因為公司有自建 cdn，是藉由 nginx 來達成的，所以就看一下 code 來了解大概脈絡

一致性：如何多節點環存一致
可靠性：如何保證不故障，故障如何自動備援 恢復
持久性：如何保證永久更新

為了達成以上幾個點，我們會需要一些功能，

1. 需要一個後台來管理眾多 cdn，
2. 我們 cdn 的 nginx 的設定檔，也都需要透過這後台來生
3. 我一個新的 cdn 的 ip 輸入進這個後台，選擇這個 cdn 所屬的群組，按下佈署，整個環境就會自動建置完畢，cdn 自己就會去原本的節點拉取資料
4. 要能夠清除 cdn 快取的資料

那其實我很好奇，下面這些偵測打包的程式是要幹什麼的？是為了 windows 平台而專門做的一個 cron 嗎？

有一個常駐的程式監控某一個特定的資料夾，用 7z 來打包新的檔案，定時的刪除打包的數據，這些互動都透過 php 的 exec 函式來跟程式碼互動，
max_user_watches 系統參數要調大

然而 windows 主機的話，就要有一個排程，定時檢查看看有沒有新版本
