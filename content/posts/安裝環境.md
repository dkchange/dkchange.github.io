---
title: 安裝環境
date: 2019-12-21 20:22:50
tags:
categories:
---

# 前言

事情是這樣子的，以前從 windows 環境就安裝 AppServ、WampServer、Xampp 這種快速安裝的安裝包，為什麼呢?
因為最後環境還是會在 linux 上，所以 windows 上能開發就好，也就不用太講究了，因為有些包在 linux 沒問題，在 windows 會出事，
心血來潮試著自己安裝一次看看

# 名詞解釋

- X86 X32
  我們要安裝 PHP 時就會看到一些不懂的名詞
  x86 等於 32 位元
  X64 等於 64 位元
  為何這樣奇怪的命名就是歷史因素了

- Thread Safe
- None Thread Safe
  線程安全和非線程安全，這就牽扯到比較複雜的因素了，有時間看看https://www.awaimai.com/88.html
  阿因為我們開發機，先不考慮線程安全和效能，任 1 種皆可

# php.ini 時區設定的問題

如果你是跑 php-fpm 那設定在/etc/php.ini 的時區你會吃不到，此時就要跑去
/etc/php-fpm.d/www.conf 加上

```conf
php_admin_value[date.timezone] = Europe/Berlin

```

# 遭遇問題

今天打開 Xampp 試著開啟 mysql 服務的時候，程序出錯
Error: MySQL shutdown unexpectedly.

打開日誌看不出個什麼鬼，只知道突然中斷
日誌都是正常的紀錄
然後就開始爬文
https://blog.csdn.net/yuer_xiao/article/details/79236719

    在mysql/bin/my.ini 文件 加一个：
    [mysqld]
    innodb_force_recovery = 4

失敗

    把xampp\mysql\data下的ibdata1文件删掉
    這有人說這文件很重要，但是我還是試試看

失敗

    用管理员启动命令行，进入mysql的bin目录，输入
    mysqld --install，回车
    net start mysql ，可以正常启动

失敗

    將ib_logfile0以及ib_logfile1這兩個日誌黨刪除,

失敗
把 xampp/mysql/backup/ 底下所有檔案，複製取代到 xampp/mysql/data/ ...
成功
https://dotblogs.com.tw/mepowerlmay/2019/12/19/085908

# 403 forbidden

除了在 nginx 有設定以外，如果本身資料加權限 84nginx 的進程使用者也會報錯

# Noinput file specified

找不到檔案，很可能就是 nginx 的正則錯了

# XDebug 環境配置

https://segmentfault.com/a/1190000011907425

ubutu 安裝 php xdebug
sudo apt-get install php-xdebug
sudo phpenmod xdebug
sudo gedit /etc/php/7.3/mods-available/xdebug.ini
重啟 webserver

[Debugging PHP on Linux with Xdebug and PHPStorm](https://youtu.be/3idASlzGTg4)
有三種方式

1. 在瀏覽器 url 打上參數
2. 用 phpstorm 網站提供的書籤
3. 安裝 chrome 插件
   https://stackoverflow.com/questions/46263043/how-to-setup-docker-phpstorm-xdebug-on-ubuntu-16-04
   https://www.youtube.com/watch?v=mahIIF0c8Zo
   use 'xdebug.remote_host=host.docker.internal' better than hard code IP address.
   但是 linux 版本要看有沒有支援
   xdebug.remote_host=docker.for.mac.localhost ，我是这样配置的可以调用成功
   這個方法也是要看 mac 版本
   Docker on Linux allows Xdebug to automatically connect back to the host system so you can just set xdebug.remote_connect_back=1 and leave out the xdebug.remote_host in your xdebug.ini.
   這個方法沒事過

linux 不支援 host.docker.internal 可以看這裡
https://dev.to/bufferings/access-host-from-a-docker-container-4099

# nginx 设定

https://blog.51cto.com/13930997/2311716

https://regex101.com/

## domain name

如果你記自己的測試機是以 xxx.localhost 來當 domain 的話，那你的 hosts 的檔就可以不用改了，因為他自己會幫你導向本機

## index.php failed (13: Permission denied)

關閉 selinux 即可

setenforce 0

# apache 設定

## vhost

site-available 來設定 vhost
site-enabled 是 apache 自己產生的，不要手動去改他

> sudo a2ensite vhost_domain_name
> site-enabled 就會產生出對應的檔案了

# 502 Bad Gateway

https://www.centos.bz/2017/07/nginx-php-fpm-502-error/

https://serverfault.com/questions/457911/nginx-php-fpm-502-bad-gateway
發生這個問題的原因有很多，之前還有可能是 cdn 快取導致頁面一直出現這個錯誤

# Apache2 conf 設定檔中文版

https://sites.google.com/site/linuxcooltea/apache2/a
這篇詳細解釋 conf 內容，對於我們這種非網管人員幫助很大
