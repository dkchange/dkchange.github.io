---
title: 專案交付相關
date: 2020-05-15 14:30:58
tags:
categories:
---

# 專案環境解說

- 架構圖
- 各環境版本
  - 語言
  - 框架
  - 資料庫相關套件
  - 資料庫
  - 快取技術
  - 版控軟體
- 文件
  - api 文件
  - 傳輸格式 json
  - 協定 ws http
  - status code
  - error code
  - DB Schema 文件

## DB Schema 文件

專案完成後，再由 DB Schema 轉成文件
[Postgres SQL 用 SELECT 語法取得 Table Schema](http://akuma1.pixnet.net/blog/post/358796858-postgres-sql-%e7%94%a8-select%e8%aa%9e%e6%b3%95%e5%8f%96%e5%be%97table-schema)

# 大架構程式設計

參考：
[大架構程式設計](http://akuma1.pixnet.net/blog/category/6529490)
[Web 開發－資深工程師的經驗](https://docs.google.com/document/d/1qsIP6hX0OPkgNQiSxTIJCjvAJNOTi0XrkjbOJ4giJ0M/edit)

q：當程式寫好之後，可以同時接受多少併發量？
a：用 jmeter 測試

a 測試完之後如何解決？
q： 1. 硬體擴充，但是會有硬體限制（實際上擴充的有限，例如一台電腦記憶體插槽就是那幾個） 2. 多台電腦達成服務（大架構的程式設計）

大架構程式設計

- request : 由於 http 的特性，第一次請求和第二次請求，由不同機器處理是 ok 的
- session : 不同機器如何共用 session
- Application ：應用程式，不會變的資料每台機器都一樣

## 分流 Load Balance（負載平衝）設計

由一台 loading balance 的機器來和後端各 server 做溝通，用 cpu 或記憶體用量來判斷 server 是否忙碌，用簡單的網頁做回應看服務是否正常

- persistence 所有請求導到固定的機器會遇到的情況
  - 使用情境當分流的 server 已經都滿了，突然增加機器能否把人導到新的機器上？ 無法，因為 loading balance 的機器已經被固定導到這 5 台
  - 假設其中一台掛掉，使用者被分流到其他機器上的 session 無法運作
- affinity 每次請求導到任意一台機器會遇到的情況
  - 使用者被分流到其他機器上的 session 無法運作

## 共用 session

為了解決上述共用的問題

- Cluster 叢集
  將多台相同功能的機器，連在一起，webwever 會提供設定，設定完叢集就可以達成 session 共用
- 第三方軟體
  例如：memcached , AWS dynamoDB
- 自行設計 session
  存在資料庫，要知道銷毀的時機,配合語言的建立，更新，查詢

## 共用資料庫

- 資料庫叢集
  也需要一台負載平衡
  由於同時寫入可能會讓資料庫出現問題
  所以必須確保資料寫都在同 1 台，讀在另外幾台，不能有兩台個別寫的動作，會讓同步的邏輯變複雜，資料先後會有問題，所以由 loading balance 區分讀寫
  - loading balance 可以判斷 sql 語句，
  - 或者是用連到 loading balance port 號，寫程式來做變更對應不同資料庫,loading balace 再去對應資料庫
- 異地備援

## 自動彈性化 auto scaling

一般來說主機如果是租的，是不會閒閒開個 5 台這那邊燒錢，一定是沒在用就關掉，需要時再開啟

- 監看程式
- 映像檔
  因為叢集架構會有 master 和 slaver，所以當一台虛擬機開啟服務時，就要自動化作設定，如果想避免這類的自動化設定，共用 session 可能就要用第三方軟體(redis 之類)，這樣就可以 vm 一開就正常服務

# 例外狀況

流量跟預想的差太多，造成伺服器過度繁忙，甚至排擠到 Load Balance 來確認機器是否正常運行，造成明明機器是正常運行的，但是 Load Balance 判斷機器已掛點，所以 Auto Scaling 自動幫機器重啟，或是閉關此台機器，重新開啟一台新的機器來進行服務
因為它的流量是突然發生的，而不是緩緩上昇的，才會造成機器的誤判；所以，一般如果公司要舉辦活動，會預先評估或假設，預計有多少人連線進入、需要有多少台機器先開機等待之類的，一般會先行完成這些事情，來減低使用者在連線上造成的不愉快。
