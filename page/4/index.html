<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dkchange.github.io","root":"/","scheme":"Muse","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜尋...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="蛋粒個人網誌">
<meta property="og:url" content="http:&#x2F;&#x2F;dkchange.github.io&#x2F;page&#x2F;4&#x2F;index.html">
<meta property="og:site_name" content="蛋粒個人網誌">
<meta property="og:locale" content="zh-TW">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://dkchange.github.io/page/4/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-TW'
  };
</script>

  <title>蛋粒個人網誌</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">蛋粒個人網誌</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Stanley Ke</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/05/21/%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B%E8%88%87%E6%BC%94%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/21/%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B%E8%88%87%E6%BC%94%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">資料結構與演算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-05-21 13:44:30" itemprop="dateCreated datePublished" datetime="2020-05-21T13:44:30+08:00">2020-05-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-09-02 13:16:31" itemprop="dateModified" datetime="2021-09-02T13:16:31+08:00">2021-09-02</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BB%BB%E4%BD%95%E8%B7%AF%E7%B7%9A/" itemprop="url" rel="index"><span itemprop="name">任何路線</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>這筆記為開放式課程筆記 目的在補足大學時代的不認真<br>資料結構在對程式設計師的身涯有什麼好處，佔怎樣的地位呢<br>找出最有效率的演算法<br>system life cycle</p>
<ul>
<li>需求</li>
<li>分析</li>
<li>設計</li>
<li>細分寫 CODE</li>
<li>驗證</li>
</ul>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul>
<li>data abstraction</li>
<li>algorithm specification<br>資料結構和演算法關係密切，你的演算法要用怎樣的資料結構來實作，效能會比較好？<br>演算法就是解決問題的方法，跟你是哪一種語言沒有關係</li>
</ul>
<h1 id="最簡單的演算法-sort"><a href="#最簡單的演算法-sort" class="headerlink" title="最簡單的演算法 sort"></a>最簡單的演算法 sort</h1><ul>
<li><p>selection sort<br>每一次從一堆數字取最大的出來 放在第一個位置…第二個位置<br>那如何選出最大?拿第一個數字來跟一堆數字比 比我大就跟你做交換 最後地一個位置就會是最大的</p>
</li>
<li><p>bubble sort</p>
</li>
<li><p>quick sort</p>
</li>
</ul>
<h1 id="以數字為例作搜索-binary-search"><a href="#以數字為例作搜索-binary-search" class="headerlink" title="以數字為例作搜索 binary search"></a>以數字為例作搜索 binary search</h1><p>和二元樹不同，這是一個演算法，先決條件是此數列已經排序過了</p>
<h1 id="遞迴演算法"><a href="#遞迴演算法" class="headerlink" title="遞迴演算法"></a>遞迴演算法</h1><ul>
<li>n 階層</li>
<li>乘法</li>
</ul>
<h1 id="作業"><a href="#作業" class="headerlink" title="作業"></a>作業</h1><ul>
<li>試著用 recursive 做 abc 排列組合</li>
<li>試著用 for 做 abc 排列組合</li>
</ul>
<h1 id="performance-evaluation"><a href="#performance-evaluation" class="headerlink" title="performance evaluation"></a>performance evaluation</h1><ul>
<li>無關機器的評估</li>
<li>有機器的評估</li>
</ul>
<h1 id="效能分析"><a href="#效能分析" class="headerlink" title="效能分析"></a>效能分析</h1><p>這邊蠻重視數學的<br>log？ n 次方程式？</p>
<ul>
<li><p>時間複雜度<br>編譯時間+input 所影響的時間<br>一般來講就是程式預計要走幾步</p>
<ul>
<li>大寫的英文字母 O (big oh)函數，代表演算法執行步驟數目上限；</li>
<li>大寫的希臘字母 Ω (Omega)函數，代表下限；</li>
<li>大寫的希臘字母 Θ (Theta)函數，代表同時滿足上限與下限<br>那我們通常用的是 O<br>f(n)&lt;=cg(n)</li>
</ul>
</li>
<li><p>空間複雜度(佔用多少記憶體)<br>code 的大小+input 的量所影響的空間</p>
</li>
</ul>
<h1 id="陣列"><a href="#陣列" class="headerlink" title="陣列"></a>陣列</h1><p>定義：一組索引(index)和值(value)的集合<br>資料結構：一個索引對應一個值<br>實作：在電腦裡面用連續空間來存放<br>應用例子：矩陣、多項式、字串</p>
<h1 id="stack-a-last-in-first-out-list"><a href="#stack-a-last-in-first-out-list" class="headerlink" title="stack: a last in first out list"></a>stack: a last in first out list</h1><p>定義：有限的元素<br>實作：用陣列來實作<br>應用例子：老鼠走迷宮</p>
<h1 id="queue-a-first-in-first-out-list"><a href="#queue-a-first-in-first-out-list" class="headerlink" title="queue: a first in first out list"></a>queue: a first in first out list</h1><p>定義：有限的元素 多了兩個變數指向 font 前面 rear 後面<br>實作：用陣列來實作<br>應用例子：job scheduling</p>
<h1 id="circular-queue"><a href="#circular-queue" class="headerlink" title="circular queue"></a>circular queue</h1><p>定義：實質上還是一長列的 queue<br>實作：用 queue 實現<br>好處：充分利用空間</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/05/15/%E5%B0%88%E6%A1%88%E4%BA%A4%E4%BB%98%E7%9B%B8%E9%97%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/15/%E5%B0%88%E6%A1%88%E4%BA%A4%E4%BB%98%E7%9B%B8%E9%97%9C/" class="post-title-link" itemprop="url">專案交付相關</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-05-15 14:30:58" itemprop="dateCreated datePublished" datetime="2020-05-15T14:30:58+08:00">2020-05-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-07-30 18:11:28" itemprop="dateModified" datetime="2021-07-30T18:11:28+08:00">2021-07-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="專案環境解說"><a href="#專案環境解說" class="headerlink" title="專案環境解說"></a>專案環境解說</h1><ul>
<li>架構圖</li>
<li>各環境版本<ul>
<li>語言</li>
<li>框架</li>
<li>資料庫相關套件</li>
<li>資料庫</li>
<li>快取技術</li>
<li>版控軟體</li>
</ul>
</li>
<li>文件<ul>
<li>api 文件</li>
<li>傳輸格式 json</li>
<li>協定 ws http</li>
<li>status code</li>
<li>error code</li>
<li>DB Schema 文件</li>
</ul>
</li>
</ul>
<h2 id="DB-Schema-文件"><a href="#DB-Schema-文件" class="headerlink" title="DB Schema 文件"></a>DB Schema 文件</h2><p>專案完成後，再由 DB Schema 轉成文件<br><a href="http://akuma1.pixnet.net/blog/post/358796858-postgres-sql-%e7%94%a8-select%e8%aa%9e%e6%b3%95%e5%8f%96%e5%be%97table-schema" target="_blank" rel="noopener">Postgres SQL 用 SELECT 語法取得 Table Schema</a></p>
<h1 id="大架構程式設計"><a href="#大架構程式設計" class="headerlink" title="大架構程式設計"></a>大架構程式設計</h1><p>參考：<br><a href="http://akuma1.pixnet.net/blog/category/6529490" target="_blank" rel="noopener">大架構程式設計</a><br><a href="https://docs.google.com/document/d/1qsIP6hX0OPkgNQiSxTIJCjvAJNOTi0XrkjbOJ4giJ0M/edit" target="_blank" rel="noopener">Web 開發－資深工程師的經驗</a></p>
<p>q：當程式寫好之後，可以同時接受多少併發量？<br>a：用 jmeter 測試</p>
<p>a 測試完之後如何解決？<br>q： 1. 硬體擴充，但是會有硬體限制（實際上擴充的有限，例如一台電腦記憶體插槽就是那幾個） 2. 多台電腦達成服務（大架構的程式設計）</p>
<p>大架構程式設計</p>
<ul>
<li>request : 由於 http 的特性，第一次請求和第二次請求，由不同機器處理是 ok 的</li>
<li>session : 不同機器如何共用 session</li>
<li>Application ：應用程式，不會變的資料每台機器都一樣</li>
</ul>
<h2 id="分流-Load-Balance（負載平衝）設計"><a href="#分流-Load-Balance（負載平衝）設計" class="headerlink" title="分流 Load Balance（負載平衝）設計"></a>分流 Load Balance（負載平衝）設計</h2><p>由一台 loading balance 的機器來和後端各 server 做溝通，用 cpu 或記憶體用量來判斷 server 是否忙碌，用簡單的網頁做回應看服務是否正常</p>
<ul>
<li>persistence 所有請求導到固定的機器會遇到的情況<ul>
<li>使用情境當分流的 server 已經都滿了，突然增加機器能否把人導到新的機器上？ 無法，因為 loading balance 的機器已經被固定導到這 5 台</li>
<li>假設其中一台掛掉，使用者被分流到其他機器上的 session 無法運作</li>
</ul>
</li>
<li>affinity 每次請求導到任意一台機器會遇到的情況<ul>
<li>使用者被分流到其他機器上的 session 無法運作</li>
</ul>
</li>
</ul>
<h2 id="共用-session"><a href="#共用-session" class="headerlink" title="共用 session"></a>共用 session</h2><p>為了解決上述共用的問題</p>
<ul>
<li>Cluster 叢集<br>將多台相同功能的機器，連在一起，webwever 會提供設定，設定完叢集就可以達成 session 共用</li>
<li>第三方軟體<br>例如：memcached , AWS dynamoDB</li>
<li>自行設計 session<br>存在資料庫，要知道銷毀的時機,配合語言的建立，更新，查詢</li>
</ul>
<h2 id="共用資料庫"><a href="#共用資料庫" class="headerlink" title="共用資料庫"></a>共用資料庫</h2><ul>
<li>資料庫叢集<br>也需要一台負載平衡<br>由於同時寫入可能會讓資料庫出現問題<br>所以必須確保資料寫都在同 1 台，讀在另外幾台，不能有兩台個別寫的動作，會讓同步的邏輯變複雜，資料先後會有問題，所以由 loading balance 區分讀寫<ul>
<li>loading balance 可以判斷 sql 語句，</li>
<li>或者是用連到 loading balance port 號，寫程式來做變更對應不同資料庫,loading balace 再去對應資料庫</li>
</ul>
</li>
<li>異地備援</li>
</ul>
<h2 id="自動彈性化-auto-scaling"><a href="#自動彈性化-auto-scaling" class="headerlink" title="自動彈性化 auto scaling"></a>自動彈性化 auto scaling</h2><p>一般來說主機如果是租的，是不會閒閒開個 5 台這那邊燒錢，一定是沒在用就關掉，需要時再開啟</p>
<ul>
<li>監看程式</li>
<li>映像檔<br>因為叢集架構會有 master 和 slaver，所以當一台虛擬機開啟服務時，就要自動化作設定，如果想避免這類的自動化設定，共用 session 可能就要用第三方軟體(redis 之類)，這樣就可以 vm 一開就正常服務</li>
</ul>
<h1 id="例外狀況"><a href="#例外狀況" class="headerlink" title="例外狀況"></a>例外狀況</h1><p>流量跟預想的差太多，造成伺服器過度繁忙，甚至排擠到 Load Balance 來確認機器是否正常運行，造成明明機器是正常運行的，但是 Load Balance 判斷機器已掛點，所以 Auto Scaling 自動幫機器重啟，或是閉關此台機器，重新開啟一台新的機器來進行服務<br>因為它的流量是突然發生的，而不是緩緩上昇的，才會造成機器的誤判；所以，一般如果公司要舉辦活動，會預先評估或假設，預計有多少人連線進入、需要有多少台機器先開機等待之類的，一般會先行完成這些事情，來減低使用者在連線上造成的不愉快。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/05/15/%E8%B3%87%E6%96%99%E5%BA%AB%E7%9B%B8%E9%97%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/15/%E8%B3%87%E6%96%99%E5%BA%AB%E7%9B%B8%E9%97%9C/" class="post-title-link" itemprop="url">資料庫相關</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-05-15 09:09:20" itemprop="dateCreated datePublished" datetime="2020-05-15T09:09:20+08:00">2020-05-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2025-04-04 22:50:49" itemprop="dateModified" datetime="2025-04-04T22:50:49+08:00">2025-04-04</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BE%8C%E7%AB%AF%E8%B7%AF%E7%B7%9A/" itemprop="url" rel="index"><span itemprop="name">後端路線</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BE%8C%E7%AB%AF%E8%B7%AF%E7%B7%9A/%E9%97%9C%E8%81%AF%E5%BC%8F%E8%B3%87%E6%96%99%E5%BA%AB/" itemprop="url" rel="index"><span itemprop="name">關聯式資料庫</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="何謂資料工程師"><a href="#何謂資料工程師" class="headerlink" title="何謂資料工程師"></a>何謂資料工程師</h1><p><a href="https://ithelp.ithome.com.tw/articles/10234925" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/articles/10234925</a></p>
<h1 id="索引資料結構"><a href="#索引資料結構" class="headerlink" title="索引資料結構"></a>索引資料結構</h1><p>一文了解数据库索引：哈希、B-Tree 与LSM</p>
<h1 id="Mysql的DB引擎"><a href="#Mysql的DB引擎" class="headerlink" title="Mysql的DB引擎"></a>Mysql的DB引擎</h1><p>MyISAM與InnoDB</p>
<h1 id="postgres的命名規則"><a href="#postgres的命名規則" class="headerlink" title="postgres的命名規則"></a>postgres的命名規則</h1><p>資料表的命名方面，很多框架都依循著資料表的命名應該是單數，這個不成文規定，所以在 yii 框架的資料表 user 資料表是單數命名<br>laravel 的 model 也會是單數命名，然後會假設資料表為複數命名</p>
<p>但是在 postgres 裡面</p>
<p>user 不能當作 table 的名字，是保留字</p>
<p>如果要用的話，就一定要加雙引號 “user” ，所以表的名子如果是 users 情況會簡單些</p>
<p>所以其實資料表的命名就視情況而定吧</p>
<p>題外話：restapi 的命名規則，url 呈現的會是複數 users</p>
<h1 id="如何定義主鍵-primary-key"><a href="#如何定義主鍵-primary-key" class="headerlink" title="如何定義主鍵 primary key"></a>如何定義主鍵 primary key</h1><p><a href="https://ithelp.ithome.com.tw/questions/10143595" target="_blank" rel="noopener">大家都是怎麼定義自己資料庫裡面的 primary key?</a></p>
<h1 id="正規化-Normalization"><a href="#正規化-Normalization" class="headerlink" title="正規化(Normalization)"></a>正規化(Normalization)</h1><p>降低資料的「重覆性」與避免「更新異常」的情況發生。<br>正規化的精神就是讓資料庫中重複的欄位資料減到最少，並且能快速的找到資料，以提高關聯性資料庫的效能。</p>
<p>第一考量：簡單就好。通常會先思考資料本身就能做 PK，那當然就用資料欄位。</p>
<p>第二考量：效率至上。資料量巨大、且有大量 join，那就考慮使用 auto increment 欄位當 PK。</p>
<p>第三考量：程式單純且易維護。資料本身需要三個以上的欄位才能做 PK，那也考慮用 auto increment 欄位當 PK。</p>
<p>第四考量：資料庫對 PK 或其它 index 有最佳化，那就看它 prefer 用什麼欄位。</p>
<ol>
<li>系統 OO 化.</li>
<li>小系統用 Int,流水號,不要用字串,int 是電腦處理基礎單位,所以排序,索引..最快 </li>
<li>分散式 DB 用 GUID 全世界每一個資料拋過來都不會沖到,而且是 Client 端,App 端產生</li>
<li>PK 給 App 給 DB 關聯看,所以只要不重複,容易電腦計算,如果給 Users 識別用,我會再用一組有規律的 Key 讓 Users 記</li>
</ol>
<h1 id="正規化規則"><a href="#正規化規則" class="headerlink" title="正規化規則"></a>正規化規則</h1><p>正規化的解釋名詞都相當晦澀，這個時候有例子，比較容易幫助理解，你會發現你設計資料表的同時，一般都已經符合到第三正規化</p>
<h2 id="第一正規化"><a href="#第一正規化" class="headerlink" title="第一正規化"></a>第一正規化</h2><ul>
<li>定義:<br>欄位的原子性，關聯式資料庫專屬，欄位的資料不能再分解</li>
<li>情境:<br>當一個欄位有機會存在著多筆資料時，無法事先得知欄位長度，因此，必須要預留很大的空間給這些欄位, 如此反而造成儲存空間的浪費</li>
<li>解決方法：<br>拆筆數<br>缺點:即第二正規劃會遇到的情境</li>
</ul>
<h2 id="第二正規化"><a href="#第二正規化" class="headerlink" title="第二正規化"></a>第二正規化</h2><ul>
<li>定義:<br>表中的紀錄是唯一的</li>
<li>情境:<br>當要對某欄位資料進行新增時，必須連同其他欄位也新增<br>更新時必須要複合多個欄位才能更新正確<br>刪除時，如果有紀錄該欄位的資料只有一筆，有可能直接抹除該欄位的資料</li>
<li>解決方法：<br>經過第一正規化之後再去除部份相依<br>設置主鍵或是複合鍵(唯一)<br>當一張表的多筆資料有許多欄位重複時,這張表有複合鍵時，其他欄位必須完全相依這兩個複合的欄位，拆表</li>
<li>缺點:會有資料重複</li>
</ul>
<h2 id="第三正規化"><a href="#第三正規化" class="headerlink" title="第三正規化"></a>第三正規化</h2><ul>
<li>定義:表中不要有冗餘的數據，如果能夠被推倒出來，就不單獨設計一個欄位來存放<br>去除遞移相依，就是與主鍵無關的欄位，非相依於主鍵的欄位</li>
<li>情境:單純設置主鍵，也是會有資料重複的問題</li>
<li>解決方法：劃分好欄位，拆表</li>
<li>缺點:過度正規劃，例如需要計算的欄位</li>
</ul>
<h1 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h1><h2 id="原子性（Atomicity）"><a href="#原子性（Atomicity）" class="headerlink" title="原子性（Atomicity）"></a>原子性（Atomicity）</h2><p>一個交易是一個單元工作,步驟要嘛全部執行成功，若有一個失敗，則整個交易宣告失敗</p>
<h2 id="一致性（Consistency）"><a href="#一致性（Consistency）" class="headerlink" title="一致性（Consistency）"></a>一致性（Consistency）</h2><p>交易要能夠 rollback</p>
<h2 id="隔離行為（Isolation-behavior）"><a href="#隔離行為（Isolation-behavior）" class="headerlink" title="隔離行為（Isolation behavior）"></a>隔離行為（Isolation behavior）</h2><p>交易與交易之間，必須互不干擾，好像同時間就只有自己的交易存在一樣,那這種隔離行為必須要和鎖來做搭配<br>以下情境都是建立在有交易，可能發生的狀況</p>
<p>然後對於單行的操作 insert update 沒有transation包起來的語句 ，DB預設都是會自動commit的，如果要關閉的話</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> autocommit=<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>參考：<br><a href="https://openhome.cc/Gossip/HibernateGossip/IsolationLevel.html" target="_blank" rel="noopener">簡介隔離層級</a><br><a href="https://segmentfault.com/a/1190000014133576" target="_blank" rel="noopener">MySQL InnoDB锁机制全面解析分享</a></p>
<p>沒有對資料庫進行鎖定可能出現的問題：</p>
<ul>
<li><p>更新遺失（lost update）<br>基本上就是指某個交易對<strong>欄位</strong>進行更新的資訊，因另一個交易的介入而遺失<br>會出現在可重複讀取RR(repeatable read)層級的情況，<br>例如：b 交易的 rollback 導致 a 交易的更新資料消失，因為回到 a 交易還沒更新的時候，但 a 因該要更新完  這種情況稱為(first lost update)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">交易 A 更新欄位 1</span><br><span class="line">交易 B 更新欄位 1</span><br><span class="line">交易 A COMMIT</span><br><span class="line">交易 B ROLLBACK</span><br></pre></td></tr></table></figure>
<p>例如：當兩個交易讀到同一欄位值，a 交易的 commit 導致 b 交易的更新資料消失，因為 a 交易延遲導致 b 交易結果被覆蓋，但 b 應該是最後結果(second lost update)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">交易 A 更新欄位 1</span><br><span class="line">交易 B 更新欄位 1</span><br><span class="line">交易 B COMMIT</span><br><span class="line">交易 A COMMIT</span><br></pre></td></tr></table></figure></li>
<li><p>髒讀（dirty read）<br>读到别的事务没有提交的数据<br>兩個交易同時進行，在其中一個交易更新資料前，另一個交易讀取了尚未 COMMIT 的資料<br>例如：a 交易的 rollback 讓 b 交易讀到未確認的資料</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">交易 A 更新欄位 1</span><br><span class="line">交易 B 讀取欄位 1</span><br><span class="line">交易 A ROLLBACK</span><br><span class="line">交易 B COMMIT</span><br></pre></td></tr></table></figure>
</li>
<li><p>無法重複的讀取（unrepeatable read）<br>前读取的数据，被别的事务改变了，再读就跟原来不一样了<br>某個交易在交易期間兩次讀取同一欄位的資料並不一致，以致你交易期間重複讀取的資料不一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">交易 A 讀取欄位 1</span><br><span class="line">交易 B 更新欄位 1</span><br><span class="line">交易 B COMMIT</span><br><span class="line">交易 A 讀取欄位 1</span><br></pre></td></tr></table></figure>
</li>
<li><p>幻讀（phantom read）這個所需要的鎖的粒度，和上面三種不同<br>第一次读的时候发现什么都没有，另一个事务偷偷放了东西进去，再去访问的时候惊讶地居然发现有东西了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">交易 A 進行兩次查詢，在兩次查詢之中有個交易 B **插入**一筆新資料或**刪除**一筆新資料，資料多一筆或少一筆，跟update無關</span><br><span class="line">交易 A 進行查詢得到五筆資料</span><br><span class="line">交易 B 插入一筆資料</span><br><span class="line">交易 B COMMIT</span><br><span class="line">交易 A 進行查詢得到六筆資料</span><br></pre></td></tr></table></figure>

<p>或是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">交易 A 進行查詢id=99沒有紀錄</span><br><span class="line">交易 B 插入一筆id=99資料</span><br><span class="line">交易 B COMMIT</span><br><span class="line">交易 A 進行查詢id=99沒有紀錄</span><br><span class="line">交易 A 更新id=99紀錄</span><br><span class="line">交易 A 查詢id=99</span><br><span class="line">上面這個例子的第4步需要解釋一下，</span><br><span class="line">因為可重复读的事务B内查询与开始时刻一致（快照），但本事务内的更新操作会更新快照。因此第4步查询的与一开始的一致，为空，第5步在本事务内执行更新操作后就会重新生成一次查询。</span><br></pre></td></tr></table></figure>
<p>案例:<a href="https://www.liaoxuefeng.com/wiki/1177760294764384/1245268672511968" target="_blank" rel="noopener">Repeatable Read</a></p>
</li>
</ul>
<p>面對以上問題，鎖定資料庫可以解決，但是不同的鎖對效能影響不同<br>因此會根據<strong>讀寫的頻繁程度</strong>來設定不同的交易隔離層級（transaction isolation level）：</p>
<p>在此說明讀和寫是兩個分開的動作，雖然在交易期間會兩個做搭配，做為一個交易，但資料庫在封鎖功能時是分開封鎖的<br>以一個需要讀取，更新，提交的交易來說 一共有三個步驟，兩個交易交錯<br>A和B併發，扣除掉第一個一定是A交易讀取的話，就有C5取2種不同情況，以下還沒有加入rollback以及重複讀取的情況的情況，不然更複雜</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Ar  Br  Au  Ac  Bu  Bc</span><br><span class="line">Ar  Br  Au  Bu  Bc  Ac</span><br><span class="line">Ar  Br  Au  Bu  Ac  Bc</span><br><span class="line">Ar  Br  Bu  Bc  Au  Ac</span><br><span class="line">Ar  Br  Bu  Au  Ac  Bc</span><br><span class="line">Ar  Br  Bu  Au  Bc  Ac</span><br><span class="line">Ar  Au  Ac  Br  Bu  Bc   預期的正常情況</span><br><span class="line">Ar  Au  Br  Ac  Bu  Bc</span><br><span class="line">Ar  Au  Br  Bu  Ac  Bc</span><br><span class="line">Ar  Au  Br  Bu  Bc  Ac</span><br></pre></td></tr></table></figure>

<p>  以下4個層級的鎖，為隱式鎖定<br>  ○代表通過，但通過可能會有副作用<br>  ×代表被阻止(延遲)</p>
<ul>
<li><p>read uncommited<br>至少保證：「A 交易已寫入但尚未確認的資料，B 交易僅可作讀取動作」。<br>A 交易在寫入但未提交，B 交易的寫入會被延後至 A 提交之後。<br><strong>未確認的寫入會阻止(延遲)其他交易的寫入</strong><br>有髒讀的風險<br>有重複讀取的風險<br>有幻讀的風險<br><strong>避免更新遺失的問題</strong>，但是會有讀取錯誤的問題，期間如果有人讀取，資料就會不相同，如果你後悔rollback了，會導致你更新的資料不正確</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Ar  Br  Au  Ac  Bu  Bc  ○</span><br><span class="line">Ar  Br  Au  Bu  Bc  Ac  ×</span><br><span class="line">Ar  Br  Au  Bu  Ac  Bc  ×</span><br><span class="line">Ar  Br  Bu  Bc  Au  Ac  ○</span><br><span class="line">Ar  Br  Bu  Au  Ac  Bc  ×</span><br><span class="line">Ar  Br  Bu  Au  Bc  Ac  ×</span><br><span class="line">Ar  Au  Ac  Br  Bu  Bc  ○</span><br><span class="line">Ar  Au  Br  Ac  Bu  Bc  ○</span><br><span class="line">Ar  Au  Br  Bu  Ac  Bc  ×</span><br><span class="line">Ar  Au  Br  Bu  Bc  Ac  ×</span><br></pre></td></tr></table></figure>

<p>雖然這個層級有4種能通過，但是這4總情況如果有rollback的話，髒讀情形會很嚴重，因為沒有限制讀取，其他層級加上rollback都不會發生髒讀<br>以上通過的會伴隨著髒讀和重複讀取的風險</p>
</li>
<li><p>read commited<br>至少要保證：「交易讀取的資料必須是已確認的資料」<br><strong>未確認的寫入交易會阻止(延遲)其它交易的讀取</strong>，但不影響寫入會有更新遺失的問題，但這影響效能較大<br>其中這裡面的讀取，除非你有加<strong>顯示鎖</strong>的關鍵字，不然都是<strong>非一致性鎖定讀</strong>(又稱為快照讀)，就是我不會等待交易A鎖的釋放，而是去讀取該行版本的<strong>最新快照</strong><br>有重複讀取的風險<br>有幻讀的風險<br>更新遺失的風險</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Ar  Br  Au  Ac  Bu  Bc  ○ 交易A讀取庫存欄位5個，交易B讀取庫存欄位5個，交易A更新庫存為4個，交易A提交，交易B更新庫存為4個，交易B提交==&gt;通過，更新遺失</span><br><span class="line">Ar  Br  Au  Bu  Bc  Ac  ○</span><br><span class="line">Ar  Br  Au  Bu  Ac  Bc  ○ 交易A讀取庫存欄位5個，交易B讀取庫存欄位5個，交易A更新庫存為4個，交易B更新庫存為4個，交易A提交，交易B提交==&gt;通過，更新遺失</span><br><span class="line">Ar  Br  Bu  Bc  Au  Ac  ○</span><br><span class="line">Ar  Br  Bu  Au  Ac  Bc  ○</span><br><span class="line">Ar  Br  Bu  Au  Bc  Ac  ○</span><br><span class="line">Ar  Au  Ac  Br  Bu  Bc  ○</span><br><span class="line">Ar  Au  Br  Ac  Bu  Bc  × 交易A讀取庫存欄位5個，交易A更新庫存為4個，交易B讀取庫存欄位5個(此時被阻止(延遲)，因為交易A寫入尚未提交)</span><br><span class="line">Ar  Au  Br  Bu  Ac  Bc  ×</span><br><span class="line">Ar  Au  Br  Bu  Bc  Ac  ×</span><br></pre></td></tr></table></figure>

<p>有7種情形能通過，可以避免髒讀，因為未提交的讀取被限制住了，但是無法保證交易期間資料的一致性，期間如果有人寫入而且提交了，欄位值就會變</p>
</li>
</ul>
<ul>
<li><p>repeatable read<br>至少保證：「同一交易內兩次讀取的資料必須相同」<br><strong>未確認的讀取，影響其他交易的寫入</strong><br>其中這裡面的讀取，除非你有加<strong>顯示鎖</strong>的關鍵字，不然都是<strong>非一致性鎖定讀</strong>(又稱為快照讀)，就是我不會等待交易A鎖的釋放，而是去讀取該行在<strong>交易A一開始時的快照</strong><br>有幻讀的風險<br>更新遺失的風險<br>//todo 待確認  可以解决的两个问题是unrepeatable read和seocond lost update??(<a href="https://blog.51cto.com/lsieun/1827383" target="_blank" rel="noopener">https://blog.51cto.com/lsieun/1827383</a>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Ar  Br  Au  Ac  Bu  Bc  ○ 交易A讀取庫存欄位5個，交易B讀取庫存欄位5個，交易A更新庫存為4個，交易A提交，交易B更新庫存為4個，交易B提交==&gt;通過，但更新遺失</span><br><span class="line">Ar  Br  Au  Bu  Bc  Ac  × 交易A讀取庫存欄位5個，交易B讀取庫存欄位5個，交易A更新庫存為4個，交易B更新庫存為4個(此時被阻止，因為交易A讀取尚未提交)</span><br><span class="line">Ar  Br  Au  Bu  Ac  Bc  ×</span><br><span class="line">Ar  Br  Bu  Bc  Au  Ac  × 交易A讀取庫存欄位5個，交易B讀取庫存欄位5個，交易B更新庫存為4個(此時被延遲，因為交易A讀取尚未提交)</span><br><span class="line">Ar  Br  Bu  Au  Ac  Bc  ×</span><br><span class="line">Ar  Br  Bu  Au  Bc  Ac  ×</span><br><span class="line">Ar  Au  Ac  Br  Bu  Bc  ○ </span><br><span class="line">Ar  Au  Br  Ac  Bu  Bc  ○ 交易A讀取庫存欄位5個，交易A更新庫存為4個，交易B讀取庫存欄位5個，交易A提交，交易B更新庫存為4個，交易B提交==&gt;通過，但更新遺失</span><br><span class="line">Ar  Au  Br  Bu  Ac  Bc  × 交易A讀取庫存欄位5個，交易A更新庫存為4個，交易B讀取庫存欄位5個，交易B更新庫存為4個(此時被阻止(延遲)，因為交易A讀取尚未提交)</span><br><span class="line">Ar  Au  Br  Bu  Bc  Ac  ×</span><br></pre></td></tr></table></figure>

<p>有3種情形能通過，避免 unrepeatable read   我在讀的期間你就是不能寫，伴隨著更新遺失和幻讀的風險</p>
<p>更新遺失<br>//todo 資料庫的原子性，單一update語句是否有更新遺失的問題?<br>在RR層級下，update會先select for date(當前讀)，所以理論上應該是不會拿到舊的?<br>update語句RR階層自帶select for update， 鎖一加上要等到commit或rollback階段才能解，所以如果是很熱門的數據欄位，例如商品的庫存，更新這種會上鎖阻塞的操作最好留在交易流程的後半段<br>也就是整個交易流程 可能就變成 鎖用戶資金=&gt;插入訂單=&gt;更新庫存，庫存這張表的更新留到最後，影響比較小</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> COUNTERS <span class="keyword">SET</span> <span class="keyword">VALUE</span> = <span class="keyword">VALUE</span>+<span class="number">1</span> <span class="keyword">WHERE</span> <span class="keyword">KEY</span> =<span class="string">'FOO;</span></span><br></pre></td></tr></table></figure>

<p>更新遺失</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$db-&gt;transaction-&gt;begin();</span><br><span class="line">$value = $db-&gt;query(<span class="string">"select value from counters where key ='FOO'"</span>)-&gt;column();</span><br><span class="line">$db-&gt;exec(<span class="string">"UPDATE COUNTERS SET VALUE = $value WHERE KEY ='FOO'"</span>);</span><br><span class="line">$db-&gt;transaction-&gt;commit();</span><br></pre></td></tr></table></figure>
</li>
<li><p>serializable<br><strong>未確認的讀取，影響其他交易的讀取</strong><br>A 交易讀取時，B 交易若要寫入，就必須循序，A 交易寫入時，B 交易無論讀取或寫入都必須循序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Ar  Br  Au  Ac  Bu  Bc  ×</span><br><span class="line">Ar  Br  Au  Bu  Bc  Ac  ×</span><br><span class="line">Ar  Br  Au  Bu  Ac  Bc  ×</span><br><span class="line">Ar  Br  Bu  Bc  Au  Ac  ×</span><br><span class="line">Ar  Br  Bu  Au  Ac  Bc  ×</span><br><span class="line">Ar  Br  Bu  Au  Bc  Ac  ×</span><br><span class="line">Ar  Au  Ac  Br  Bu  Bc  ○</span><br><span class="line">Ar  Au  Br  Ac  Bu  Bc  ×</span><br><span class="line">Ar  Au  Br  Bu  Ac  Bc  ×</span><br><span class="line">Ar  Au  Br  Bu  Bc  Ac  ×</span><br></pre></td></tr></table></figure>

<p>有1種情況能通過<br>如何實作序列化的交易呢(<a href="https://xlk3099.github.io/post/ddia_chapter7/" target="_blank" rel="noopener">https://xlk3099.github.io/post/ddia_chapter7/</a>)</p>
<ul>
<li>Literally executing transactions in a serial order, representative: redis, cost: can only work on a single CPU core.</li>
<li>Two phase locking(2PL): 统治了几十年，但现在很多 application avoid using it， 因为性能问题, 悲观锁</li>
<li>SSI（serializable snapshot isolation）： 新贵，use an optimistic approach， 乐观锁</li>
</ul>
</li>
</ul>
<p>以上四個為資料庫的4個不同層級的锁，read uncommited 和 serializable這兩個交易層級的索我們不考慮，且由於資料庫在功能封鎖上，不一定符合實際情形，所以我們會搭應用程式上的鎖來對其做補強</p>
<p>顯式鎖定<br>InnoDB默认使用<strong>行锁</strong><br>InnoDB采用的是<a href="https://www.jianshu.com/p/d1c42fe4c4ed" target="_blank" rel="noopener">两阶段锁定协议</a>（two-phase locking protocol）<br>亦即锁只有在执行 COMMIT 或者 ROLLBACK 的时候才会释放<br>InnoDB 也支持通过特定的语句进行显式锁定，这些语句不属于SQL规范（这些锁定提示经常被滥用，实际上应当尽量避免使用）</p>
<ul>
<li>SELECT … LOCK IN SHARE MODE  (serializable層級底下才默認select加共享鎖，其他層級可以自己加)</li>
<li>SELECT … FOR UPDATE (reapeatable read層級底下默認對增刪改加入排他鎖，select讀的話要自己加)</li>
</ul>
<p>以上兩個讀取的動作稱為，<strong>一致性鎖定讀</strong>，当前读</p>
<ul>
<li>LOCK TABLES (不須在交易內執行)</li>
<li>UNLOCK TABLES (不須再交易內執行)</li>
</ul>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><p>是通过保存数据在某个时间点的快照来实现的。每个事务读到的数据项都是⼀个历史快照，被称为快照读，不同于当前读的是快照 读读到的数据可能不是最新的，但是快照隔离能使得在整个事务看到的数据都是它启动时的数据状态。</p>
<h3 id="当前读"><a href="#当前读" class="headerlink" title="当前读"></a>当前读</h3><p>像select lock in share mode( 共享锁),select for update ; update, insert ,delete( 排他锁) 这些操作都是⼀种当前读，为什么叫当前读? 就是它读取的是 记录的最新版本，读取时还要保证其他并发事务不能修改当前记录，会对读取的记录进⾏加锁。</p>
<h3 id="快照读"><a href="#快照读" class="headerlink" title="快照读"></a>快照读</h3><p>像不加锁的select 操作就是快照读，即不加锁的⾮阻塞读;</p>
<p>快照读的前提是隔离级别不是未提交读和串⾏化级别，因为未提交读总是读取最新的数据⾏，⽽不是符合当前事务版本的数据⾏。⽽串⾏化则会对所有读取的⾏都加锁</p>
<h3 id="select-for-update"><a href="#select-for-update" class="headerlink" title="select for update"></a>select for update</h3><p>參考:<a href="https://blog.51cto.com/u_15101587/2623974" target="_blank" rel="noopener">MySQL数据库select for update探究</a></p>
<p>接下來的情境都以InnoDB默認的RR層級鎖來當預設環境，且尚未commit的情況</p>
<p>Q: 我交易A select for update了，那我交易B可以select該行資料嗎?</p>
<p>A: 可以 select 操作讀取的是該行的快照，所以交易B讀取不影響且讀取到的會試舊值，但如果你要更新時，RR層級下你會被延遲</p>
<p>Q: 我交易A select for update了，那我交易B可以select for update該行資料嗎?</p>
<p>A: 不可以 select for update 讀取的是當前的資料(當前讀)，但由於交易A已經對該行施行排他鎖了，所以不能再加鎖</p>
<p>Q: 我交易A update了 我交易B可以select for update嗎?</p>
<p>A: 會被延遲查不到結果，直到A commit，最後雖然交易B還沒結束，但select for update可以讀到最新值，因為是當前讀，此時交易內兩次的讀取就不同了</p>
<h3 id="樂觀鎖定（Optimistic-Locking）"><a href="#樂觀鎖定（Optimistic-Locking）" class="headerlink" title="樂觀鎖定（Optimistic Locking）"></a>樂觀鎖定（Optimistic Locking）</h3><p>樂觀的認為資料很少發生同時存取的問題，通常在資料庫層級上設為 read-commited 隔離層級，並實行樂觀鎖定。<br>read-commited 可以避免 dirty read，但是 lost update,的情形必須要改善，可以讓應用程式在更新前檢查資料有沒有重複<br>乐观锁是指在获取数据时候不加锁，乐观的认为操作不会有冲突，在update的时候再去检查冲突。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> balance <span class="keyword">from</span> <span class="keyword">account</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 得到balance=100;然后计算balance=100+50=150</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance = <span class="number">150</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> balance = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<p>改善的方法分為<br>先更新為主（First commit wins）<br>後更新的為主（Last commit wins）<br>合併衝突更新（Merge conflicting update）</p>
<h3 id="悲觀鎖定（Pessimistic-Locking）"><a href="#悲觀鎖定（Pessimistic-Locking）" class="headerlink" title="悲觀鎖定（Pessimistic Locking）"></a>悲觀鎖定（Pessimistic Locking）</h3><p>悲觀的認定每次資料存取時，其它的客戶端也會存取同一筆資料，因此對相關的資料進行鎖定，直到自己操作完成後解除鎖定。<br>這樣的鎖定叫做排他鎖。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">account</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">account</span> <span class="keyword">set</span> balance=<span class="number">150</span> <span class="keyword">where</span> <span class="keyword">id</span> =<span class="number">1</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

<p>适用场景</p>
<p>一、悲观锁</p>
<p>用来解决读-写冲突和写-写冲突的的加锁并发控制</p>
<p>适用于写多读少，写冲突严重的情况，因为悲观锁是在读取数据的时候就加锁的，读多的场景会需要频繁的加锁和很多的的等待时间，而在写冲突严重的情况下使用悲观锁可以保证数据的一致性</p>
<p>数据一致性要求高</p>
<p>可以解决脏读，幻读，不可重复读，第一类更新丢失，第二类更新丢失的问题</p>
<p>二、乐观锁</p>
<p>解决写-写冲突的无锁并发控制</p>
<p>适用于读多写少，因为如果出现大量的写操作，写冲突的可能性就会增大，业务层需要不断重试，这会大大降低系统性能</p>
<p>数据一致性要求不高，但要求非常高的响应速度</p>
<p>无法解决脏读，幻读，不可重复读，但是可以解决更新丢失问题</p>
<p>三、MVCC(多版本併發控制)</p>
<p>解决读-写冲突的无锁并发控制</p>
<p>与上面两者结合，提升它们的读性能</p>
<p>可以解决脏读，幻读，不可重复读等事务问题，更新丢失问题除外</p>
<p><a href="https://www.cnblogs.com/chenpingzhao/p/5041967.html" target="_blank" rel="noopener">【mysql】关于悲观锁</a><br><a href="https://blog.csdn.net/weixin_39947314/article/details/113720708" target="_blank" rel="noopener">mysql悲观锁和乐观优缺点_乐观锁、悲观锁和MVCC各是什么</a></p>
<h2 id="死鎖"><a href="#死鎖" class="headerlink" title="死鎖"></a>死鎖</h2><p>參考：<br><a href="https://segmentfault.com/a/1190000022732257" target="_blank" rel="noopener">死鎖</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">事務A更新id=1，更新id=2，提交</span><br><span class="line">事務B更新id=2，更新id=1，提交</span><br><span class="line">死鎖的情形發生在:</span><br><span class="line">事務A更新id=1</span><br><span class="line">事務B更新id=2</span><br><span class="line">事務A等待事務B釋放id=2鎖</span><br><span class="line">事務B等待事務A釋放id=1鎖</span><br><span class="line">兩個事務互相等待，導致死鎖</span><br></pre></td></tr></table></figure>

<p>两阶段锁协议，整个事务分为两个阶段，前一个阶段为加锁，后一个阶段为解锁。在加锁阶段，事务只能加锁，也可以操作数据，但不能解锁，直到事务释放第一个锁，就进入解锁阶段( commit or rollback)，此过程中事务只能解锁，也可以操作数据，不能再加锁。两阶段锁协议使得事务具有较高的并发度，因为解锁不必发生在事务结尾。它的不足是没有解决死锁的问题，因为它在加锁阶段没有顺序要求。如两个事务分别申请了A, B锁，接着又申请对方的锁，此时进入死锁状态。(<a href="https://www.cnblogs.com/zszmhd/p/3365220.html" target="_blank" rel="noopener">https://www.cnblogs.com/zszmhd/p/3365220.html</a>)</p>
<h2 id="持續性（Durability）"><a href="#持續性（Durability）" class="headerlink" title="持續性（Durability）"></a>持續性（Durability）</h2><p>交易一旦成功，所有的變更就必須保存下來，就是你一但commit之後，即便是硬體的損壞也不應該丟影響資料，<br>在有叢集的情況下就是需要其他的節點有寫入資料之後，此commit才算成功，那如果是單一節點的資料庫呢?<br>就需要採用ssd這種不會關掉電源就資料流失的硬體，最主要是依靠wal(writing ahead log)，依靠這個log來recover</p>
<h1 id="BASE"><a href="#BASE" class="headerlink" title="BASE"></a>BASE</h1><p><a href="http://garyliutw.blogspot.com/2014/05/mongodb-nosql.html" target="_blank" rel="noopener">MongoDB 學習筆記</a></p>
<h2 id="Basically-Abalible"><a href="#Basically-Abalible" class="headerlink" title="Basically Abalible"></a>Basically Abalible</h2><h2 id="soft-state"><a href="#soft-state" class="headerlink" title="soft state"></a>soft state</h2><h2 id="eventual-consistency"><a href="#eventual-consistency" class="headerlink" title="eventual consistency"></a>eventual consistency</h2><h1 id="遭遇狀況"><a href="#遭遇狀況" class="headerlink" title="遭遇狀況"></a>遭遇狀況</h1><h2 id="GROUP-BY-和-select-的關係"><a href="#GROUP-BY-和-select-的關係" class="headerlink" title="GROUP BY 和 select 的關係"></a>GROUP BY 和 select 的關係</h2><p>因為 group by 一定會有幾筆資料需要合併，這個時候就會需要搭配一些函數例如 sum count 某些欄位，不然他會不知道要留下哪筆資料<br><a href="https://stackoverflow.com/questions/19601948/must-appear-in-the-group-by-clause-or-be-used-in-an-aggregate-function" target="_blank" rel="noopener">https://stackoverflow.com/questions/19601948/must-appear-in-the-group-by-clause-or-be-used-in-an-aggregate-function</a></p>
<h1 id="資料庫優化"><a href="#資料庫優化" class="headerlink" title="資料庫優化"></a>資料庫優化</h1><p><a href="https://blog.csdn.net/qq_28284093/article/details/81031670" target="_blank" rel="noopener">https://blog.csdn.net/qq_28284093/article/details/81031670</a></p>
<h1 id="大家在系統中有沒有使用-資料庫的-VIEW"><a href="#大家在系統中有沒有使用-資料庫的-VIEW" class="headerlink" title="大家在系統中有沒有使用 資料庫的 VIEW"></a>大家在系統中有沒有使用 資料庫的 VIEW</h1><p><a href="https://ithelp.ithome.com.tw/questions/10122148" target="_blank" rel="noopener">https://ithelp.ithome.com.tw/questions/10122148</a><br>另一個原因<br><a href="https://youtu.be/Y-mJXOnoSx4" target="_blank" rel="noopener">https://youtu.be/Y-mJXOnoSx4</a><br>影片下面留言有人的前端需要統一用 activeRecode 來存取物件，但是資料又是多表格 join 的，該如何才能正常存取屬性<br>就有人回答用 view 然後把他當作一般的表來創 model</p>
<h1 id="高併發"><a href="#高併發" class="headerlink" title="高併發"></a>高併發</h1><p>關鍵字：資料庫其實本身不是用來承載高併發請求的</p>
<h1 id="MySQL读写分离后的延迟解决方案"><a href="#MySQL读写分离后的延迟解决方案" class="headerlink" title="MySQL读写分离后的延迟解决方案"></a>MySQL读写分离后的延迟解决方案</h1><p><a href="https://www.cnblogs.com/zhangchaocoming/p/13033064.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhangchaocoming/p/13033064.html</a></p>
<h1 id="uuid"><a href="#uuid" class="headerlink" title="uuid"></a>uuid</h1><p>UUID 来设置用户唯一 ID，相比自增 ID 而言，UUID 的好处是不依赖于数据库的自增 ID，可以分布式生成，另外，从安全角度来说，UUID 是没有规律的随机字符串，无法被用户猜测发起恶意攻击或接口遍历。</p>
<h1 id="PHP中PDO关闭连接的问题"><a href="#PHP中PDO关闭连接的问题" class="headerlink" title="PHP中PDO关闭连接的问题"></a>PHP中PDO关闭连接的问题</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;show processlist;</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.51cto.com/u_15127608/3287543" target="_blank" rel="noopener">https://blog.51cto.com/u_15127608/3287543</a></p>
<p>可以列出sleep中的線程，我們一般的請求其實不會刻意去關閉資料庫連結的，如何發現呢?<br>程式碼裡面sleep(10)就可以發現資料庫連結跟著卡10秒，所以理論上php不做太耗時的運算，線程會很快結束，不會sleep太久</p>
<h1 id="Mysql主從延遲的解決方案"><a href="#Mysql主從延遲的解決方案" class="headerlink" title="Mysql主從延遲的解決方案"></a>Mysql主從延遲的解決方案</h1><p><a href="https://segmentfault.com/a/1190000040821444" target="_blank" rel="noopener">MySQL主从延迟解决办法</a></p>
<h1 id="mysql-insert-on-duplicate"><a href="#mysql-insert-on-duplicate" class="headerlink" title="mysql insert on duplicate"></a>mysql insert on duplicate</h1><p>效能比replace好，如果要附帶刪除功能可以參考這篇<br>在更新時，增加do_delete欄位<br><a href="https://stackoverflow.com/questions/11495090/mysql-insert-on-duplicate-key-delete" target="_blank" rel="noopener">https://stackoverflow.com/questions/11495090/mysql-insert-on-duplicate-key-delete</a></p>
<h1 id="樹狀結構"><a href="#樹狀結構" class="headerlink" title="樹狀結構"></a>樹狀結構</h1><p><a href="https://blog.csdn.net/weixin_34258782/article/details/86073946?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ETopBlog-1.topblog&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ETopBlog-1.topblog&utm_relevant_index=1" target="_blank" rel="noopener">[ mongoDB ] - 文档型数据库设计模式-如何存储树形数据 [转]</a><br><a href="https://columns.chicken-house.net/2019/06/01/nested-query/" target="_blank" rel="noopener">架構面試題 #3, RDBMS 處理樹狀結構的技巧</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/05/13/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E9%A1%8C%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/13/%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E9%A1%8C%E7%9B%AE/" class="post-title-link" itemprop="url">程式設計題目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-05-13 16:16:10" itemprop="dateCreated datePublished" datetime="2020-05-13T16:16:10+08:00">2020-05-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-07-30 18:11:28" itemprop="dateModified" datetime="2021-07-30T18:11:28+08:00">2021-07-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="測試資料排列組合"><a href="#測試資料排列組合" class="headerlink" title="測試資料排列組合"></a>測試資料排列組合</h1><p>目前有個案例是要衣服要件所有可能的排列組合<br>輸入範例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">'color'</span>: [<span class="string">'red'</span>,<span class="string">'white'</span>,<span class="string">'blue'</span>],</span><br><span class="line"><span class="string">'size'</span>:[<span class="string">'s'</span>,<span class="string">'m'</span>,<span class="string">'l'</span>,<span class="string">'xl'</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>希望結果能輸出<br>3*4 種排列組合</p>
<p>爾且增加衣服的要件依然能運作，例如新增衣服主題 subject</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">'color'</span>: [<span class="string">'red'</span>,<span class="string">'white'</span>,<span class="string">'blue'</span>],</span><br><span class="line"><span class="string">'size'</span>:[<span class="string">'s'</span>,<span class="string">'m'</span>,<span class="string">'l'</span>,<span class="string">'xl'</span>],</span><br><span class="line"><span class="string">'subject'</span>:[<span class="string">'cartoon'</span>,<span class="string">'aphabet'</span>,<span class="string">'none'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>希望結果能輸出<br>3<em>4</em>3 種排列組合<br>輸出範例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    [</span><br><span class="line">        <span class="string">'color'</span>:<span class="string">'red'</span></span><br><span class="line">        <span class="string">'size'</span>:<span class="string">'s'</span></span><br><span class="line">        <span class="string">'subject'</span>:<span class="string">'cartoon'</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">'color'</span>:<span class="string">'white'</span></span><br><span class="line">        <span class="string">'size'</span>:<span class="string">'s'</span></span><br><span class="line">        <span class="string">'subject'</span>:<span class="string">'cartoon'</span></span><br><span class="line">    ]</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/05/08/%E5%AF%86%E7%A0%81%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/08/%E5%AF%86%E7%A0%81%E5%AD%A6/" class="post-title-link" itemprop="url">密码学</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-05-08 09:40:51" itemprop="dateCreated datePublished" datetime="2020-05-08T09:40:51+08:00">2020-05-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-07-30 18:11:28" itemprop="dateModified" datetime="2021-07-30T18:11:28+08:00">2021-07-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>因為工作 api 的呼叫会用到加密解密，所以总是要纪录一下，每个工具光是学要怎么用有的时候就要摸很久，加密解密的更是，有可能照步骤加解密就是得不到一样的结果，花了你大半天的生命</p>
<p>使用工具网站：<br><a href="https://www.devglan.com/online-tools/aes-encryption-decryption" target="_blank" rel="noopener">https://www.devglan.com/online-tools/aes-encryption-decryption</a><br>这个网站的目的是让你知道同样的加密方法，你加解密的结果正不正确</p>
<h1 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h1><h2 id="CryptoJS"><a href="#CryptoJS" class="headerlink" title="CryptoJS"></a>CryptoJS</h2><p>工作中会用到 php 和 js 需要加解密的情况，是说这也奇怪，js 一般来说 code 都是可解的，把加密规则写在 js 形同让人加知道你如何加解密，这样有有什么用？<br>这点倒是要问一下主管</p>
<p><a href="http://jser.io/2014/08/19/how-to-use-aes-in-crypto-js-to-encrypt-and-decrypt" target="_blank" rel="noopener">http://jser.io/2014/08/19/how-to-use-aes-in-crypto-js-to-encrypt-and-decrypt</a></p>
<p><a href="https://moln.site/2018/06/22/crypto-js-aes-usage.html" target="_blank" rel="noopener">https://moln.site/2018/06/22/crypto-js-aes-usage.html</a></p>
<p><a href="https://stackoverflow.com/questions/25492179/decode-a-base64-string-using-cryptojs" target="_blank" rel="noopener">https://stackoverflow.com/questions/25492179/decode-a-base64-string-using-cryptojs</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/05/08/yii%E4%BD%BF%E7%94%A8codeception/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/08/yii%E4%BD%BF%E7%94%A8codeception/" class="post-title-link" itemprop="url">yii使用codeception</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-05-08 09:09:35" itemprop="dateCreated datePublished" datetime="2020-05-08T09:09:35+08:00">2020-05-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-07-30 18:11:28" itemprop="dateModified" datetime="2021-07-30T18:11:28+08:00">2021-07-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a href="https://juejin.im/entry/588049612f301e00697dcb6a" target="_blank" rel="noopener">中文 codeception 的基本設定</a><br><a href="https://github.com/yiisoft/yii2-app-advanced/blob/master/docs/guide/start-testing.md" target="_blank" rel="noopener">原文 codeception 的基本設定</a><br>开始之前一定要跟教学建一个测试专用的资料库，因為测试用的资料都会被清除，除非你想要内测的资料每次都被清除，否则只好照做<br><a href="https://segmentfault.com/a/1190000008157520?utm_source=tag-newest" target="_blank" rel="noopener">参考惨案:測試資料都被刪光了</a><br><a href="https://segmentfault.com/u/zebrayoung/articles?sort=vote" target="_blank" rel="noopener">https://segmentfault.com/u/zebrayoung/articles?sort=vote</a></p>
<p>codeception 是一套独立的测试框架，可跟其它 php 框架做搭配，在这我们和 yii 做搭配<br>在这裡推荐 kk 的教学文章，个人觉得中文教学难找，他写得很详细，应该说我觉得他写的比官网还要详细，是我看错官网吗<br>然后绝对不要再生产环境做测试<br><a href="https://codeception.com/docs/" target="_blank" rel="noopener">原文官方文檔</a><br><a href="https://github.com/kk8686/xoa" target="_blank" rel="noopener">KK 測試範例</a><br><a href="http://www.kkh86.com/it/codeception/guide-leaning-depends.html" target="_blank" rel="noopener">KK 中文技術文檔</a></p>
<h1 id="如何编写测试用例"><a href="#如何编写测试用例" class="headerlink" title="如何编写测试用例"></a>如何编写测试用例</h1><p>有什么比较好的门道，平衡覆盖率和收益<br><a href="https://www.zhihu.com/question/51558124" target="_blank" rel="noopener">如何编写测试用例</a><br>底下的留言有正交表的相關資訊，那由於學習正交表相關理論需要時間，我目前還是用窮舉的方式來做測試<br><a href="https://testerhome.com/topics/11744" target="_blank" rel="noopener">接口测试用例到底应该怎么写</a></p>
<h2 id="Waterfall-Agile-DevOps"><a href="#Waterfall-Agile-DevOps" class="headerlink" title="Waterfall Agile DevOps"></a>Waterfall Agile DevOps</h2><p>软件开发并的管理流程 与其框架 实践方法</p>
<ul>
<li>Waterfall →CMMI</li>
<li>Agile → Scrum</li>
<li>Agile → xp</li>
<li>Agile → Kanban</li>
<li>Agile → Lean</li>
<li>Agile → xp →TDD</li>
<li>DevOps →TDD<br>都有软件开发、测试和部署的阶段。<br>然而，敏捷流程在这三个阶段之后会终止。<br>相反，DevOps 包括后续持续的运维。</li>
</ul>
<p>由以上方法衍生出</p>
<ul>
<li>TDD：測試驅動開發（Test-Driven Development）</li>
<li>BDD：行為驅動開發（Behavior Driven Development）</li>
<li>ATDD：驗收測試驅動開發（Acceptance Test Driven Development）</li>
<li>DDD：領域驅動開發（Domain Drive Design）</li>
</ul>
<h1 id="為什么要写测试"><a href="#為什么要写测试" class="headerlink" title="為什么要写测试"></a>為什么要写测试</h1><p>即使是一个不成功的项目也是会有规模增长以及复杂度的增加的<br>当项目一大，你所写的 code 可能很多地方都有用到，然而人是健忘的，只有在写 code 的当下才会清楚这代码和其他 code 的耦合，那我们能做的就是在当下写测试，确保修改之后的测试报错，能让你回想到写 code 当下的逻辑，避免真正产品上限之后出现改 a 错 b 的情形<br>手动能测试的有限，每次改完都要在手动重测一次很累，尔且一定会有测试没复盖到的地方<br>测试代码并不能将所有角度都全部测试，因为程序员可能会写漏一些角度的测试代码<br>比如数据搜索的测试，搜索条件组合花样百出，如果 1000 个商品分类里有其中 3 个有问题，那为了准确找出这些问题，程序员是不是要写 1000 种不同商品分类的测试代码？<br>这不现实，测试代码确实无法完美地测试所有问题，但大部分问题已经写好测试代码后，一旦修改业务逻辑，你不再需要人工访问这里那里的页面测试刷新测试刷新</p>
<h2 id="哪些类和方法要编写单元测试？"><a href="#哪些类和方法要编写单元测试？" class="headerlink" title="哪些类和方法要编写单元测试？"></a>哪些类和方法要编写单元测试？</h2><p>一切其实都是看性价比，你觉得值了就写，不值了就别写<br>例如 临时的/少调用的/非核心的类就可以不必为它写测试方法<br>你觉得哪些容易出错，后期修改容易造成误差的内容嘛，就测那些好了。不然你测得再多，有的本身就很稳定，永远不出错，你这个测试代码可能就白写了，自己学会把握哦</p>
<h1 id="代碼覆蓋率（Code-coverage）"><a href="#代碼覆蓋率（Code-coverage）" class="headerlink" title="代碼覆蓋率（Code coverage）"></a>代碼覆蓋率（Code coverage）</h1><p><a href="https://zh.wikipedia.org/wiki/%E4%BB%A3%E7%A2%BC%E8%A6%86%E8%93%8B%E7%8E%87" target="_blank" rel="noopener">基本准则参考 wiki</a></p>
<ul>
<li>函式覆蓋率（Function coverage）：有呼叫到程式中的每一個函式（或副程式）嗎？</li>
<li>指令覆蓋率（Statement coverage）：函式中每一行都執行一次了吗？</li>
<li>判斷覆蓋率（Decision coverage）：有 if 的情况，那 true 和 false 这两个有满足吗</li>
<li>條件覆蓋率（Condition coverage）：if 裡面所有的条件都有 true 和 false 都考虑到吗</li>
<li>條件/判斷覆蓋率（Condition/decision coverage）：需同時滿足判斷覆蓋率和條件覆蓋率，所有排列组合。</li>
<li>其他还有一些准则请参考 wiki</li>
</ul>
<h1 id="依单位来划分测试"><a href="#依单位来划分测试" class="headerlink" title="依单位来划分测试"></a>依单位来划分测试</h1><p>codeception 划分了几种测试，那测试的划分也是十分重要，怎样才算单元？<br><a href="https://segmentfault.com/q/1010000005160792?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/q/1010000005160792?utm_source=tag-newest</a><br>PHP 原生的对象方法理解为单元,没有过多层次的调用封装的<br>开发者自己将业务串联起来一起测试的这就是功能测试</p>
<h2 id="验收测试"><a href="#验收测试" class="headerlink" title="验收测试"></a>验收测试</h2><p>验收测试则是主要针对页面做测试<br>模拟使用者使用浏览器的测试，不限定你后端的语言，你就是个单纯的使用者</p>
<h2 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h2><p>和验受测试很像，没有模拟使用者的功能测试</p>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>单元测试主要针对函数/方法做测试<br>根據 SRP 原則,就是一个个 class 做自己的事,测试裡头的每个 function</p>
<h2 id="api-测试"><a href="#api-测试" class="headerlink" title="api 测试"></a>api 测试</h2><h1 id="回归测试"><a href="#回归测试" class="headerlink" title="回归测试"></a>回归测试</h1><p>检验软件原有功能在修改后是否保持完整。</p>
<h1 id="设定"><a href="#设定" class="headerlink" title="设定"></a>设定</h1><p>文件配置这个我再官网找不到相关说明，请在 kk 的文章找相关讯息<br>如果你想在本地开发时使用自己特殊的路径和数据库信息配置，但是又不想影响其他开发成员，以及在测试机上不使用你自己的配置来运行</p>
<p>dist 配置支持<br>只要知道“codeception.dist.yml 这个配置文件如果存在的话，会与 codeception.yml 进行合并，并且两者存在相同配置时会优先使用 codeception.yml 的“</p>
<p>你只要别提交 codeception.yml 到代码仓库上就行了</p>
<h1 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h1><p>所谓的断言就是<br>我判断这个结果是<br>我敢断言这个结果是<br>既然有了 assertTrue 这个几乎万能的断言，为什么还会有那些别的断言呢？–其实是为了提高测试报告的精准性。<br>例如<br>$this-&gt;assertContains($id, [1,2,3]);<br>或者<br>每一个断言方法的最后一个参数都叫做$message，并且是一个可选参数<br>$this-&gt;assertTrue(in_array($id, [1, 2, 3]), ‘无效的 ID’); //这里传了第 2 个参数，一个用于表达错误的消息字符串<br>让你的测试讯息能清楚些</p>
<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><p>有的时候多个测试方法执行时，会影响到下一个，例如 var_dump()会影响,下一个测试的请求<br>reponse，他就会说 header 已经送过了，这样什么东西都看不到，此时最好是用 codeception 提供的方法<br>codecept_debug(‘abc’);<br>运行的同时也要加上参数，这样就可以 debug 了，不用像 var_dump()写还还要删掉<br>php E:\codecept.phar run unit –debug<br>php E:\codecept.phar run unit -d</p>
<h1 id="运行机制"><a href="#运行机制" class="headerlink" title="运行机制"></a>运行机制</h1><p>我写 api 测试时，只要是 public 的方法都会被运行，命名并没有强制规范，之后再来看看<br>每一个方法只要裡面有其中一个断言失败，那么整个方法就会中断，直接换测下一个方法<br>获取当前测试的方法可以用$this-&gt;getName()<br><a href="https://github.com/Codeception/Codeception/issues/1251" target="_blank" rel="noopener">https://github.com/Codeception/Codeception/issues/1251</a><br>//那因為版本的不同，这边就要看官网写的比较详细<br><a href="https://codeception.com/docs/07-AdvancedUsage" target="_blank" rel="noopener">https://codeception.com/docs/07-AdvancedUsage</a><br>Codeception\Scenario is also available in Actor classes and StepObjects. You can access it with $this-&gt;getScenario().<br>_before 和_after<br>可以与其做搭配<br>如果测试的方法有先后关西，就要透过注解@depends testxxx 来达成，也就是假如 a()失败了 b()就没必要做下去<br>依赖关系只会在运行整个测试用例的时候生效<br>每次运行一个测试方法,测试用例都会被重新 new 一次,那么私有属性就变回默认值了</p>
<h1 id="yii-测试"><a href="#yii-测试" class="headerlink" title="yii 测试"></a>yii 测试</h1><p>yii 官方推荐 codecept,然而 codecept 和 test 设定档互相有冲突，所以必须要分开设定<br><a href="https://github.com/yiisoft/yii2-app-advanced/issues/346" target="_blank" rel="noopener">https://github.com/yiisoft/yii2-app-advanced/issues/346</a></p>
<h1 id="目录底下有个-codeception-yml"><a href="#目录底下有个-codeception-yml" class="headerlink" title="/目录底下有个 codeception.yml"></a>/目录底下有个 codeception.yml</h1><p>裡面会 include 需要的测试档案</p>
<p><a href="https://github.com/Codeception/Codeception/issues/5017" target="_blank" rel="noopener">https://github.com/Codeception/Codeception/issues/5017</a></p>
<p>我的问题也是 autoload 的问题<br>因為专案一开始初始化叫做 admin/tests<br>之后又改成 mapi/tests<br>PHP Fatal error: Trait ‘mapi\tests_generated\FunctionalTesterActions’ not found in /var/www/mapi/tests/_support/FunctionalTester.php on line 21<br>就解决了</p>
<p>如果你是 yii advenced<br><a href="https://codeception.com/docs/10-APITesting#REST-API" target="_blank" rel="noopener">https://codeception.com/docs/10-APITesting#REST-API</a><br>就近进到应用程式资料夹，再下指令<br>../vendor/bin/codecept generate:suite api<br>这样生成的档案才会对应到正确的资料夹<br><a href="https://www.cnblogs.com/cfYu/p/10531552.html" target="_blank" rel="noopener">https://www.cnblogs.com/cfYu/p/10531552.html</a><br>接著就照上面的设置打指令<br>../vendor/bin/codecept generate:cest api AgentCest</p>
<p>跑测试<br>../vendor/bin/codecept run api AgentCest</p>
<p>../vendor/bin/codecept run api AgentCest:testXXX</p>
<p>如果测试的时候遇到，测试的方法不支援，那可能是模组没有载入，我们可以在刚刚建好的 suite 裡面加载<br>例如我运行<br>$I-&gt;fail(‘list contain agent not belong to you’);<br>显示不支援，所以必须在模下面添加 Asserts，至于我怎知道是大写还是小写 ASSERTS,因為我原本填大写找不到，只好去 github 看原码的 class 是大写还是小写…</p>
<p>actor: ApiTester<br>modules:<br>enabled: - \mapi\tests\Helper\Api - REST:<br>depends: Yii2<br>part: Json - Asserts</p>
<h1 id="fixtures"><a href="#fixtures" class="headerlink" title="fixtures"></a>fixtures</h1><p>使用这功能真的会清空资料库，请小心<br><a href="https://www.yiichina.com/tutorial/694" target="_blank" rel="noopener">https://www.yiichina.com/tutorial/694</a><br><a href="https://www.yiiframework.com/doc/guide/2.0/zh-cn/test-fixtures" target="_blank" rel="noopener">https://www.yiiframework.com/doc/guide/2.0/zh-cn/test-fixtures</a><br><a href="https://cloud.tencent.com/developer/section/1494451" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1494451</a></p>
<p>看解释：<br>使用场景： 在我们开发或者测试的时候，可能会需要某种特定状态下的数据，比如我想要用户刚下订单还未支付这个状态，那木我们就需要手动进行添加购物车、下订单等惭怍，但是 fixtures 可以直接将这个状态保存下来，如果需要使用这个状态，只要命令行里面加载一下对应的 fixtures 就好了。（待续）</p>
<h1 id="当一个方法-code-很多，裡面的-code-没有相依，不想因為其中一个断言失败而中断"><a href="#当一个方法-code-很多，裡面的-code-没有相依，不想因為其中一个断言失败而中断" class="headerlink" title="当一个方法 code 很多，裡面的 code 没有相依，不想因為其中一个断言失败而中断"></a>当一个方法 code 很多，裡面的 code 没有相依，不想因為其中一个断言失败而中断</h1><p>use \Codeception\Specify; 这个 Trait<br>$this-&gt;specify(‘测试目标的说明’, $具体的测试工作代码函数)<br>将 code 包成一块一块的</p>
<h1 id="标记哪些方法已经被测试"><a href="#标记哪些方法已经被测试" class="headerlink" title="标记哪些方法已经被测试"></a>标记哪些方法已经被测试</h1><p>写过测试的 code 要增加@test 标记,并说明测试用例是哪个命名空间</p>
<h1 id="啟用模块"><a href="#啟用模块" class="headerlink" title="啟用模块"></a>啟用模块</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">modules:</span></span><br><span class="line"><span class="attr">enabled:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">\mapi\tests\Helper\Api</span></span><br><span class="line"><span class="attr">  - REST:</span></span><br><span class="line"><span class="attr">      depends:</span> <span class="string">Yii2</span></span><br><span class="line"><span class="attr">      part:</span> <span class="string">Json</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">Asserts</span></span><br></pre></td></tr></table></figure>

<h1 id="测试器"><a href="#测试器" class="headerlink" title="测试器"></a>测试器</h1><p>将各个模块合并成了一个类</p>
<p>codecept build<br>之后就会出现一个 tester 类，那在运行测试时，这个类会备注入进各个方法</p>
<h1 id="测试报告"><a href="#测试报告" class="headerlink" title="测试报告"></a>测试报告</h1><p>运行测试失败之后会在_output 产生测试报告</p>
<h1 id="使用-faker"><a href="#使用-faker" class="headerlink" title="使用 faker"></a>使用 faker</h1><p>失败中….<br>為了生出测试用的资料，必须要借用这功能来产出一些随机字串和假资料<br>use faker<br><a href="https://github.com/yiisoft/yii2/issues/8692" target="_blank" rel="noopener">https://github.com/yiisoft/yii2/issues/8692</a></p>
<p><a href="https://github.com/yiisoft/yii2-app-advanced/issues/172" target="_blank" rel="noopener">https://github.com/yiisoft/yii2-app-advanced/issues/172</a></p>
<h1 id="使用-feature"><a href="#使用-feature" class="headerlink" title="使用 feature"></a>使用 feature</h1><p>清空资料库和载入资料库</p>
<p>记得要</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">- Yii2:</span></span><br><span class="line"><span class="attr">    part:</span> <span class="string">[orm,</span> <span class="string">fixtures]</span></span><br></pre></td></tr></table></figure>

<p>切记，使用 feature 会清空资料库，所以一定要在自己测试的资料库执行，也就是说<br>不建议执行 console 的<br>loadDATA<br>yii fixture/load Agent<br>然后你就会看到非测试的资料空清空之后，加上你指定在_data 的资料<br>这不是走测试资料库<br>会清空掉内测共用资料库，很恐怖<br>不是我们想要的结果</p>
<p>Set public $dataFile = <strong>DIR</strong> . ‘/data/init_login.php’; inside UserFixture</p>
<p>测试指令可行，test alias 路径也可行<br>参数-d 代表-debug<br>../vendor/bin/codecept run api AgentCest -d</p>
<h1 id="dataprovider"><a href="#dataprovider" class="headerlink" title="dataprovider"></a>dataprovider</h1><p>dataprovider 可以透過程式的註解將資料帶進我的要測試的 function 裡面，但是有個缺點是他資料只能寫死，因為這個 function 跑在整個測試之前，<br>所以最後我還是靠迴圈自己來跑動態的資料測試</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/04/30/%E4%BD%BF%E7%94%A8postman/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/30/%E4%BD%BF%E7%94%A8postman/" class="post-title-link" itemprop="url">使用postman</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-04-30 10:37:17" itemprop="dateCreated datePublished" datetime="2020-04-30T10:37:17+08:00">2020-04-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-11-23 15:04:19" itemprop="dateModified" datetime="2021-11-23T15:04:19+08:00">2021-11-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="基本-api-功能"><a href="#基本-api-功能" class="headerlink" title="基本 api 功能"></a>基本 api 功能</h1><p><a href="https://blog.csdn.net/qq_28284093/article/details/81031670" target="_blank" rel="noopener">https://blog.csdn.net/qq_28284093/article/details/81031670</a></p>
<h1 id="使用-postman-进行测试"><a href="#使用-postman-进行测试" class="headerlink" title="使用 postman 进行测试"></a>使用 postman 进行测试</h1><p><a href="https://segmentfault.com/a/1190000014144322" target="_blank" rel="noopener">https://segmentfault.com/a/1190000014144322</a></p>
<p><a href="https://community.postman.com/t/running-a-request-multiple-times-with-different-data-sets/1064" target="_blank" rel="noopener">https://community.postman.com/t/running-a-request-multiple-times-with-different-data-sets/1064</a></p>
<p><a href="https://github.com/epoberezkin/ajv" target="_blank" rel="noopener">https://github.com/epoberezkin/ajv</a></p>
<p>有关官多参数，有填，不填，null 个别的回传需要是什么要做验证，万一有 4 个参数以上交互起来就是 4 就要和每个参数的不同可能相乘<br><a href="https://testerhome.com/topics/11744" target="_blank" rel="noopener">https://testerhome.com/topics/11744</a></p>
<p>发送异步请求<br>pm.sendRequest(“<a href="https://postman-echo.com/get&quot;" target="_blank" rel="noopener">https://postman-echo.com/get&quot;</a>, function (err, response) {<br>console.log(response.json());</p>
<h1 id="postman-使用测试案例"><a href="#postman-使用测试案例" class="headerlink" title="postman 使用测试案例"></a>postman 使用测试案例</h1><p>因為 postman import file 只能够 同一个 collection 共用 data file<br>所以参考<br><a href="https://blog.travelex.io/automation-with-postman-collection-runner-4a28eb975abf" target="_blank" rel="noopener">https://blog.travelex.io/automation-with-postman-collection-runner-4a28eb975abf</a></p>
<p>过滤 data 的资料是否是指定给该请求<br>if(data.selectItemRequest!==pm.info.requestName){<br>postman.setNextRequest();<br>}<br>上面这样做不会成功，因為 setNextRequest()是在请求后呼叫的，所以写在 prerequest 并没有用，请求还是会被发送<br><a href="https://postman-quick-reference-guide.readthedocs.io/en/latest/cheatsheet.html" target="_blank" rel="noopener">https://postman-quick-reference-guide.readthedocs.io/en/latest/cheatsheet.html</a></p>
<p>pm.test.skip(“Status code is 200”, () =&gt; {<br>pm.response.to.have.status(200);<br>});</p>
<p>(skipTest ? pm.test.skip : pm.test)(‘should be valid’, function () {<br>// do something here<br>});<br>结论是目前 postman 还没办法针对个别请求设定测试资料，还不能根据资料来略过请求，為了避免麻烦，只好不使用 csv 和 json 的受测资料</p>
<p><a href="https://community.meraki.com/t5/Developers-APIs/Postman-run-multiple-request-with-different-variable-in-CSV-file/td-p/70234" target="_blank" rel="noopener">https://community.meraki.com/t5/Developers-APIs/Postman-run-multiple-request-with-different-variable-in-CSV-file/td-p/70234</a></p>
<h1 id="测试注意事项"><a href="#测试注意事项" class="headerlink" title="测试注意事项"></a>测试注意事项</h1><p>追踪 bug</p>
<h1 id="offline測試"><a href="#offline測試" class="headerlink" title="offline測試"></a>offline測試</h1><p>因為每間公司的環境不同，有些公司是不允許聯外網的<br> settings&gt;&gt;scratch pad<br><a href="https://community.postman.com/t/working-in-offline-mode/20174/79" target="_blank" rel="noopener">https://community.postman.com/t/working-in-offline-mode/20174/79</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/04/29/%E6%8F%90%E5%8D%87php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/29/%E6%8F%90%E5%8D%87php/" class="post-title-link" itemprop="url">提升php</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-04-29 12:02:24" itemprop="dateCreated datePublished" datetime="2020-04-29T12:02:24+08:00">2020-04-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2023-04-19 07:54:04" itemprop="dateModified" datetime="2023-04-19T07:54:04+08:00">2023-04-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>語言百百種，一開始入門的一個語言是 php，中途又跑去碰了 js，js 演變非常的快，來來回回耗費了許多生命，但是我只有一條命，是該專注於其中一種語言了，<br>即便這門語言不是那麼的賺錢</p>
<ul>
<li>php 葵花寶典<br><a href="https://www.awaimai.com/php" target="_blank" rel="noopener">https://www.awaimai.com/php</a><br><a href="https://www.cnblogs.com/aiweixiao/p/8202365.html" target="_blank" rel="noopener">https://www.cnblogs.com/aiweixiao/p/8202365.html</a><br><a href="http://t.ti-node.com/thread/6445811931549794305" target="_blank" rel="noopener">http://t.ti-node.com/thread/6445811931549794305</a><br><a href="https://mp.weixin.qq.com/s/NTbS3KtToodhFfdjrBjBsw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/NTbS3KtToodhFfdjrBjBsw</a><br><a href="https://phper.shujuwajue.com/phpxuan-xiang-he-yun-xing-yuan-li/php-sapi" target="_blank" rel="noopener">https://phper.shujuwajue.com/phpxuan-xiang-he-yun-xing-yuan-li/php-sapi</a></li>
</ul>
<p><a href="https://imyoungyang.gitbooks.io/php7-study-group-notes/content/packagist.html" target="_blank" rel="noopener">https://imyoungyang.gitbooks.io/php7-study-group-notes/content/packagist.html</a></p>
<p><a href="https://learnku.com/docs/php-internals/php7" target="_blank" rel="noopener">https://learnku.com/docs/php-internals/php7</a></p>
<ul>
<li>php 进阶探讨<br><a href="https://www.lanqiao.cn/library/advanced-php/" target="_blank" rel="noopener">https://www.lanqiao.cn/library/advanced-php/</a></li>
</ul>
<h1 id="什麼是-CGI、FastCGI、PHP-FPM"><a href="#什麼是-CGI、FastCGI、PHP-FPM" class="headerlink" title="什麼是 CGI、FastCGI、PHP-FPM"></a>什麼是 CGI、FastCGI、PHP-FPM</h1><p>CGI與FPM<br>CGI是一種協議，為了保證web server傳過來的資料是標準格式</p>
<p>比如說，如果請求 index.html，web server會去找到這個文件再丟給瀏覽器，但這個只限於靜態文件而已，如果是index.php呢，就需要去找php解析器來處理了，接下來web service就會把這個請求交給php 解析器處理，那會傳那一些資料呢?像是 post或是url還有http header等，CGI就是規定要傳哪些資料、以及怎麼樣的格式</p>
<p>FastCGI是什麼?<br>接下來又提到那FastCGI是什麼呢? FastCGI是用來提高CGI處理process性能用的</p>
<p>那FastCGI會怎麼實作呢?<br>當php啟動時、會去尋找php.ini、進行環境的初始化，如果不使用FastCGI的情況下，每一個請求都會做這個動作，很明顯浪費系統資源，所以FastCGI會先啟動一個master，解析配置文件用，接下來再啟動worker，當請求過來時、master會遞資訊給worker，然後接下來等下一個請求，有這個機制就不用每一次重新跑一次初始化的動作了</p>
<p>PHP-FPM<br>那PHP-FPM呢? Fastcgi是一個協議，其實是php-fpm實現了這個協議</p>
<p>php-fpm是管理fastcgi ，大概的關係就是這</p>
<p>所以最後才會造成如果修改php.ini檔案之後，才需要重新啟動php-fpm，原因就是這個樣子</p>
<p><a href="https://github.com/UniSharp/blog/blob/master/2017/10/04/Nginx%20%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98%EF%BC%88%E4%BA%8C%EF%BC%89FastCGI%20Proxying/index.html" target="_blank" rel="noopener">https://github.com/UniSharp/blog/blob/master/2017/10/04/Nginx%20%E5%AD%B8%E7%BF%92%E7%AD%86%E8%A8%98%EF%BC%88%E4%BA%8C%EF%BC%89FastCGI%20Proxying/index.html</a><br><a href="https://www.astralweb.com.tw/what-is-differences-between-fastcgi-php-fpm/" target="_blank" rel="noopener">https://www.astralweb.com.tw/what-is-differences-between-fastcgi-php-fpm/</a><br><a href="https://www.zybuluo.com/phper/note/50231" target="_blank" rel="noopener">https://www.zybuluo.com/phper/note/50231</a></p>
<h1 id="php-請求外部資源"><a href="#php-請求外部資源" class="headerlink" title="php 請求外部資源"></a>php 請求外部資源</h1><p>可以<br>file_get_contents<br>fopen<br>fsockopen<br>curl</p>
<h1 id="php-開啟服務"><a href="#php-開啟服務" class="headerlink" title="php 開啟服務"></a>php 開啟服務</h1><p>stream_socket_server()<br>workerman 的原理</p>
<h1 id="重構"><a href="#重構" class="headerlink" title="重構"></a>重構</h1><p><a href="https://docs.google.com/presentation/d/10vxyi5VXSSZ4MMjLrKAIhrnpmuCjdDaZ_4K7ma1KIys/edit" target="_blank" rel="noopener">https://docs.google.com/presentation/d/10vxyi5VXSSZ4MMjLrKAIhrnpmuCjdDaZ_4K7ma1KIys/edit</a></p>
<h2 id="避免用-switch"><a href="#避免用-switch" class="headerlink" title="避免用 switch"></a>避免用 switch</h2><p><a href="https://www.slideshare.net/kylinfish/php-best-practice-81744253" target="_blank" rel="noopener">https://www.slideshare.net/kylinfish/php-best-practice-81744253</a><br><a href="https://learnku.com/laravel/t/7468/please-keep-your-php-code-neat-and-tidy" target="_blank" rel="noopener">https://learnku.com/laravel/t/7468/please-keep-your-php-code-neat-and-tidy</a></p>
<h1 id="trait"><a href="#trait" class="headerlink" title="trait"></a>trait</h1><p>官网讲的非常清楚<br><a href="https://www.php.net/manual/zh/language.oop5.traits.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/language.oop5.traits.php</a><br>唯一缺的范例是，当 trait 的 function 和要使用的 class 冲突时,你不想复盖，想要拿来用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">FooTrait</span> &#123;</span><br><span class="line">	<span class="title">bar</span> <span class="title">as</span> <span class="title">traitBar</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://andy-carter.com/blog/overriding-extending-a-php-trait-method" target="_blank" rel="noopener">https://andy-carter.com/blog/overriding-extending-a-php-trait-method</a></p>
<h1 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h1><p>获取档案路径 class function params 等等的详细资料<br>还可以用来实例一个物件,而非传统的 new 关键字做出实例</p>
<h1 id="fun-fact"><a href="#fun-fact" class="headerlink" title="fun fact"></a>fun fact</h1><p>http_build_query()<br><a href="https://stackoverflow.com/questions/14761418/browser-mis-interpreting-not-in-url" target="_blank" rel="noopener">https://stackoverflow.com/questions/14761418/browser-mis-interpreting-not-in-url</a></p>
<h1 id="array-vs"><a href="#array-vs" class="headerlink" title="array() vs []"></a>array() vs []</h1><p>版本問題，5.4 之後推薦使用[]為標準用法</p>
<h1 id="new-static"><a href="#new-static" class="headerlink" title="new static()"></a>new static()</h1><p><a href="https://xyz.cinc.biz/2016/11/php-new-self-vs-new-static.html" target="_blank" rel="noopener">PHP new self 、new static 比較</a><br>new self() =&gt; 生成的物件為實際寫有這句 code 的 class<br>new static() =&gt;生成的物件為呼叫使用這句 code 的 class</p>
<h1 id="PHP-EOL"><a href="#PHP-EOL" class="headerlink" title="PHP_EOL"></a>PHP_EOL</h1><p>PHP_EOL 是一个些已经定义好的常量，代表 php 的换行符，这个变量会根据平台而变，在 windows 下会是/r/n，在 linux 下是/n，在 mac 下是/r。<br>$str = str_replace(PHP_EOL, ‘’, $str);<br>這段程式碼，在單一來源的輸入沒問題，產出會隨著作業系統做變動，但是<br>如果<br>輸入有可能來自不同作業系統，我們沒辦法確定來源作業系統與 server 的相同<br>那會用到的情境是，我們有使用 rsa 密鑰，但他是.PEM 金鑰複製貼上的，為了避免 user 的 editor 太過聰明，直接依照作業系統換行，我們後端需要有處理換行的動作<br><a href="https://www.cnblogs.com/cxx8181602/p/9132946.html" target="_blank" rel="noopener">https://www.cnblogs.com/cxx8181602/p/9132946.html</a></p>
<p>$str = str_replace(array(“/r/n”, “/r”, “/n”), “”, $str);<br><a href="https://9iphp.com/web/php/1006.html" target="_blank" rel="noopener">https://9iphp.com/web/php/1006.html</a></p>
<p>或是正則<br>$skuList = preg_split(‘/\r\n|\r|\n/‘, $_POST[‘skuList’]);</p>
<h1 id="php5-2"><a href="#php5-2" class="headerlink" title="php5.2"></a>php5.2</h1><p>RSA256<br><a href="https://stackoverflow.com/questions/10524198/what-version-of-openssl-is-needed-to-sign-with-sha256withrsaencryption" target="_blank" rel="noopener">https://stackoverflow.com/questions/10524198/what-version-of-openssl-is-needed-to-sign-with-sha256withrsaencryption</a></p>
<h1 id="php-雙引號"><a href="#php-雙引號" class="headerlink" title="php 雙引號"></a>php 雙引號</h1><p>php 雙引號可以直接帶出變數</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">"hello $name"</span>;</span><br><span class="line"><span class="comment">//等同於</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"hello &#123;$name&#125;"</span>;</span><br></pre></td></tr></table></figure>

<h1 id="php-echo"><a href="#php-echo" class="headerlink" title="php echo"></a>php echo</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> $name; <span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//等同於</span></span><br><span class="line"><span class="meta">&lt;?</span>= $name <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="php-防止跨站腳本"><a href="#php-防止跨站腳本" class="headerlink" title="php 防止跨站腳本"></a>php 防止跨站腳本</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htmlspecialchars($_Get[<span class="string">'userInput'</span>]);</span><br></pre></td></tr></table></figure>

<h1 id="php-節省-html-中的大括號"><a href="#php-節省-html-中的大括號" class="headerlink" title="php 節省 html 中的大括號{}"></a>php 節省 html 中的大括號{}</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>():</span><br><span class="line"><span class="keyword">endforeach</span>;</span><br><span class="line"><span class="keyword">if</span>():</span><br><span class="line"><span class="keyword">endif</span>;</span><br></pre></td></tr></table></figure>

<h1 id="php-compact"><a href="#php-compact" class="headerlink" title="php compact"></a>php compact</h1><p>取變數名組成關聯陣列</p>
<h1 id="php-extract"><a href="#php-extract" class="headerlink" title="php extract"></a>php extract</h1><p>取關聯陣列 key value 產出變數</p>
<h1 id="php-new-self-new-static"><a href="#php-new-self-new-static" class="headerlink" title="php new self , new static"></a>php new self , new static</h1><p><a href="https://xyz.cinc.biz/2016/11/php-new-self-vs-new-static.html" target="_blank" rel="noopener">https://xyz.cinc.biz/2016/11/php-new-self-vs-new-static.html</a><br>new self() =&gt; 生成的物件為實際寫有這句 code 的 class<br>new static() =&gt;生成的物件為呼叫使用這句 code 的 class<br>一般就推荐用 static() 才不会有机会实例出父类别</p>
<h1 id="為什麼要用-require-而不是-include；為什麼要用-require-而不是-require-once"><a href="#為什麼要用-require-而不是-include；為什麼要用-require-而不是-require-once" class="headerlink" title="為什麼要用 require 而不是 include；為什麼要用 require 而不是 require_once"></a>為什麼要用 require 而不是 include；為什麼要用 require 而不是 require_once</h1><p>include 僅會拋出 Warning<br>require_once ，因為在執行時期完全沒有任何警告或錯誤，以致於造成冗餘程式碼<br>require 會在引入時發生錯誤時（例如被引入目標不存在）拋出 Error 且終止應用程式<br>composer autoload 有這 4 種方式<br>psr0,psr4,classmap,files 自動載入</p>
<h1 id="製作-composer-package"><a href="#製作-composer-package" class="headerlink" title="製作 composer package"></a>製作 composer package</h1><p><a href="https://rivsen.github.io/post/how-to-publish-package-to-packagist-using-github-and-composer-step-by-step" target="_blank" rel="noopener">https://rivsen.github.io/post/how-to-publish-package-to-packagist-using-github-and-composer-step-by-step</a></p>
<h1 id="composer-replace-取代一個套件"><a href="#composer-replace-取代一個套件" class="headerlink" title="composer replace 取代一個套件"></a>composer replace 取代一個套件</h1><h2 id="fork-出沒有人維護的包-用-fork-的包來取代其他有用這個包的依賴"><a href="#fork-出沒有人維護的包-用-fork-的包來取代其他有用這個包的依賴" class="headerlink" title="fork 出沒有人維護的包,用 fork 的包來取代其他有用這個包的依賴"></a>fork 出沒有人維護的包,用 fork 的包來取代其他有用這個包的依賴</h2><p><a href="https://jaceju.net/composer-replace/" target="_blank" rel="noopener">https://jaceju.net/composer-replace/</a></p>
<h2 id="安裝沒有在-packagist-上註冊的私人套件"><a href="#安裝沒有在-packagist-上註冊的私人套件" class="headerlink" title="安裝沒有在 packagist 上註冊的私人套件"></a>安裝沒有在 packagist 上註冊的私人套件</h2><p><a href="https://blog.johnsonlu.org/getting-started-with-composer/" target="_blank" rel="noopener">https://blog.johnsonlu.org/getting-started-with-composer/</a><br><a href="https://www.hellosanta.com.tw/blog/how-to-add-3rd-party-plugin-by-using-composer" target="_blank" rel="noopener">https://www.hellosanta.com.tw/blog/how-to-add-3rd-party-plugin-by-using-composer</a></p>
<h2 id="設定私有庫來源，並給予帳密"><a href="#設定私有庫來源，並給予帳密" class="headerlink" title="設定私有庫來源，並給予帳密"></a>設定私有庫來源，並給予帳密</h2><p><a href="https://stackoverflow.com/questions/35082739/composer-asks-only-for-password-with-private-repository" target="_blank" rel="noopener">https://stackoverflow.com/questions/35082739/composer-asks-only-for-password-with-private-repository</a></p>
<h1 id="laravel-的方法"><a href="#laravel-的方法" class="headerlink" title="laravel 的方法"></a>laravel 的方法</h1><p><a href="https://docs.chipperci.com/builds/composer-auth/" target="_blank" rel="noopener">https://docs.chipperci.com/builds/composer-auth/</a></p>
<h1 id="composer-autoload-的幾種方式"><a href="#composer-autoload-的幾種方式" class="headerlink" title="composer autoload 的幾種方式"></a>composer autoload 的幾種方式</h1><p><a href="https://malagege.github.io/blog/2019/01/19/composer%E4%BD%BF%E7%94%A8psr0-psr4-classmap-files%E8%87%AA%E5%8B%95%E8%BC%89%E5%85%A5%E7%B4%80%E9%8C%84/" target="_blank" rel="noopener">https://malagege.github.io/blog/2019/01/19/composer%E4%BD%BF%E7%94%A8psr0-psr4-classmap-files%E8%87%AA%E5%8B%95%E8%BC%89%E5%85%A5%E7%B4%80%E9%8C%84/</a></p>
<h1 id="RSA-公鑰"><a href="#RSA-公鑰" class="headerlink" title="RSA 公鑰"></a>RSA 公鑰</h1><p>openssl_get_publickey server 回傳 false，但在本機正常，原本以為是作業系統不同的問題，<br>一查可能是因為 php 版本的問題，為了應付<br>網路上說</p>
<pre><code>我知道了 其实公钥是不能放在一行写的，要用原来demo里的，支付宝还告诉我一定要放在一行写，坑爹啊
一行书写，在windows下是正常的，在linux下返回false</code></pre><p>上面寫的不全正確，應為我環境都是 linux 照樣一個報錯一個沒報<br>server php 5.6.24<br>local PHP 5.6.40<br>在這裡筆記一下<br>每 64 字元換行</p>
<h1 id="json-encode-出線換行符"><a href="#json-encode-出線換行符" class="headerlink" title="json_encode 出線換行符"></a>json_encode 出線換行符</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json_encode($data,<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>即可回傳正常 json</p>
<h1 id="列出-php-加密演算法列表"><a href="#列出-php-加密演算法列表" class="headerlink" title="列出 php 加密演算法列表"></a>列出 php 加密演算法列表</h1><p>print_r(hash_algos());</p>
<h1 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h1><p>commandline php -i</p>
<h1 id="xdebug-配置"><a href="#xdebug-配置" class="headerlink" title="xdebug 配置"></a>xdebug 配置</h1><p>[root] # cd /usr/local/src<br>[root] # tar zxvf xdebug-2.6.0RC2.tgz<br>[root] # cd xdebug-2.6.0RC2<br>[root] # /usr/local/php/bin/phpize<br>[root] # ./configure –enable-xdebug  –with-php-config=/usr/local/php/bin/php-config<br>[root] # make &amp;&amp; make install<br>zend_extension=xdebug.so //指定Xdebug扩展文件的路径<br>xdebug.remote_enable=1 //是否开启远程调试<br>xdebug.remote_handler=dbgp //指定远程调试的处理协议<br>xdebug.remote_mode=req //可以设为req或jit，req表示脚本一开始运行就连接远程客户端，jit表示脚本出错时才连接远程客户端。<br>xdebug.remote_host=192.168.1.98 //指定远程调试的主机名（安装phpstorm的主机ip）<br>xdebug.remote_port=9001 //指定远程调试的端口号<br>xdebug.idekey=”PHPSTORM” //指定传递给DBGp调试器处理程序的IDE Key<br>xdebug 配置並不簡單<br><a href="https://segmentfault.com/a/1190000011907425" target="_blank" rel="noopener">https://segmentfault.com/a/1190000011907425</a><br><a href="https://segmentfault.com/a/1190000018961750" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018961750</a><br><a href="https://www.yisu.com/zixun/39716.html" target="_blank" rel="noopener">https://www.yisu.com/zixun/39716.html</a></p>
<h1 id="disable-fucntion"><a href="#disable-fucntion" class="headerlink" title="disable_fucntion"></a>disable_fucntion</h1><p><a href="https://www.anquanke.com/post/id/197745" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197745</a></p>
<h1 id="php-lint"><a href="#php-lint" class="headerlink" title="php lint"></a>php lint</h1><p>雖然 phpstorm 內建整合 php-cs-fixer ，跟 laravel 一樣的套件<br><a href="https://laracasts.com/discuss/channels/laravel/php-cs-config-for-php-cs-fixer" target="_blank" rel="noopener">https://laracasts.com/discuss/channels/laravel/php-cs-config-for-php-cs-fixer</a><br>阿我們還是希望協作者能夠在提交前跑一次格式檢查<br>此時就會用到<br>使用 Git pre-commit 自動修正 PHP 的 Coding Style<br><a href="https://codefun.tw/2019/2019051901-php-coding-style-fix-with-git" target="_blank" rel="noopener">https://codefun.tw/2019/2019051901-php-coding-style-fix-with-git</a></p>
<h1 id="字串比較"><a href="#字串比較" class="headerlink" title="字串比較"></a>字串比較</h1><p>mbstring 使用了国家默认语言设置（NLS），所以在做字串長度比較時，需要注意<br>mbstring.language = UTF-8<br>mbstring.internal_encoding = UTF-8</p>
<h1 id="fastcgi-finish-request"><a href="#fastcgi-finish-request" class="headerlink" title="fastcgi_finish_request"></a>fastcgi_finish_request</h1><p>当PHP运行在FastCGI模式时，PHP FPM提供了一个名为fastcgi_finish_request的方法。按照文档上的说法，此方法可以提高请求的处理速度，如果有些处理可以在页面生成完后再进行，就可以使用这个方法</p>
<p><a href="https://blog.huoding.com/2011/04/12/63" target="_blank" rel="noopener">https://blog.huoding.com/2011/04/12/63</a></p>
<h1 id="精度問題"><a href="#精度問題" class="headerlink" title="精度問題"></a>精度問題</h1><p>所有程式語言一定都有的問題，因為二進位無法完美表示浮點數<br>php官方建議如果需要高位數的計算的話，需要使用BC Math或是GMP<br><a href="https://blog.walile.info/2013/06/14/about-php-float-problem/" target="_blank" rel="noopener">關於php浮點數float以及int的問題</a></p>
<h1 id="PHP-sleep-是否会占用很多资源？"><a href="#PHP-sleep-是否会占用很多资源？" class="headerlink" title="PHP sleep() 是否会占用很多资源？"></a>PHP sleep() 是否会占用很多资源？</h1><p> sleep本身不占CPU资源, 但是在基于PHP的LAMP环境中, 就不能这样说了, 因为CPU不是唯一的资源. 进程数, 内存, 这些都是资源.</p>
<h1 id="PHP運用多執行緒"><a href="#PHP運用多執行緒" class="headerlink" title="PHP運用多執行緒"></a>PHP運用多執行緒</h1><p> php可以利用其他的東西來實現偽多進程，多線程，例如：fsockopen實際是利用socket的多線程，popen，pcntl_fork ，proc_open利用httpd多進程功能的外衣<br> <a href="https://bps1025.blogspot.com/2018/10/php-multi-threadprocopen.html" target="_blank" rel="noopener">《面試官別再問》PHP運用多執行緒(Multi-thread)實現非阻塞方法</a><br> <a href="https://stackoverflow.com/questions/2267345/how-do-you-make-good-use-of-multicore-cpus-in-your-php-mysql-applications" target="_blank" rel="noopener">How do you make good use of multicore CPUs in your PHP/MySQL applications?</a></p>
<h1 id="PHP-MySQL多语句执行"><a href="#PHP-MySQL多语句执行" class="headerlink" title="PHP+MySQL多语句执行"></a>PHP+MySQL多语句执行</h1><p> <a href="http://www.jinglingshu.org/?p=3941" target="_blank" rel="noopener">http://www.jinglingshu.org/?p=3941</a><br> 实际上mysql早在4.1版本就允许多语句执行。只是PHP自身限制了这种用法。</p>
<h1 id="composer-autoload會佔據記憶體嗎"><a href="#composer-autoload會佔據記憶體嗎" class="headerlink" title="composer autoload會佔據記憶體嗎"></a>composer autoload會佔據記憶體嗎</h1><p> 答:不會</p>
<p> 如果下面連結說的是正確的話， 會在實際new的時候才載入CODE，記憶體一開始autoload只是一個檔案位址的陣列<br> <a href="https://stackoverflow.com/questions/37283217/composer-dont-use-autoload-and-load-single-classes" target="_blank" rel="noopener">https://stackoverflow.com/questions/37283217/composer-dont-use-autoload-and-load-single-classes</a></p>
<h1 id="效能調校"><a href="#效能調校" class="headerlink" title="效能調校"></a>效能調校</h1><ul>
<li><p>where:local端測試</p>
</li>
<li><p>when: testing，deploying</p>
</li>
<li><p>what: 執行時間，記憶體使用量</p>
</li>
<li><p>目標:在效能與可維護之間做平衡<br><a href="https://www.youtube.com/watch?v=hOajLLej68Y" target="_blank" rel="noopener">https://www.youtube.com/watch?v=hOajLLej68Y</a></p>
<h1 id="amp-before-the-function-name"><a href="#amp-before-the-function-name" class="headerlink" title="&amp; before the function name"></a>&amp; before the function name</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $properties = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> &amp;<span class="title">__get</span><span class="params">($name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;properties[$name];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//If I hadn't used &amp; there, this wouldn't be possible:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($name, $value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;properties[$name] = $value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$foobar = <span class="keyword">new</span> FooBar;</span><br><span class="line">$foobar-&gt;subArray = <span class="keyword">array</span>();</span><br><span class="line">$foobar-&gt;subArray[<span class="string">'FooBar'</span>] = <span class="string">'Hallo World!'</span>;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p> Instead PHP would thrown an error saying something like ‘cannot indirectly modify overloaded property’.<br> <a href="https://stackoverflow.com/questions/3255516/what-does-before-the-function-name-signify" target="_blank" rel="noopener">https://stackoverflow.com/questions/3255516/what-does-before-the-function-name-signify</a><br> <a href="https://stackoverflow.com/questions/21058439/is-there-ever-a-need-to-use-ampersand-in-front-of-an-object" target="_blank" rel="noopener">https://stackoverflow.com/questions/21058439/is-there-ever-a-need-to-use-ampersand-in-front-of-an-object</a></p>
<h1 id="PHP-強制使用「強型態」的模式"><a href="#PHP-強制使用「強型態」的模式" class="headerlink" title="PHP 強制使用「強型態」的模式"></a>PHP 強制使用「強型態」的模式</h1> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span>(strict_types = <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h1 id="json-encode-浮点小数溢出错误"><a href="#json-encode-浮点小数溢出错误" class="headerlink" title="json_encode() 浮点小数溢出错误"></a>json_encode() 浮点小数溢出错误</h1><p> 该现象只出现在PHP 7.1+版本上<br> 這個就是只有靠經驗才會知道的知識點<br> 可以靠serialize_precision這個解決</p>
<h1 id="pdo和mysqli"><a href="#pdo和mysqli" class="headerlink" title="pdo和mysqli"></a>pdo和mysqli</h1><p> 這兩個庫都是很熱門的資料庫API，各有優缺點，但pdo不只支援mysql</p>
<p> <a href="https://websitebeaver.com/php-pdo-vs-mysqli" target="_blank" rel="noopener">PDO vs. MySQLi: The Battle of PHP Database APIs</a></p>
<h1 id="假設你要測量一個php-function的效能，要如何在不影響原有代碼的情況下，標記執行時間呢"><a href="#假設你要測量一個php-function的效能，要如何在不影響原有代碼的情況下，標記執行時間呢" class="headerlink" title="假設你要測量一個php function的效能，要如何在不影響原有代碼的情況下，標記執行時間呢?"></a>假設你要測量一個php function的效能，要如何在不影響原有代碼的情況下，標記執行時間呢?</h1><p> <a href="https://stackoverflow.com/questions/9262158/how-can-i-inject-and-remove-php-code-before-a-function-call" target="_blank" rel="noopener">https://stackoverflow.com/questions/9262158/how-can-i-inject-and-remove-php-code-before-a-function-call</a></p>
<h1 id="json-deocde"><a href="#json-deocde" class="headerlink" title="json_deocde"></a>json_deocde</h1><p> 在接收兩個幾乎相同的字串時，php json_decode 會報出 syntax error的錯<br> 錯的原因，雙引號前面多了個slash，奇怪的是我單純放進input後端magic quote產生有slash的字串不會錯，但是前端JSON.Stringfy()之後放進input 後端產生有slash的字串卻抱錯了<br> <a href="https://stackoverflow.com/questions/14757983/json-post-with-magic-quotes-plus-a-quote-character-in-the-data" target="_blank" rel="noopener">https://stackoverflow.com/questions/14757983/json-post-with-magic-quotes-plus-a-quote-character-in-the-data</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/04/28/%E5%B8%B8%E7%94%A8%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/28/%E5%B8%B8%E7%94%A8%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">常用的快捷键</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-04-28 16:53:47" itemprop="dateCreated datePublished" datetime="2020-04-28T16:53:47+08:00">2020-04-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2022-02-24 15:45:17" itemprop="dateModified" datetime="2022-02-24T15:45:17+08:00">2022-02-24</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>各個 ide 設定可以參考<br><a href="https://curder.gitbooks.io/blog/" target="_blank" rel="noopener">https://curder.gitbooks.io/blog/</a></p>
<h1 id="phpstorm"><a href="#phpstorm" class="headerlink" title="phpstorm"></a>phpstorm</h1><p>時常會有教學和的快捷建和現在的對不起來<br><a href="https://shortcutworld.com/PhpStorm/win/JetBrains-PhpStorm_Shortcuts" target="_blank" rel="noopener">https://shortcutworld.com/PhpStorm/win/JetBrains-PhpStorm_Shortcuts</a><br><a href="https://shortcutworld.com/PhpStorm/mac/JetBrains-PhpStorm_Shortcuts" target="_blank" rel="noopener">https://shortcutworld.com/PhpStorm/mac/JetBrains-PhpStorm_Shortcuts</a><br><a href="https://shortcutworld.com/PhpStorm/linux/JetBrains-PhpStorm_Shortcuts" target="_blank" rel="noopener">https://shortcutworld.com/PhpStorm/linux/JetBrains-PhpStorm_Shortcuts</a><br>交互參考就可以找到答案</p>
<p>然後你可以發現，這跟其他的編輯器幾乎完全不一樣，你還要在適應新的編輯器嗎？<br>所以不要怕，大膽的給他改下去<br>或者找 vsc 等等的 keymap 給他用下去</p>
<p>deployment<br><a href="https://stackoverflow.com/questions/26180982/phpstorm-working-with-git-branches-and-remote-deployment" target="_blank" rel="noopener">https://stackoverflow.com/questions/26180982/phpstorm-working-with-git-branches-and-remote-deployment</a></p>
<ul>
<li>shift*2 會跳出搜尋框，可以搜尋檔名或 namespace</li>
<li>ctrl + shift + F 搜尋所有的檔案裡面有相關字串的 記得切換輸入法回英文</li>
<li>ctrl + shift + R 搜尋所有的檔案裡面有相關字串的並取代</li>
<li>ctrl + F12 列出 class 裡面的 function</li>
<li>ctrl + 滑鼠左鍵 會列出這個變數方法類別有用到的地方</li>
<li>shift + F6 重构名字</li>
<li>ctrl + D 複製該行</li>
<li>ctrl + shift + ↑ 移動該行</li>
<li>shift + click 快速关闭分</li>
<li>ctrl + shift + backspace 回到上一个编辑的地方</li>
<li>ctrl + alt + U show 出继承图</li>
<li>window + alt +click 多鼠标</li>
<li>ctrl + alt + L 格式化 code (会和 ubuntu 跳到登入页冲突，须去 ubuntu 取消此快捷)</li>
<li>alt + shift + insert 被选择行多属标</li>
<li>window + alt + J 选取相同的字串</li>
<li>跳回上一個滑鼠在的地方(RDP不能正常運作必須自訂<a href="https://intellij-support.jetbrains.com/hc/en-us/community/posts/206573029-Way-to-jump-back-to-previous-file-line-after-Ctrl-clicking-function-call-" target="_blank" rel="noopener">https://intellij-support.jetbrains.com/hc/en-us/community/posts/206573029-Way-to-jump-back-to-previous-file-line-after-Ctrl-clicking-function-call-</a>)</li>
</ul>
<h2 id="代碼提示"><a href="#代碼提示" class="headerlink" title="代碼提示"></a>代碼提示</h2><p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Myclass::class</span><br><span class="line"><span class="comment">// 會報錯，代表php沒升到7.x版，那可能是因為composer.json有設定PHP的版本，去把他刪除，然後去設定，languages &amp; frameworks&gt;&gt;php&gt;&gt;php languages level: 7.3，這樣報錯就會消失了</span></span><br></pre></td></tr></table></figure>

<h1 id="ubuntu-destop"><a href="#ubuntu-destop" class="headerlink" title="ubuntu destop"></a>ubuntu destop</h1><ul>
<li>window + P 萤幕互换</li>
<li>ctrl + alt + t 新的 terminal</li>
<li>ctrl + shift + F 繁简转换</li>
</ul>
<h1 id="vsc"><a href="#vsc" class="headerlink" title="vsc"></a>vsc</h1><ul>
<li>alt + ↑ 移動該行</li>
</ul>
<h2 id="關鍵字多光標"><a href="#關鍵字多光標" class="headerlink" title="關鍵字多光標"></a>關鍵字多光標</h2><p>多光標，選取單字之後 ctrl+D</p>
<h2 id="自動關閉標籤"><a href="#自動關閉標籤" class="headerlink" title="自動關閉標籤"></a>自動關閉標籤</h2><p>To automate this go to.<br>File &gt; Preferences &gt; Keyboard Shortcuts<br>and add this into your keybindings.json (right hand side window)<br>{<br>“key”: “ctrl+shift+enter”,<br>“command”: “editor.emmet.action.wrapWithAbbreviation”,<br>“when”: “editorTextFocus &amp;&amp; !editorReadonly”<br>}</p>
<h2 id="使用-gitbash"><a href="#使用-gitbash" class="headerlink" title="使用 gitbash"></a>使用 gitbash</h2><p><a href="https://stackoverflow.com/questions/42606837/how-do-i-use-bash-on-windows-from-the-visual-studio-code-integrated-terminal" target="_blank" rel="noopener">https://stackoverflow.com/questions/42606837/how-do-i-use-bash-on-windows-from-the-visual-studio-code-integrated-terminal</a></p>
<h2 id="代碼提示-1"><a href="#代碼提示-1" class="headerlink" title="代碼提示"></a>代碼提示</h2><p>有的時候代碼提示會失效<br>預設的鍵盤快捷鍵又跟 windows 衝突<br>改成 alt+/試試</p>
<h1 id="nano"><a href="#nano" class="headerlink" title="nano"></a>nano</h1><p>esc + $ 自动换行</p>
<h1 id="chrome"><a href="#chrome" class="headerlink" title="chrome"></a>chrome</h1><p><a href="https://youtu.be/xSrpjGSNqvI" target="_blank" rel="noopener">50 个 Chrome Developer Tools 必备技巧</a></p>
<h1 id="自動補齊雙引號後換下一行"><a href="#自動補齊雙引號後換下一行" class="headerlink" title="自動補齊雙引號後換下一行"></a>自動補齊雙引號後換下一行</h1><p><a href="https://stackoverflow.com/questions/21127613/how-to-continue-typing-after-auto-completed-pair-of-brackets-double-quotes" target="_blank" rel="noopener">https://stackoverflow.com/questions/21127613/how-to-continue-typing-after-auto-completed-pair-of-brackets-double-quotes</a></p>
<h1 id="phpstrom-arrary-對齊"><a href="#phpstrom-arrary-對齊" class="headerlink" title="phpstrom arrary 對齊"></a>phpstrom arrary 對齊</h1><p>1) Open PHP Storm</p>
<p>2) Goto settings</p>
<p>3) Find editor tab &gt; Code style &gt; PHP</p>
<p>4) Now you will find the option “Wrapping and braces” (3rd tab)</p>
<p>5) Now within that tab last 3rd option you will find Array Initializer (select the first 2 options. checkout screenshot)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://dkchange.github.io/2020/04/06/%E5%AE%89%E8%A3%9Dyii/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanley Ke">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="蛋粒個人網誌">
    </span>

    
    
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/06/%E5%AE%89%E8%A3%9Dyii/" class="post-title-link" itemprop="url">使用yii2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間：2020-04-06 14:51:59" itemprop="dateCreated datePublished" datetime="2020-04-06T14:51:59+08:00">2020-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間：2021-12-31 17:39:34" itemprop="dateModified" datetime="2021-12-31T17:39:34+08:00">2021-12-31</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BE%8C%E7%AB%AF%E8%B7%AF%E7%B7%9A/" itemprop="url" rel="index"><span itemprop="name">後端路線</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BE%8C%E7%AB%AF%E8%B7%AF%E7%B7%9A/framework/" itemprop="url" rel="index"><span itemprop="name">framework</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BE%8C%E7%AB%AF%E8%B7%AF%E7%B7%9A/framework/yii2/" itemprop="url" rel="index"><span itemprop="name">yii2</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>你需要知道的 yii<br><a href="https://easy-yii.github.io/2017/01/09/know-PartFive/" target="_blank" rel="noopener">https://easy-yii.github.io/2017/01/09/know-PartFive/</a></p>
<p>PHP 目前最流行的 2 大框架，Laravel 和 Yii 的對比<br>隨著新興的微服務/納米服務體系結構以及對具有獨立維護/部署的小型服務的需求，因此不再建議需要做很多事情的大型框架，所以最近框架也將一些非必要的功能拆出。<br>兩大框架用更新速度來看 大概就是青少年 ，對上中年男子…<br>工作需求開始學 yii<br><a href="https://www.yii-china.com/" target="_blank" rel="noopener">https://www.yii-china.com/</a><br>文檔可能我還不習慣，頭看得很痛<br><a href="https://yii2-framework.readthedocs.io/en/stable/" target="_blank" rel="noopener">https://yii2-framework.readthedocs.io/en/stable/</a></p>
<h1 id="安裝-yii"><a href="#安裝-yii" class="headerlink" title="安裝 yii"></a>安裝 yii</h1><p>懶人包影片<br><a href="https://youtu.be/sRJ6GYiCwkI" target="_blank" rel="noopener">https://youtu.be/sRJ6GYiCwkI</a></p>
<p><a href="http://www.fancyecommerce.com/2016/05/18/yii2-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84bootstrap%E8%BF%87%E7%A8%8B-%E5%BC%95%E5%AF%BC/" target="_blank" rel="noopener">http://www.fancyecommerce.com/2016/05/18/yii2-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84bootstrap%E8%BF%87%E7%A8%8B-%E5%BC%95%E5%AF%BC/</a><br>看起來 yii 分兩種版本，一種是有 init 檔的下面會提到<br>php composer.phar create-project yiisoft/yii2-app-basic basic 2.0.15<br>php composer.phar create-project yiisoft/yii2-app-advanced advanced 2.0.15<br>這兩個專案的資料夾結構完全不同，切記，一開始吃了悶虧在研究，所以公司的專案，並沒有因為 docker 就把 yii 的資料夾結構做修改</p>
<h1 id="yii-資料夾結構"><a href="#yii-資料夾結構" class="headerlink" title="yii 資料夾結構"></a>yii 資料夾結構</h1><p><a href="https://learnku.com/articles/31435" target="_blank" rel="noopener">https://learnku.com/articles/31435</a></p>
<h2 id="yii-basic-大致介紹"><a href="#yii-basic-大致介紹" class="headerlink" title="yii basic 大致介紹"></a>yii basic 大致介紹</h2><p>assets 前端打包用<br>commands console 命令用<br>config<br>controller<br>mail email templates<br>model<br>runtime 框架產生的檔案<br>tests<br>vagrant vagrant container system<br>vendor all package<br>view<br>web 入口文件<br>widget 使用者界面的元件</p>
<h2 id="yii-advance"><a href="#yii-advance" class="headerlink" title="yii advance"></a>yii advance</h2><p>公司的專案大多採用此架構，進而分出其他的專案例如 api 等等<br>如何新增 api 專案就看下面的教學<br><a href="https://blog.csdn.net/post_mans/article/details/72876763" target="_blank" rel="noopener">https://blog.csdn.net/post_mans/article/details/72876763</a></p>
<h1 id="設置-yii"><a href="#設置-yii" class="headerlink" title="設置 yii"></a>設置 yii</h1><p>all the key in config file are the public properties of the application,<br><a href="https://www.yiiframework.com/doc/guide/2.0/en/structure-applications" target="_blank" rel="noopener">https://www.yiiframework.com/doc/guide/2.0/en/structure-applications</a><br>id<br>name<br>language<br>defaultRoute=&gt;’site/login’ 預設入口<br>layout=&gt;’main view 的預設模板<br>layoutpath=&gt; 改變 layout 路徑<br>on beforeRequest 常數事件<br>all the components are singleton objects<br>component=&gt;你看得到的預設設定都是核心元件<br>像是<br>request cache user errorHandler db log mailer …<br>那有些元件會沒有設定 class 代表，這個元件的 class 是由核心決定傳入的 key 是什，就用哪個 class<br><a href="https://youtu.be/iB-CllQVZTg" target="_blank" rel="noopener">https://youtu.be/iB-CllQVZTg</a><br>再來就是註冊完 component 之後，可用 yii::＄ app-&gt;componentname 來存取，如果沒有存取，就不會實例化這個 class，<br>‘test’=&gt;[<br>class=&gt;’app/component/test’<br>]<br>OR<br>‘test’=&gt;function(){<br>return new app/component/test();<br>}<br>也可以和 boostrap 這個屬性做搭配，註冊在這裡面的一定會被實例化</p>
<h2 id="uncomment-the-code-of-url-manager"><a href="#uncomment-the-code-of-url-manager" class="headerlink" title="uncomment the code of url manager"></a>uncomment the code of url manager</h2><p>記得記 log 的資料夾和前端 assets 的寫入權限要打開，如果你的專案權限沒設定的話，就打開成 777 吧</p>
<h2 id="yii-basic-遇到的問題"><a href="#yii-basic-遇到的問題" class="headerlink" title="yii basic 遇到的問題"></a>yii basic 遇到的問題</h2><p>cookieValidationKey must be configured with a secret key<br><a href="https://stackoverflow.com/questions/38824006/error-when-installed-yii2" target="_blank" rel="noopener">https://stackoverflow.com/questions/38824006/error-when-installed-yii2</a></p>
<p>yii 的設置可能是整個專案最重要的一環，一定要懂的如何設定，<br><a href="https://www.yiiframework.com/doc/guide/2.0/en/concept-configurations" target="_blank" rel="noopener">https://www.yiiframework.com/doc/guide/2.0/en/concept-configurations</a><br>個人覺得英文版的參考文檔要比簡中版本的易懂，所以如果看不懂簡中的，可以試著看看英文版</p>
<h1 id="開啟-debug-工具"><a href="#開啟-debug-工具" class="headerlink" title="開啟 debug 工具"></a>開啟 debug 工具</h1><h2 id="遭遇問題"><a href="#遭遇問題" class="headerlink" title="遭遇問題"></a>遭遇問題</h2><p>config 的 allowIPs 要設定好<br>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'bootstrap'</span> =&gt; [<span class="string">'debug'</span>],</span><br><span class="line"><span class="string">'modules'</span> =&gt; [</span><br><span class="line">    <span class="string">'debug'</span> =&gt; [</span><br><span class="line">        <span class="string">'class'</span> =&gt; <span class="string">'yii\debug\Module'</span>,</span><br><span class="line">        <span class="string">'allowedIPs'</span> =&gt; [<span class="string">'127.0.0.1'</span>, <span class="string">'::1'</span>,<span class="string">'172.19.*'</span>],</span><br><span class="line">    ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>runtime 的資料夾權限記得改為可寫入</p>
<h1 id="yii-知識點"><a href="#yii-知識點" class="headerlink" title="yii 知識點"></a>yii 知識點</h1><p>Yii2 use “new” everywhere to create models.<br>Why Yii2 use “new” everywhere while pushing their “Dependency Injection Container” feature that is not compatible with “new”<br>Performance mainly.<br><a href="https://forum.yiiframework.com/t/new-vs-yii-createobject/86677" target="_blank" rel="noopener">https://forum.yiiframework.com/t/new-vs-yii-createobject/86677</a></p>
<h1 id="安裝完之後"><a href="#安裝完之後" class="headerlink" title="安裝完之後"></a>安裝完之後</h1><p><a href="https://github.com/yiisoft/yii2-app-advanced/blob/master/init" target="_blank" rel="noopener">https://github.com/yiisoft/yii2-app-advanced/blob/master/init</a></p>
<h2 id="遭遇問題-1"><a href="#遭遇問題-1" class="headerlink" title="遭遇問題"></a>遭遇問題</h2><p>to solve problem like<br>Unable to write the file ‘/var/www/yiitest/models/Country.php’<br>php init<br>之後產生出來的檔案 yii 都歸在 ignore<br>然後實驗證明官方的 php init 並不會幫你改其他資料夾的權限，但是 runtime 的資料夾權限會幫你改，才能記 log</p>
<p>chmod -R 777 -R .<br>為何经由 gii 安装出来的档案 owner 会是 apache,原因是除了 nginx.conf 档要修改以外,php-fpm 底下的 <a href="http://www.conf" target="_blank" rel="noopener">www.conf</a> 档也要改<br>user = nginx<br>group = www-data</p>
<p>php yii migrate<br>跟 laravel 一样</p>
<p>sudo chown -R myuser:mygroup myfolder</p>
<h1 id="运行-yii"><a href="#运行-yii" class="headerlink" title="运行 yii"></a>运行 yii</h1><p>yii 分两入口，一部份是 web，另一部份是 console<br>所以设定档也分成 common 和 console<br>再继续细分為 local 后缀和非真正生产环境的设定档</p>
<h1 id="运行错误"><a href="#运行错误" class="headerlink" title="运行错误"></a>运行错误</h1><p>运行时可能有遭遇到的错误<br>Fatal error: Cannot use ‘Object’ as class name as it is reserved<br><a href="https://github.com/yiisoft/yii2/issues/14823" target="_blank" rel="noopener">https://github.com/yiisoft/yii2/issues/14823</a></p>
<h1 id="yii-生命周期"><a href="#yii-生命周期" class="headerlink" title="yii 生命周期"></a>yii 生命周期</h1><p><a href="https://juejin.im/post/5d51056be51d4561c02a250b" target="_blank" rel="noopener">https://juejin.im/post/5d51056be51d4561c02a250b</a></p>
<h1 id="yii-console"><a href="#yii-console" class="headerlink" title="yii console"></a>yii console</h1><p>This is Yii version 2.0.15.1.<br>The following commands are available:</p>
<ul>
<li>asset Allows you to combine and compress your JavaScript and CSS files.</li>
<li>cache Allows you to flush cache.</li>
<li>fixture Manages fixture data loading and unloading.</li>
<li>gii This is the command line version of Gii - a code generator.</li>
<li>help Provides help information about console commands.</li>
<li>message Extracts messages to be translated from source files.</li>
<li>migrate Manages application migrations.</li>
<li>serve Runs PHP built-in web server.<br>那记得每个指令最好要用之前都先透过 yii help XXXX，会有详细的说明，以及列出其他的指令</li>
</ul>
<p>No command ‘yii’ found,<br>./yii migrate/create user</p>
<p>or<br>add it to the PATH variable in .bashrc:<br>vi ~/.bashrc</p>
<p>export PATH=”/var/www/yii/framework:$PATH”<br>export PATH=”$HOME/.composer/vender/bin:bin:$PATH”</p>
<p>就像 nodejs<br>echo ‘export PATH=$PATH:/usr/local/bin’ &gt;&gt; $HOME/.bashrc</p>
<p>In my case (with ZSH), it was: echo ‘export PATH=$PATH:/usr/local/bin’ &gt;&gt;$HOME/.zshrc …and then I ran: source ~/.zshrc</p>
<p>or</p>
<p>create symlink in /usr/bin (UBUNTU)<br>go to /usr/bin and<br>ln -s /data/lib/php/yii/framework/yiic yiic</p>
<h2 id="建立-controller"><a href="#建立-controller" class="headerlink" title="建立 controller"></a>建立 controller</h2><p>yii gii/controller –controllerClass = app\controllers\TestController</p>
<p>或者使用 web 界面<br>backend/config/main.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'components'</span> =&gt; [</span><br><span class="line">    <span class="string">'urlManager'</span> =&gt; [</span><br><span class="line">        <span class="string">'enablePrettyUrl'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">        <span class="string">'showScriptName'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">        <span class="string">'rules'</span> =&gt; [</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p><a href="http://localhost:8088/?r=gii" target="_blank" rel="noopener">http://localhost:8088/?r=gii</a><br>或是<br>url 美化後之後 gii 會提到<br><a href="http://localhost:8088/gii" target="_blank" rel="noopener">http://localhost:8088/gii</a></p>
<h1 id="yii-的资料夹结构"><a href="#yii-的资料夹结构" class="headerlink" title="yii 的资料夹结构"></a>yii 的资料夹结构</h1><p>yii 的资料夹结构除了 gii 之类的指令会生成档案，大致上就没什么变，大部分都要手动新增，例如你需要手动新增 fixture</p>
<h1 id="yii-validation"><a href="#yii-validation" class="headerlink" title="yii validation"></a>yii validation</h1><p><a href="https://yii2-framework.readthedocs.io/en/stable/guide/input-validation/" target="_blank" rel="noopener">https://yii2-framework.readthedocs.io/en/stable/guide/input-validation/</a></p>
<p>yii 在做欄位驗證的時候，<br>可以對整個表單做驗證，<br>$form-&gt;validate()<br>可以對單一欄位做驗證<br>$form-&gt;validate([‘field_name’])</p>
<p>那如果需要特別指定(Ad hoc)某個驗證規則<br>$validator = new yii\validators\EmailValidator();</p>
<p>那傳統 form 表單傳過來的資料都是字串，所以如果是數字，php 會自動進行轉換<br>所以 rule integer 就算你是字串他也會給你過，那萬一你是對型別有要求的 json，那傳統表單的驗證規則和 json 的就不能共用<br><a href="https://www.yiiframework.com/doc/api/2.0/yii-validators-numbervalidator" target="_blank" rel="noopener">https://www.yiiframework.com/doc/api/2.0/yii-validators-numbervalidator</a><br>請加上 intergeronly=&gt;true</p>
<p><a href="https://flamerecca.gitbooks.io/yii-2-0-cookbook-yii2-gitbook-cookbook/forms-validator-multiple-attributes.html" target="_blank" rel="noopener">https://flamerecca.gitbooks.io/yii-2-0-cookbook-yii2-gitbook-cookbook/forms-validator-multiple-attributes.html</a></p>
<h2 id="有关栏位个别更新"><a href="#有关栏位个别更新" class="headerlink" title="有关栏位个别更新"></a>有关栏位个别更新</h2><p>因為栏位有时需要同意支 api 可更新个别单个栏位，此时要自己在家逻辑看看栏位是否為 null<br>但记得 trim 过后的栏位一定是空字串，此时你会无从判断使用者是否有传值过来，所以如果允许 null 的栏位建议就不要再加 trim 规则，<br>如果要的话，就变成只能判断是否為空字串，就要加上 empty 判断，让你的栏位不能是空字串，但通常云许 null 的栏位都可以是空字串，在此建议可以不用家 trim 以免麻烦</p>
<h2 id="safe"><a href="#safe" class="headerlink" title="safe"></a>safe</h2><p><a href="https://www.yiichina.com/question/2093" target="_blank" rel="noopener">https://www.yiichina.com/question/2093</a></p>
<h2 id="如何自订验证和参数"><a href="#如何自订验证和参数" class="headerlink" title="如何自订验证和参数"></a>如何自订验证和参数</h2><p><a href="https://github.com/yiisoft/yii2/issues/1174" target="_blank" rel="noopener">https://github.com/yiisoft/yii2/issues/1174</a></p>
<p>传参数要用关键字<strong>params</strong> 否则会报错</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        [<span class="string">'test'</span>, <span class="string">'validateTest'</span>, <span class="string">'params'</span> =&gt; [<span class="string">'test'</span> =&gt; <span class="string">'value'</span>]],</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="密码验证"><a href="#密码验证" class="headerlink" title="密码验证"></a>密码验证</h2><p>generatePasswordHash<br>yii 的加密函数和一般的 md5 hash1 不一样，即便事项同的输入也会有不同的输出<br>所以必须透过 yii 的 validatePassword 来验证<br>这点是蛮特别的</p>
<h1 id="yii-中学习到的原则"><a href="#yii-中学习到的原则" class="headerlink" title="yii 中学习到的原则"></a>yii 中学习到的原则</h1><ol>
<li>要考虑维护性<br>scenarios ,最好设定常数,不要直接用字串，这样档案之前才可以互相参考和提示</li>
<li>要划分好职责,就像一般 mvc 会遇到的问题一样，有人会建议在画个 repository</li>
</ol>
<ul>
<li>controller的原則，超過10行就是臃腫的controller</li>
<li>controller放不會重複的code</li>
</ul>
<ol start="3">
<li>写 code 的时候也要对 function 划分好职责，不需要做的而外判断就不要加上去，就像工程师对 function 参数的输入在外面验证过后，就不要在验证一次了，要相信写 code 的人的输入，至于如果是使用者的输入，就一定要验证，要分清楚工程师和使用者的输入</li>
</ol>
<h1 id="yii-scenarios"><a href="#yii-scenarios" class="headerlink" title="yii scenarios"></a>yii scenarios</h1><h2 id="rule"><a href="#rule" class="headerlink" title="rule"></a>rule</h2><p><a href="https://www.yii-china.com/post/detail/40.html" target="_blank" rel="noopener">https://www.yii-china.com/post/detail/40.html</a></p>
<h2 id="栏位验证"><a href="#栏位验证" class="headerlink" title="栏位验证"></a>栏位验证</h2><p>像再做 api 和后台栏位会有不同的客制化需求，主体的 model 不变，但是验证规则继承下来之后，多半都是需要重写的，若不想要重写，建议设置<strong>on</strong> scenarios,<br>尤其是 required 规则一继承下来大家都吃的到，这样要运用就不是很好运用，非必填变成一定要填，除非你能确定该规则换情况都通用，例如密码格式，长度，这些可以共用就不用设置 scenarios<br>另外就是例如 unique 规则会去访问 db，所以的验证的 form 除了一定要是继承自原本的 model 以外，一定要加上 scenarios,不然查询功能还要验证参数的 username 是否唯一这是蛇鬼</p>
<h1 id="yii-調適"><a href="#yii-調適" class="headerlink" title="yii 調適"></a>yii 調適</h1><p>show raw sql query<br>$query-&gt;createCommand()-&gt;getRawSql()<br><a href="https://www.yiiframework.com/wiki/857/show-raw-sql-query" target="_blank" rel="noopener">https://www.yiiframework.com/wiki/857/show-raw-sql-query</a><br>或者記下 log<br><a href="https://forum.yiiframework.com/t/is-there-a-log-of-sql-queries/27533" target="_blank" rel="noopener">https://forum.yiiframework.com/t/is-there-a-log-of-sql-queries/27533</a></p>
<h1 id="gii"><a href="#gii" class="headerlink" title="gii"></a>gii</h1><p>如果开启了 pretty URLs, 则这样访问:<br><a href="http://localhost/path/to/index.php/gii" target="_blank" rel="noopener">http://localhost/path/to/index.php/gii</a></p>
<p>gii forbidden (#403)<br>如果从除 localhost 之外的 IP 地址访问 gii ，访问将被默认拒绝。 要规避该默认值，则需将允许的 IP 地址添加到配置中：<br>yiitest/config/web.php<br>那如果是進階版， main.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'modules'</span> =&gt; [</span><br><span class="line"><span class="string">'gii'</span> =&gt; [</span><br><span class="line"><span class="string">'class'</span> =&gt; <span class="string">'yii\gii\Module'</span>,</span><br><span class="line"><span class="comment">//'allowedIPs' =&gt; ['127.0.0.1', '::1', '192.168.1.*', 'XXX.XXX.XXX.XXX'] // adjust this to your needs</span></span><br><span class="line"><span class="string">'allowedIPs'</span> =&gt; YII_DEBUG ? [<span class="string">'*'</span>] : [<span class="string">'127.0.0.1'</span>, <span class="string">'::1'</span>],</span><br><span class="line"></span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>

<p><a href="https://www.yiiframework.com/extension/yiisoft/yii2-gii/doc/guide/2.1/zh-cn/installation" target="_blank" rel="noopener">https://www.yiiframework.com/extension/yiisoft/yii2-gii/doc/guide/2.1/zh-cn/installation</a></p>
<h1 id="啟動-server-放文件給同事看"><a href="#啟動-server-放文件給同事看" class="headerlink" title="啟動 server 放文件給同事看"></a>啟動 server 放文件給同事看</h1><p>php -S 0.0.0.0:10000 -t mapi/apidoc</p>
<p>PHP 的 built-in web server 有个 -t 参数可以指定 document root 的路径的，比如这里就可以写成：<br>php -S localhost:8080 -t web<br>这样就能省掉 URL 中的 /web/index.php 这部分了。</p>
<h1 id="ERROR-2006-‘MySQL-server-has-gone-away’"><a href="#ERROR-2006-‘MySQL-server-has-gone-away’" class="headerlink" title="ERROR : (2006, ‘MySQL server has gone away’"></a>ERROR : (2006, ‘MySQL server has gone away’</h1><p>市因為設定檔忘記將 mysql:改成 pgsql:</p>
<h1 id="phpstorm-shortcut-duplicate-lines"><a href="#phpstorm-shortcut-duplicate-lines" class="headerlink" title="phpstorm shortcut duplicate lines"></a>phpstorm shortcut duplicate lines</h1><p>(you’d use ctrl+d, but first you have to select many (how? I think they wanted ctrl+w to be used for this))</p>
<h1 id="取資料"><a href="#取資料" class="headerlink" title="取資料"></a>取資料</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$query = GetGameRecord::find()</span><br><span class="line">    -&gt;select([</span><br><span class="line">        <span class="string">'game_record.*'</span>,</span><br><span class="line"></span><br><span class="line"><span class="string">'game_kind.kind_name'</span></span><br><span class="line">])</span><br><span class="line">-&gt;joinWith(<span class="string">'gameKind'</span>)</span><br><span class="line">-&gt;Where([<span class="string">'board_id'</span> =&gt; $pageForm-&gt;board_id])</span><br><span class="line">-&gt;orderBy(<span class="string">'settle_time desc'</span>);</span><br></pre></td></tr></table></figure>

<h1 id="yii-分页"><a href="#yii-分页" class="headerlink" title="yii 分页"></a>yii 分页</h1><p>這是 yii orm 內建的子查詢，如果不想要子查詢那麼多<br>可以在下 sql 的時候作 join 像上面一樣</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fields</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $fields = <span class="keyword">parent</span>::fields();</span><br><span class="line">    $fields[<span class="string">'kind_name'</span>] = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;gameKind ? <span class="keyword">$this</span>-&gt;gameKind-&gt;kind_name : <span class="keyword">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    $fields[<span class="string">'server_name'</span>] = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;gameServer ? <span class="keyword">$this</span>-&gt;gameServer-&gt;name : <span class="keyword">null</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> $fields;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> $firstQuery= Agent::find()</span><br><span class="line">        -&gt;where([<span class="string">'parent_id'</span> =&gt; <span class="keyword">$this</span>-&gt;agent-&gt;id])</span><br><span class="line">        -&gt;andFilterWhere([</span><br><span class="line">            <span class="string">'id'</span> =&gt; $pageForm-&gt;agent_id,</span><br><span class="line">            <span class="string">'nickname'</span> =&gt; $pageForm-&gt;nickname,</span><br><span class="line">            <span class="string">'username'</span> =&gt; $pageForm-&gt;agent_username,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">    $secondQuery = GameRecord::find()</span><br><span class="line">        -&gt;Where([<span class="string">'&gt;='</span>, <span class="string">'settle_time'</span>, ($pageForm-&gt;start_time != <span class="keyword">null</span>) ? $pageForm-&gt;start_time : <span class="keyword">null</span>])</span><br><span class="line">        -&gt;andWhere([<span class="string">'&lt;='</span>, <span class="string">'settle_time'</span>, ($pageForm-&gt;end_time != <span class="keyword">null</span>) ? ($pageForm-&gt;end_time + <span class="number">86399</span>) : <span class="keyword">null</span>])</span><br><span class="line">        -&gt;andFilterWhere([</span><br><span class="line">            <span class="string">'kind_id'</span> =&gt; $pageForm-&gt;kind_id,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $query = Agent::find()</span><br><span class="line">        -&gt;select([</span><br><span class="line">            <span class="string">'t1.id'</span>,</span><br><span class="line">            <span class="string">'t1.username'</span>,</span><br><span class="line">            <span class="string">'t1.nickname'</span>,</span><br><span class="line">            <span class="string">'t1.parent_rate'</span>,</span><br><span class="line">            <span class="string">'t1.score'</span>,</span><br><span class="line">            <span class="string">'bet'</span> =&gt; <span class="keyword">new</span> Expression(<span class="string">'COALESCE(SUM(valid_bet), 0)'</span>),</span><br><span class="line">            <span class="string">'count'</span> =&gt; <span class="keyword">new</span> Expression(<span class="string">'COUNT(board_id)'</span>),</span><br><span class="line">            <span class="string">'total'</span> =&gt; <span class="keyword">new</span> Expression(<span class="string">'COALESCE(SUM(revenue), 0)'</span>),</span><br><span class="line">        ])</span><br><span class="line">        -&gt;from([<span class="string">'t1'</span> =&gt; $firstQuery])</span><br><span class="line">        -&gt;leftJoin([<span class="string">'t2'</span> =&gt; $secondQuery], <span class="string">'t2.agent_id = t1.id'</span>)</span><br><span class="line">        -&gt;orderBy(<span class="string">'t1.id desc'</span>)</span><br><span class="line">        -&gt;groupBy([<span class="string">'t1.id'</span>, <span class="string">'t2.agent_id'</span>])</span><br><span class="line">        -&gt;asArray();</span><br><span class="line">    <span class="keyword">echo</span> $query-&gt;createCommand()-&gt;getRawSql();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            $subQuery = MemberLoginLog::find()-&gt;select([</span><br><span class="line">        <span class="string">'username'</span>,</span><br><span class="line">        <span class="string">"MAX(created_at) last_time_login"</span>,</span><br><span class="line">    ])-&gt;groupBy(<span class="string">'username'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $query = Member::find()-&gt;select([</span><br><span class="line">        <span class="string">'member.username'</span>,</span><br><span class="line">        ])</span><br><span class="line">        -&gt;leftJoin([<span class="string">'last_login'</span>=&gt;(<span class="keyword">new</span> \yii\db\Query())</span><br><span class="line">            -&gt;from([<span class="string">'t1'</span>=&gt; $subQuery])</span><br><span class="line">            -&gt;innerJoin([MemberLoginLog::tableName()],<span class="string">'t1.username=member_login_log.username AND t1.last_time_login=member_login_log.created_at'</span>)</span><br><span class="line">        ],<span class="string">'last_login.username=member.username'</span>)</span><br><span class="line">        -&gt;andWhere([<span class="string">'member.agent_id'</span> =&gt; <span class="keyword">$this</span>-&gt;agent-&gt;id])-&gt;orderBy(<span class="string">'created_at desc'</span>)</span><br><span class="line">        -&gt;groupBy(<span class="string">'member.username'</span>);</span><br></pre></td></tr></table></figure>

<h1 id="migrate-fresh"><a href="#migrate-fresh" class="headerlink" title="migrate/fresh"></a>migrate/fresh</h1><p>資料表在 migration 的時候會合叫加％符號，是因為之後再加前綴才會加到<br>实验后证实，经过 partition 的表，在 fresh 时会失败</p>
<h2 id="yii-連接-tsql"><a href="#yii-連接-tsql" class="headerlink" title="yii 連接 tsql"></a>yii 連接 tsql</h2><p><a href="https://forum.yiiframework.com/t/odbc-support/42598/6" target="_blank" rel="noopener">https://forum.yiiframework.com/t/odbc-support/42598/6</a></p>
<h1 id="yii-多個表-join"><a href="#yii-多個表-join" class="headerlink" title="yii 多個表 join"></a>yii 多個表 join</h1><p><a href="https://www.yii-china.com/topic/detail/110" target="_blank" rel="noopener">https://www.yii-china.com/topic/detail/110</a></p>
<h1 id="thousands-of-single-SELECTs"><a href="#thousands-of-single-SELECTs" class="headerlink" title="thousands of single SELECTs"></a>thousands of single SELECTs</h1><p><a href="https://stackoverflow.com/questions/30195428/why-is-yii2s-activerecord-using-lots-of-single-selects-instead-of-joins" target="_blank" rel="noopener">https://stackoverflow.com/questions/30195428/why-is-yii2s-activerecord-using-lots-of-single-selects-instead-of-joins</a></p>
<h1 id="yii-格式化輸出"><a href="#yii-格式化輸出" class="headerlink" title="yii 格式化輸出"></a>yii 格式化輸出</h1><p><a href="https://github.com/yiisoft/yii2/issues/10927" target="_blank" rel="noopener">https://github.com/yiisoft/yii2/issues/10927</a></p>
<h1 id="用-join-進來的表格做排序"><a href="#用-join-進來的表格做排序" class="headerlink" title="用 join 進來的表格做排序"></a>用 join 進來的表格做排序</h1><p><a href="https://forum.yiiframework.com/t/sort-dataprovider-with-count-on-related-field/82810" target="_blank" rel="noopener">https://forum.yiiframework.com/t/sort-dataprovider-with-count-on-related-field/82810</a></p>
<h1 id="如何分割-log-档"><a href="#如何分割-log-档" class="headerlink" title="如何分割 log 档"></a>如何分割 log 档</h1><p><a href="https://www.jb51.net/article/81094.htm" target="_blank" rel="noopener">https://www.jb51.net/article/81094.htm</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'log'</span> =&gt; [</span><br><span class="line">    <span class="string">'targets'</span> =&gt; [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">'class'</span> =&gt; <span class="string">'yii\log\FileTarget'</span>,</span><br><span class="line">            <span class="string">'logFile'</span> =&gt; <span class="string">'@runtime/logs/'</span> . date(<span class="string">'Y'</span>) . <span class="string">'/'</span> . date(<span class="string">'m'</span>) . <span class="string">'/'</span> . date(<span class="string">'d'</span>) . <span class="string">'/app.log'</span>,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h1 id="cotroller"><a href="#cotroller" class="headerlink" title="cotroller"></a>cotroller</h1><p>controller 介於 veiw 和 model 之間做溝通的橋樑，<br>router 和 functoin 的名字做對應，有大小寫和 dash 的規則<br>public $defaultAction = ‘XXX’;<br>可以改變 router 根目錄/為 index 的預設<br>public $layout = ‘main’;<br>可以改變 view 的 layout 模版<br>public $enableCsrfValidation = false;<br>關掉 csrf 驗證，通常不建議這麼做<br>function actionXXX 的參數可以作為 queryString 參數的接口<br><a href="https://youtu.be/hQr0ce2OvmA" target="_blank" rel="noopener">https://youtu.be/hQr0ce2OvmA</a></p>
<p>事件註冊：<br>以 on beforeAction 為例，註冊在 config 裡面的會先於個別 controller,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'on beforeAction'</span>=&gt;<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">beforeAction</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">先於註冊在 controller 的事件例如：</span><br><span class="line">Yii::\$app-&gt;controller-&gt;on(<span class="string">'controller::EVENT_BRFORE_ACTION'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="render"><a href="#render" class="headerlink" title="render"></a>render</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;render(<span class="string">'about'</span>);</span><br><span class="line"><span class="keyword">$this</span>-&gt;renderPartial();<span class="comment">//render html</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;renderFile();</span><br><span class="line"><span class="keyword">$this</span>-&gt;renderAajx();</span><br></pre></td></tr></table></figure>

<h1 id="view"><a href="#view" class="headerlink" title="view"></a>view</h1><h2 id="render-部份內容"><a href="#render-部份內容" class="headerlink" title="render 部份內容"></a>render 部份內容</h2><p>$this-&gt;render(‘footer’);</p>
<h2 id="傳資料"><a href="#傳資料" class="headerlink" title="傳資料"></a>傳資料</h2><p>在 controller 你可以<br>$this-&gt;render(‘path’,[‘data’=&gt; ‘mydata’);<br>$this-&gt;view-&gt;params[‘data’];<br>在 view 這樣收<br>$data<br>$this-&gt;params[‘data’] or Yii::$app-&gt;view-&gt;params[‘data’]</p>
<h2 id="找出-controller"><a href="#找出-controller" class="headerlink" title="找出 controller"></a>找出 controller</h2><p>$this-&gt;context-&gt;id</p>
<h2 id="其他標籤"><a href="#其他標籤" class="headerlink" title="其他標籤"></a>其他標籤</h2><p>$this-&gt;title<br>$this-&gt;registerMetaTag([‘name’=&gt;’keyword’,’content’=&gt;’yii2 , framwork’])</p>
<h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><p>在 view 頁面,加上<br>/*_ @var \yii\web\View $this _/<br>PHPstorm 就會知道這個頁面的$this 是 view 的實例</p>
<h1 id="model"><a href="#model" class="headerlink" title="model"></a>model</h1><p>在 controller 如果你要存取 model 的屬性的話<br>$model-&gt;attributeName<br>$model[‘attributeName’]<br>都可行<br>那如果要大量賦值的話<br>$model-&gt;attriutes = $post;<br>那記得一定要經過$model-&gt;validate()</p>
<h1 id="request"><a href="#request" class="headerlink" title="request"></a>request</h1><p>在 controller 我們可以<br>Yill::$app-&gt;request-&gt;get();<br>Yill::$app-&gt;request-&gt;get(‘id’,0);<br>或是經由 function actionXXX($id=0)的參數<br>Yill::$app-&gt;request-&gt;getBodyParams()<br>用在你希望收到 put 請求或是 json 格式的參數時<br>阿如果是 json<br>設定檔頁要做設定</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'component'</span>=&gt;[</span><br><span class="line">    <span class="string">'request'</span>=&gt;[</span><br><span class="line">        <span class="string">'parser'</span>=&gt;\yii\web\JsonParser::class</span><br><span class="line">    ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h1 id="response"><a href="#response" class="headerlink" title="response"></a>response</h1><p><a href="https://youtu.be/omqyY94WVos" target="_blank" rel="noopener">https://youtu.be/omqyY94WVos</a><br>當你在 actionXXX 回傳東西的時候就相當於</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">actionXXX</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">'hello world'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Yii::\$app-&gt;response-&gt;content = <span class="string">'hello world'</span></span><br></pre></td></tr></table></figure>

<h2 id="statusCode"><a href="#statusCode" class="headerlink" title="statusCode"></a>statusCode</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yii::\$app-&gt;response-&gt;statusCode = <span class="string">'404'</span></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="comment">// https://www.yiiframework.com/doc/guide/2.0/en/runtime-responses</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> \yii\web\HttpException(<span class="number">404</span>)</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> yii\web\NotFoundHttpException();</span><br></pre></td></tr></table></figure>

<h2 id="改變回傳格式"><a href="#改變回傳格式" class="headerlink" title="改變回傳格式"></a>改變回傳格式</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Yii:$app-&gt;response-&gt;data = [</span><br><span class="line">    <span class="string">'name'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    <span class="string">'age'</span>=&gt; <span class="number">5</span></span><br><span class="line">];</span><br><span class="line">Yii:$app-&gt;response-&gt;format = Response::FORMAT_XML</span><br><span class="line">Yii:\$app-&gt;response-&gt;format = Response::FORMAT_JSON</span><br></pre></td></tr></table></figure>

<h2 id="重導畫面"><a href="#重導畫面" class="headerlink" title="重導畫面"></a>重導畫面</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">或在 controller</span><br><span class="line">Yii::$app-&gt;response-&gt;redirect(<span class="string">'about'</span>,<span class="number">301</span>);</span><br><span class="line"> <span class="keyword">$this</span>-&gt;redirect(<span class="string">'about'</span>);</span><br><span class="line">在 controller 外</span><br><span class="line">Yii::\$app-&gt;response-&gt;redirect(<span class="string">'about'</span>,<span class="number">301</span>)-&gt;send();</span><br></pre></td></tr></table></figure>

<h2 id="傳檔案"><a href="#傳檔案" class="headerlink" title="傳檔案"></a>傳檔案</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yii::$app-&gt;reponse-&gt;sendContentAsFile(<span class="string">'hello world'</span>,<span class="string">'test.text'</span>)</span><br><span class="line">Yii::$app-&gt;reponse-&gt;sendFile(<span class="string">'filepath'</span>,<span class="string">'test.text'</span>)</span><br><span class="line">Yii::\$app-&gt;reponse-&gt;sendStreamsFile()<span class="comment">//這個在傳送大檔的時候，特別重要，才不會報出記憶體不夠的錯</span></span><br></pre></td></tr></table></figure>

<h1 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h1><p><a href="https://youtu.be/69zKqHrU5-Y" target="_blank" rel="noopener">https://youtu.be/69zKqHrU5-Y</a></p>
<p>在 layout 頁面<br>$this-&gt;beginPage()會呼叫 on beforePageBegin 事件</p>
<h1 id="widget"><a href="#widget" class="headerlink" title="widget"></a>widget</h1><p>UI 元件的製作</p>
<h1 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h1><p>Yii::setAlias(‘@home’,’/home’);<br>@符號如果忘記加，yii 會幫你加</p>
<h1 id="asset-bundle"><a href="#asset-bundle" class="headerlink" title="asset bundle"></a>asset bundle</h1><p><a href="https://youtu.be/eJBQeRocRac" target="_blank" rel="noopener">https://youtu.be/eJBQeRocRac</a><br>在你不需要內建的 css 和 js 的時候，你需要自訂義</p>
<h1 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h1><p>一般來說 yii 提供<br>new Connection([<br>‘dsn’=&gt;’’,<br>‘username’=&gt;’root’,<br>‘password’=&gt;’password’<br>]);<br>來建立資料庫連線，但不推薦這樣做<br>應該用官方的設定 component 的方式，component 都是 singleton,省資源<br>再來存取這個物件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Yii::$app-&gt;db-&gt;createCommand(<span class="string">'select * from user where id = :id'</span>)-&gt;query();</span><br><span class="line">Yii::$app-&gt;db-&gt;createCommand()-&gt;bindValues([<span class="string">'id'</span>=&gt;$id])-&gt;query(); <span class="comment">//用於大量賦值</span></span><br><span class="line">Yii::$app-&gt;db-&gt;createCommand()-&gt;bindParams(<span class="string">'id'</span>,$id)-&gt;query(); <span class="comment">//注意bindParams第二個參數是吃位址不是吃值</span></span><br><span class="line"></span><br><span class="line">Yii::$app-&gt;db-&gt;createCommand()-&gt;insert(<span class="string">'user'</span>,[])-&gt;execute();</span><br><span class="line">Yii::$app-&gt;db-&gt;createCommand()-&gt;batchInsert(<span class="string">'user'</span>,[<span class="string">'username'</span>,<span class="string">'age'</span>],[$dataArr])-&gt;execute();</span><br><span class="line"></span><br><span class="line">Yii::$app-&gt;db-&gt;createCommand()-&gt;update(<span class="string">'user'</span>,$data,[<span class="string">'id'</span>=&gt;<span class="number">5</span>])-&gt;execute();</span><br><span class="line">Yii::$app-&gt;db-&gt;createCommand()-&gt;delete(<span class="string">'user'</span>,[<span class="string">'id'</span>=&gt;<span class="number">5</span>])-&gt;execute();</span><br><span class="line"></span><br><span class="line">Yii::$app-&gt;db-&gt;createCommand()-&gt;upsert(<span class="string">'user'</span>,$data,[<span class="string">'id'</span>=&gt;<span class="number">5</span>])-&gt;execute();</span><br></pre></td></tr></table></figure>

<h2 id="backtick"><a href="#backtick" class="headerlink" title="backtick"></a>backtick</h2><p>框架會自訂幫我們加`<br>但是有的時候框架會因為語句太複雜而加錯地方</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$db-&gt;createCommand(<span class="string">'SELECT IFFULL(email,username) from user'</span>)-&gt;execute();</span><br><span class="line">出來的語句會有錯</span><br><span class="line">所以必須要</span><br><span class="line">$db-&gt;createCommand(<span class="string">'SELECT IFFULL([[email]],[[username]]) from &#123;&#123;%user&#125;&#125;'</span>)-&gt;execute();</span><br></pre></td></tr></table></figure>

<h1 id="active-Record"><a href="#active-Record" class="headerlink" title="active Record"></a>active Record</h1><p>我們的 model 通常都會繼承 active Record<br>Model::findOne($id);<br>update insert用<br>$model-&gt;save();<br>delete 用<br>$model-&gt;delete();</p>
<h1 id="query-bulider"><a href="#query-bulider" class="headerlink" title="query bulider"></a>query bulider</h1><p>(new Query())-&gt;select([])-&gt;from()-&gt;all();<br>阿因為 ActiveRecord extends ActiveQuery and ActiveQuery extends Query<br>所以等於<br>Model::find()-&gt;select([])-&gt;from-&gt;all();<br>又因為是 ActiveRecord 物件可以省下填寫表格名稱變成<br>Model::find()-&gt;all();</p>
<h1 id="設定物件"><a href="#設定物件" class="headerlink" title="設定物件"></a>設定物件</h1><p>yii 提供了讓你創建物件的方法<br>例如<br><a href="https://youtu.be/lQaCY8Zza2U" target="_blank" rel="noopener">https://youtu.be/lQaCY8Zza2U</a>.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Yii::Createobject([</span><br><span class="line">    <span class="string">'class'</span>=&gt;Myclass::class,</span><br><span class="line">    <span class="string">'otherproperty'</span>=&gt;<span class="number">10</span>,</span><br><span class="line">    <span class="string">'otherproperty2'</span>=&gt;<span class="number">20</span></span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 等同於</span></span><br><span class="line">$object = <span class="keyword">new</span> Myclass();</span><br><span class="line">Yii::configure($object,[</span><br><span class="line">    <span class="string">'otherproperty'</span>=&gt;<span class="number">10</span>,</span><br><span class="line">    <span class="string">'otherproperty2'</span>=&gt;<span class="number">20</span></span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 就像設定檔的給的陣列一樣</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 我們也可以在設定檔設定容器</span></span><br><span class="line"><span class="string">'container'</span> =&gt; [</span><br><span class="line">    <span class="string">'definitions'</span>=&gt;[</span><br><span class="line">        <span class="string">'NameSpace/Myclass'</span>=&gt;[</span><br><span class="line">            <span class="string">'otherproperty'</span>=&gt;<span class="number">10</span>,</span><br><span class="line">            <span class="string">'otherproperty2'</span>=&gt;<span class="number">20</span></span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然後</span></span><br><span class="line">$object = Yii::Createobject([</span><br><span class="line">    <span class="string">'class'</span>=&gt;Myclass::class,</span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 就可以發現物件的設定值已經改變</span></span><br><span class="line">var_dump($object);</span><br><span class="line">或者</span><br><span class="line">Yii::$container-&gt;set(Myclass::class,[</span><br><span class="line">    <span class="string">'otherProperty'</span> =&gt; <span class="number">10</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h1 id="restAPI"><a href="#restAPI" class="headerlink" title="restAPI"></a>restAPI</h1><p><a href="https://youtu.be/XyHHMvRt6Cw" target="_blank" rel="noopener">https://youtu.be/XyHHMvRt6Cw</a></p>
<p>yii 支援 restapi，只要做幾個設定，就能輕鬆做出 restful 的 api</p>
<p>controller extends yii/rest/ActiveController<br>指定 model<br>$modelClass = modelClass::class;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'request'</span>=&gt;[</span><br><span class="line">    <span class="string">'parser'</span>=&gt;[</span><br><span class="line">        <span class="string">'aplication/json'</span>=&gt;JsonParser::class</span><br><span class="line">    ]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="string">'urlManager'</span>=&gt;[</span><br><span class="line">    <span class="string">'enablePrettyUrl'</span>=&gt;<span class="keyword">true</span>,</span><br><span class="line">    <span class="string">'showScriptName'</span>=&gt;<span class="keyword">false</span>,</span><br><span class="line">    <span class="string">'rules'</span>=&gt;[</span><br><span class="line">        [</span><br><span class="line">         <span class="string">'class'</span>=&gt;UrlRute::class,</span><br><span class="line">         <span class="string">'controller'</span>=&gt; [<span class="string">'contorllerName'</span>,<span class="string">'controllerName2'</span>]</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h1 id="yii-框架-日誌設定"><a href="#yii-框架-日誌設定" class="headerlink" title="yii 框架 日誌設定"></a>yii 框架 日誌設定</h1><p><a href="https://www.jb51.net/article/81094.htm" target="_blank" rel="noopener">https://www.jb51.net/article/81094.htm</a></p>
<h1 id="當你的-php-是-5-2x-不支援-sha256"><a href="#當你的-php-是-5-2x-不支援-sha256" class="headerlink" title="當你的 php 是 5.2x 不支援 sha256"></a>當你的 php 是 5.2x 不支援 sha256</h1><p><a href="https://stackoverflow.com/questions/10524198/what-version-of-openssl-is-needed-to-sign-with-sha256withrsaencryption" target="_blank" rel="noopener">https://stackoverflow.com/questions/10524198/what-version-of-openssl-is-needed-to-sign-with-sha256withrsaencryption</a><br>此篇像上帝一般，生產環境動不了只好動 code</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一頁"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一頁"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Stanley Ke</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 強力驅動
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  















  








  

  

</body>
</html>
